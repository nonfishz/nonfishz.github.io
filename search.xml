<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Description</title>
    <url>/once/description/</url>
    <content><![CDATA[<h3 id="Welcome-to-my-blog"><a href="#Welcome-to-my-blog" class="headerlink" title="Welcome to my blog!"></a>Welcome to my blog!</h3><p>此博客正在进行迁移工作，博客会持续更新。</p>
<p>Moving！！！</p>
]]></content>
  </entry>
  <entry>
    <title>Nginx-反向代理</title>
    <url>/nginx/reverse_proxy/</url>
    <content><![CDATA[<h3 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h3><span id="more"></span>

<h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><ul>
<li>反向代理介于用户和真实服务器之间，提供请求和响应的中转服务</li>
<li>对于用户而言，反向代理服务器就是访问的真实服务器</li>
<li>反向代理可以有效降低服务器的负载消耗，提升效率</li>
</ul>
<img src="/load_images/nginx_reverse_proxy1.png" alt="img" style="zoom: 33%;" />

<h4 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h4><ul>
<li>隐藏真实服务器</li>
<li>便于横向扩充后端动态服务</li>
<li>动静分离，提升系统健壮性</li>
</ul>
<h3 id="动静分离"><a href="#动静分离" class="headerlink" title="动静分离"></a>动静分离</h3><h4 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">动静分离是指在web服务器架构中，将静态页面与动态页面或者静态内容接口和动态内容接口分开不同系统访问的架构设计方法，进而提升整个服务访问性能和可维护性</span><br></pre></td></tr></table></figure>

<h4 id="Web资源分类"><a href="#Web资源分类" class="headerlink" title="Web资源分类"></a>Web资源分类</h4><img src="/load_images/nginx_reverse_proxy2.png" alt="img" style="zoom: 33%;" />

<h4 id="Web请求图解"><a href="#Web请求图解" class="headerlink" title="Web请求图解"></a>Web请求图解</h4><p>静态请求Nginx本身可以处理（也可以单独做一个静态资源服务器专门处理静态请求），直接返回文件内容即可。动态请求可以打到动态资源服务器（也叫应用程序服务器）去处理，然后结果返回给Nginx，再返回给用户。</p>
<img src="/load_images/nginx_reverse_proxy3.png" alt="img" style="zoom: 33%;" />

<img src="/load_images/nginx_reverse_proxy4.png" alt="img" style="zoom:33%;" />

<h3 id="支持的协议"><a href="#支持的协议" class="headerlink" title="支持的协议"></a>支持的协议</h3><p>使用Nginx作为反向代理时支持的协议</p>
<img src="/load_images/nginx_reverse_proxy5.png" alt="img" style="zoom:33%;" />

<h3 id="upstream模块"><a href="#upstream模块" class="headerlink" title="upstream模块"></a>upstream模块</h3><h4 id="用来定义上游服务的相关信息"><a href="#用来定义上游服务的相关信息" class="headerlink" title="用来定义上游服务的相关信息"></a>用来定义上游服务的相关信息</h4><img src="/load_images/nginx_reverse_proxy6.png" alt="img" style="zoom:33%;" />

<ul>
<li>默认被编译进Nginx，禁用须通过–without-http_upstream_module</li>
</ul>
<h4 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h4><table>
<thead>
<tr>
<th>指令</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>upstream</td>
<td>段名，以{}括起来，中间定义上游服务URL</td>
</tr>
<tr>
<td>server</td>
<td>定义上游服务地址</td>
</tr>
<tr>
<td>zone</td>
<td>定义共享内存，用于跨worker子进程</td>
</tr>
<tr>
<td>keeplive</td>
<td>对上游服务器启用长连接</td>
</tr>
<tr>
<td>keeplive_requests</td>
<td>一个长连接最多请求个数</td>
</tr>
<tr>
<td>keepalive_time</td>
<td>限制通过一个长连接处理请求的最长时间。到了这个时间后，在后续的请求处理之后关闭连接</td>
</tr>
<tr>
<td>keeplive_timeout</td>
<td>空闲情形下，一个长连接的超时时长</td>
</tr>
<tr>
<td>hash</td>
<td>哈希负载均衡算法</td>
</tr>
<tr>
<td>ip_hash</td>
<td>依据IP进行哈希计算的负载均衡算法</td>
</tr>
<tr>
<td>least_conn</td>
<td>最少连接数负载均衡算法</td>
</tr>
<tr>
<td>least_time</td>
<td>最短响应时间负载均衡算法</td>
</tr>
<tr>
<td>random</td>
<td>随机负载均衡算法</td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">upstream定义一组服务器</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">upstream name &#123; ... &#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值：无</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http</span></span><br><span class="line"></span><br><span class="line">server可以监听不同的端口</span><br><span class="line">监听TCP和UNIX域套接字的服务器可以混合使用</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例</span></span><br><span class="line">upstream backend &#123;</span><br><span class="line">    server backend1.example.com weight=5;</span><br><span class="line">    server 127.0.0.1:8080       max_fails=3 fail_timeout=30s;</span><br><span class="line">    server unix:/tmp/backend3;</span><br><span class="line"></span><br><span class="line">    server backup1.example.com  backup;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">说明</span></span><br><span class="line">默认情况下，请求使用加权循环平衡方法在服务器之间分配</span><br><span class="line">上述示例，每7个请求将按以下方式分发：第一个server分配5个，第二、第三个server各一个；</span><br><span class="line">如果在与服务器通信时发生错误，请求被传递到下一个服务器，依次类推，直到尝试所有正常运行的服务器</span><br><span class="line">如果无法从任何服务器获得成功响应，那么客户端将收到与最后一个backup服务器通信的结果</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">server语法</span></span><br><span class="line">server address [parameters];</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值：无</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：upstream</span></span><br><span class="line"></span><br><span class="line">address可以是IP、域名，也可以带上端口(默认80端口)，也可以是一个UNIX套接字路径</span><br><span class="line">解析为多个IP地址的域名一次定义多个服务器</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>parameters可选值</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>weight&#x3D;number</td>
<td>权重值，默认为1</td>
</tr>
<tr>
<td>max_conns&#x3D;number</td>
<td>上游服务器的最大并发连接数</td>
</tr>
<tr>
<td>fail_timeout&#x3D;time</td>
<td>服务器不可用的判定时间</td>
</tr>
<tr>
<td>max_fails&#x3D;number</td>
<td>服务器不可用的检查次数</td>
</tr>
<tr>
<td>backup</td>
<td>备份服务器，仅当其他主服务器都不可用时，将被传递请求</td>
</tr>
<tr>
<td>down</td>
<td>标记服务器长期不可用，离线维护</td>
</tr>
<tr>
<td>resolve</td>
<td>监控服务器域名对应的IP地址变化，自动修改upstream配置，无需重启nginx；服务器组必须驻留在共享内存中</td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">keepalive：限制每个worker子进程与上游服务器空闲长连接的最大数量</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">keepalive connections;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值：无</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：upstream</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">简单示例</span></span><br><span class="line">keepalive 16;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">For HTTP</span></span><br><span class="line">upstream http_backend &#123;</span><br><span class="line">    server 127.0.0.1:8080;</span><br><span class="line"></span><br><span class="line">    keepalive 16;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    location /http/ &#123;</span><br><span class="line">        proxy_pass http://http_backend;</span><br><span class="line">        proxy_http_version 1.1; #proxy_http_version需要设置为1.1</span><br><span class="line">        proxy_set_header Connection &quot;&quot;; #proxy_set_header设置Connection为空</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">说明，如果不设置proxy_http_version为1.1，那么proxy_set_header需要设置Connection为Keep-Alive；不建议这么做</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">For FastCGI</span></span><br><span class="line">upstream fastcgi_backend &#123;</span><br><span class="line">    server 127.0.0.1:9000;</span><br><span class="line"></span><br><span class="line">    keepalive 8;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    location /fastcgi/ &#123;</span><br><span class="line">        fastcgi_pass fastcgi_backend;</span><br><span class="line">        fastcgi_keep_conn on; #需要设置fastcgi_keep_conn为on</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">关于负载均衡注意点</span></span><br><span class="line">当使用默认循环方法以外的负载均衡方法时，需要在keepalive指令之前启用它们。</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">keepalive_requests：设置一个keepalive连接可以处理的最大请求数。在发出最大请求数后，连接将关闭。</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">keepalive_requests number;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值</span></span><br><span class="line">keepalive_requests 1000; #在1.19.10版本之前，默认值为 100</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：upstream</span></span><br><span class="line">This directive appeared in version 1.15.3.</span><br><span class="line"></span><br><span class="line">Closing connections periodically is necessary to free per-connection memory allocations. </span><br><span class="line">Therefore, using too high maximum number of requests could result in excessive memory usage and not recommended.</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">keepalive_time：限制通过一个保活连接处理请求的最长时间。到了这个时间后，在后续的请求处理之后关闭连接</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">keepalive_time time;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值</span></span><br><span class="line">keepalive_time 1h;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文upstream</span></span><br><span class="line">This directive appeared in version 1.19.10.</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">keepalive_timeout：空闲连接的最长保持时间</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">keepalive_timeout timeout;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值</span></span><br><span class="line">keepalive_timeout 60s;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：upstream</span></span><br><span class="line">This directive appeared in version 1.15.3.</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">queue：如果在处理请求时无法立即选择上游服务器，则该请求将被放入队列中</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">queue number [timeout=time];</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值：无</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：upstream</span></span><br><span class="line">This directive appeared in version 1.5.12.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">说明</span></span><br><span class="line">number指定在队列可以同时存在的最大请求数</span><br><span class="line">如果队列已满，或者在 timeout 参数指定的时间段内无法选择传递请求的服务器，则会向客户端返回 502 (Bad Gateway) 错误。</span><br></pre></td></tr></table></figure>

<h3 id="简单反向代理示例"><a href="#简单反向代理示例" class="headerlink" title="简单反向代理示例"></a>简单反向代理示例</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上游服务器，本次用阿里云服务器</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">配置Nginx server</span></span><br><span class="line">server &#123;</span><br><span class="line">        listen 8080;</span><br><span class="line"></span><br><span class="line">        location /proxy/ &#123;</span><br><span class="line">                root /var/www/html;</span><br><span class="line">                index proxy.html;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">nginx -t #测试配置文件是否正确</span><br><span class="line">nginx -s reload #重新加载配置寄文件</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">由于想测试动态服务器，所以下面做一个简单脚本，实现简易动态服务</span></span><br><span class="line">cd /var/www/html</span><br><span class="line">mkdir proxy</span><br><span class="line">cd proxy</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">编写生成proxy.html动态文本内容脚本random.sh</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"></span></span><br><span class="line">DIR=/var/www/html/proxy</span><br><span class="line">FILE=proxy.html</span><br><span class="line"></span><br><span class="line">while true;do</span><br><span class="line">        echo &quot;Application Server,This time create number: $RANDOM&quot; &gt; $DIR/$FILE</span><br><span class="line">        sleep 1 #睡1秒，防止内容刷新太频繁</span><br><span class="line">done;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">执行脚本，并在后台挂起，注意脚本需要可执行权限</span></span><br><span class="line">nohup /var/www/html/proxy/random.sh &amp;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看proxy.html是否动态生成</span></span><br><span class="line">cat proxy.html</span><br><span class="line">Application Server,This time create number: 25253</span><br><span class="line">cat proxy.html</span><br><span class="line">Application Server,This time create number: 30014</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上面可以看到两次number不同</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">访问测试</span></span><br><span class="line">curl 127.0.0.1:8080/proxy/</span><br><span class="line">Application Server,This time create number: 950</span><br><span class="line">curl 127.0.0.1:8080/proxy/</span><br><span class="line">Application Server,This time create number: 23418</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">本地测试ok</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">接下来配置反向代理服务器，本机Mac</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Nginx配置</span></span><br><span class="line">upstream back_end &#123;</span><br><span class="line">        server ip|domain隐藏:8080 weight=2 max_conns=100 fail_timeout=10s max_fails=3; #IP|DOMAIN隐藏，请写上游服务器IP或域名</span><br><span class="line"></span><br><span class="line">        keepalive 32;</span><br><span class="line">        keepalive_requests 80;</span><br><span class="line">        keepalive_timeout 20s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">        listen 89;</span><br><span class="line"></span><br><span class="line">        location /proxy &#123;</span><br><span class="line">                proxy_pass http://back_end/proxy;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">nginx -t #测试配置文件是否正确</span><br><span class="line">nginx -s reload #重新加载配置文件</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">访问测试</span></span><br><span class="line">curl 127.0.0.1:89/proxy/</span><br><span class="line">Application Server,This time create number: 25323</span><br><span class="line">curl 127.0.0.1:89/proxy/</span><br><span class="line">Application Server,This time create number: 12020</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">测试OK，简易反向代理动态服务完成</span></span><br></pre></td></tr></table></figure>

<h3 id="Nginx代理场景下接受用户请求包体的处理方式"><a href="#Nginx代理场景下接受用户请求包体的处理方式" class="headerlink" title="Nginx代理场景下接受用户请求包体的处理方式"></a>Nginx代理场景下接受用户请求包体的处理方式</h3><h4 id="接收包体的两种方式"><a href="#接收包体的两种方式" class="headerlink" title="接收包体的两种方式"></a>接收包体的两种方式</h4><ul>
<li>接收完全部包体再发送</li>
<li>一边接收包体一边发送</li>
</ul>
<h4 id="通过proxy-request-buffering指令决定处理方式"><a href="#通过proxy-request-buffering指令决定处理方式" class="headerlink" title="通过proxy_request_buffering指令决定处理方式"></a>通过proxy_request_buffering指令决定处理方式</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">proxy_request_buffering on | off;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值</span>	</span><br><span class="line">proxy_request_buffering on;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http, server, location</span></span><br><span class="line">This directive appeared in version 1.7.11.</span><br></pre></td></tr></table></figure>

<h5 id="proxy-request-buffering-on"><a href="#proxy-request-buffering-on" class="headerlink" title="proxy_request_buffering on"></a>proxy_request_buffering on</h5><ul>
<li><p>说明：启用缓冲后，会先从客户端读取整个请求正文，然后再将请求发送到代理服务器</p>
</li>
<li><p>适应场景</p>
<ul>
<li>吞吐量高</li>
<li>上游服务并发处理能力低</li>
</ul>
</li>
</ul>
<h5 id="proxy-request-buffering-off"><a href="#proxy-request-buffering-off" class="headerlink" title="proxy_request_buffering off"></a>proxy_request_buffering off</h5><ul>
<li>禁用缓冲时，请求正文会在收到后立即发送到代理服务器。在这种情况下，如果 nginx 已经开始发送请求正文，则无法将请求传递给下一个服务器。</li>
<li>适应场景<ul>
<li>更及时响应</li>
<li>减少Nginx磁盘IO</li>
</ul>
</li>
</ul>
<h4 id="相关指令"><a href="#相关指令" class="headerlink" title="相关指令"></a>相关指令</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">client_max_body_size size;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值</span></span><br><span class="line">client_max_body_size 1m;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http, server, location</span></span><br><span class="line"></span><br><span class="line">设置客户端请求正文的最大允许大小。</span><br><span class="line">如果请求中的大小超过配置的值，则会向客户端返回 413（请求实体太大）错误。请注意，浏览器无法正确显示此错误。</span><br><span class="line"></span><br><span class="line">将size设置为 0 将禁用对客户端请求正文大小的检查。</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">client_body_buffer_size size;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值</span>	</span><br><span class="line">client_body_buffer_size 8k|16k;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http, server, location</span></span><br><span class="line"></span><br><span class="line">设置读取客户端请求正文的缓冲区大小</span><br><span class="line">如果请求正文大于缓冲区，则将整个正文或仅其部分写入临时文件（临时文件目录由client_body_temp_path指定）</span><br><span class="line"></span><br><span class="line">默认情况下，缓冲区大小等于两个内存页。这是x86、其他32位平台和x86-64上的8K。在其他 64 位平台上通常为16K。</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">client_body_temp_path path [level1 [level2 [level3]]];</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值</span></span><br><span class="line">client_body_temp_path client_body_temp;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http, server, location</span></span><br><span class="line"></span><br><span class="line">定义一个目录，用于存储保存客户端请求正文的临时文件。指定目录下最多可使用三级子目录层次结构。</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例</span></span><br><span class="line">client_body_temp_path /spool/nginx/client_temp 1 2;</span><br><span class="line">临时文件的路径可能像这样：/spool/nginx/client_temp/7/45/00000123457</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">client_body_in_single_buffer on | off;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值</span>	</span><br><span class="line">client_body_in_single_buffer off;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http, server, location</span></span><br><span class="line"></span><br><span class="line">确定 nginx 是否应将整个客户端请求正文保存在单个缓冲区中（连续内存）</span><br><span class="line">使用 $request_body 变量时建议使用该指令，以节省涉及的复制操作的数量</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">client_body_in_file_only on | clean | off;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值</span></span><br><span class="line">client_body_in_file_only off;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http, server, location</span></span><br><span class="line"></span><br><span class="line">确定nginx是否应将整个客户端请求正文保存到文件中。</span><br><span class="line">该指令可以在调试期间使用，或者在使用$request_body_file变量或模块ngx_http_perl_module的$r-&gt;request_body_file方法时使用。</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">client_body_timeout time;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值</span>	</span><br><span class="line">client_body_timeout 60s;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http, server, location</span></span><br><span class="line"></span><br><span class="line">定义读取客户端请求正文的超时时间</span><br><span class="line">超时仅设置为两个连续读取操作之间的一段时间，而不是整个请求正文的传输</span><br><span class="line">如果客户端在此时间内没有传输任何内容，则请求将终止并出现 408（请求超时）错误</span><br></pre></td></tr></table></figure>

<h5 id="简单示例"><a href="#简单示例" class="headerlink" title="简单示例"></a>简单示例</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">反向代理服务器配置</span></span><br><span class="line">server &#123;</span><br><span class="line">        listen 90;</span><br><span class="line"></span><br><span class="line">        location /proxy &#123;</span><br><span class="line">                proxy_pass http://ip隐藏:8001;</span><br><span class="line"></span><br><span class="line">                client_max_body_size 10k;</span><br><span class="line">                #client_body_in_file_only on;</span><br><span class="line">                #client_body_temp_path temp_body_path;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上游服务器配置</span></span><br><span class="line">server &#123;</span><br><span class="line">        listen 8001;</span><br><span class="line"></span><br><span class="line">        location /proxy &#123;</span><br><span class="line">                return 200 &quot;Proxy OK&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">curl -F &quot;file=@test.sh&quot; 127.0.0.1:90/proxy #上传文件到指定服务器</span><br></pre></td></tr></table></figure>

<h3 id="Nginx代理场景下如何更改发往上游的请求"><a href="#Nginx代理场景下如何更改发往上游的请求" class="headerlink" title="Nginx代理场景下如何更改发往上游的请求"></a>Nginx代理场景下如何更改发往上游的请求</h3><h4 id="请求行修改指令"><a href="#请求行修改指令" class="headerlink" title="请求行修改指令"></a>请求行修改指令</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">proxy_method method;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值：无</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http, server, location</span></span><br><span class="line"></span><br><span class="line">指定在转发到代理服务器的请求中使用的HTTP方法，替换来自客户端请求的方法</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">proxy_http_version 1.0 | 1.1;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值</span>	</span><br><span class="line">proxy_http_version 1.0;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http, server, location</span></span><br><span class="line">This directive appeared in version 1.1.4.</span><br><span class="line"></span><br><span class="line">设置代理的HTTP协议版本</span><br><span class="line">默认值为1.0，建议将1.1版本与keepalive连接和NTLM authentication一起使用</span><br></pre></td></tr></table></figure>

<h4 id="请求头部修改指令"><a href="#请求头部修改指令" class="headerlink" title="请求头部修改指令"></a>请求头部修改指令</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">proxy_set_header field value;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值</span></span><br><span class="line">proxy_set_header Host $proxy_host;</span><br><span class="line">proxy_set_header Connection close;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http, server, location</span></span><br><span class="line"></span><br><span class="line">允许重新定义或附加字段到传递给代理服务器的请求头</span><br><span class="line">value值可以包含文本、变量及其组合</span><br><span class="line"></span><br><span class="line">当且仅当当前级别上没有定义proxy_set_header指令时，这些指令才从先前的配置级别继承</span><br><span class="line"></span><br><span class="line">如果启用缓存，那么“If-Modified-Since”、“If-Unmodified-Since”、“If-None-Match”、“If-Match”、“Range”、“If-Range”这些头部字段不会从原始请求传递给代理服务器</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例</span></span><br><span class="line">可以像这样传递未更改的Host请求头字段</span><br><span class="line">proxy_set_header	Host	$http_host;</span><br><span class="line">但是，如果客户端请求头中不存在此字段，则不会传递任何内容。</span><br><span class="line">在这种情况下，最好使用$host变量：如果请求头中该字段存在，它的值等于Host字段的值，如果该字段不存在，等于主服务器的server_name值</span><br><span class="line">proxy_set_header Host $host;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例</span></span><br><span class="line">服务器名称可以和代理服务器的端口一起传递</span><br><span class="line">proxy_set_header	Host	$host:$proxy_port;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例</span></span><br><span class="line">如果字段的值为空，那么该字段不会传递给代理服务器</span><br><span class="line">proxy_set_header Accept-Encoding &quot;&quot;;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">proxy_pass_request_headers on | off;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值</span>	</span><br><span class="line">proxy_pass_request_headers on;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http, server, location</span></span><br><span class="line"></span><br><span class="line">表示是否将原始请求头中的字段传递给代理服务器；使用了pass_set_header指令，即使该参数设置为off，请求头字段也会传递给代理服务器</span><br></pre></td></tr></table></figure>

<h4 id="请求包体修改指令"><a href="#请求包体修改指令" class="headerlink" title="请求包体修改指令"></a>请求包体修改指令</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">proxy_set_body value;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值：无</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http, server, location</span></span><br><span class="line">允许重新定义传递给代理服务器的请求正文。该值可以包含文本、变量及其组合</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">proxy_pass_request_body on | off;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值</span>	</span><br><span class="line">proxy_pass_request_body on;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http, server, location</span></span><br><span class="line">表示是否将原始请求正文传递给代理服务器；使用了proxy_set_body指令，即使该参数设置为off，请求头字段也会传递给代理服务器</span><br></pre></td></tr></table></figure>

<h4 id="简单示例-1"><a href="#简单示例-1" class="headerlink" title="简单示例"></a>简单示例</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上游服务器</span></span><br><span class="line">server &#123;</span><br><span class="line">        listen 8001;</span><br><span class="line"></span><br><span class="line">        location /proxy &#123;</span><br><span class="line">                return 200 &quot;请求行</span><br><span class="line">request_method: $request_method</span><br><span class="line">uri: $uri</span><br><span class="line">scheme: $scheme</span><br><span class="line">request: $request</span><br><span class="line">请求头</span><br><span class="line">http_test: $http_test</span><br><span class="line">content_length: $content_length</span><br><span class="line">content_type $content_type&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">反向代理服务器配置</span></span><br><span class="line">server &#123;</span><br><span class="line">        listen 91;</span><br><span class="line"></span><br><span class="line">        location /proxy &#123;</span><br><span class="line">                proxy_pass http://IP隐藏:8001;</span><br><span class="line"></span><br><span class="line">                #proxy_method GET;</span><br><span class="line">                #proxy_http_version 1.1;</span><br><span class="line">                #proxy_set_header test &#x27;test config header set&#x27;;</span><br><span class="line">                #proxy_pass_request_headers off; #不能和proxy_set_header同时出现，否则无效</span><br><span class="line">                #proxy_set_body &quot;OOOOOOOOOOOOOOOOOOOO&quot;;</span><br><span class="line">                #proxy_pass_request_body off; #不能和proxy_set_body同时出现，否则无效</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">curl 127.0.0.1:91/proxy -H &quot;test: &#x27;test header&#x27;&quot; -d &quot;name=123&quot; #-H 设置request header -d 设置HTTP POST data</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">结果</span></span><br><span class="line">请求行</span><br><span class="line">request_method: POST</span><br><span class="line">uri: /proxy</span><br><span class="line">scheme: http</span><br><span class="line">request: POST /proxy HTTP/1.0</span><br><span class="line">请求头</span><br><span class="line">http_test: test config header set</span><br><span class="line">host: 106.14.248.117:8001</span><br><span class="line">content_length: 8</span><br><span class="line">content_type application/x-www-form-urlencoded</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上游服务器使用tcpdump抓包，查看body信息</span></span><br><span class="line">tcpdump -i eth0 port 8001 -A</span><br></pre></td></tr></table></figure>

<h3 id="Nginx与上游服务器建立连接细节"><a href="#Nginx与上游服务器建立连接细节" class="headerlink" title="Nginx与上游服务器建立连接细节"></a>Nginx与上游服务器建立连接细节</h3><img src="/load_images/nginx_reverse_proxy7.png" alt="img" style="zoom:33%;" />

<h4 id="长连接"><a href="#长连接" class="headerlink" title="长连接"></a>长连接</h4><ul>
<li>客户端到Nginx</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">keepalive_timeout 65;</span><br></pre></td></tr></table></figure>

<ul>
<li>Nginx到上游服务</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">keepalive 32;</span><br><span class="line">keepalive_requests 100;</span><br><span class="line">keepalive_timeout 60s;</span><br></pre></td></tr></table></figure>

<h4 id="指令-1"><a href="#指令-1" class="headerlink" title="指令"></a>指令</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">proxy_connect_timeout time;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值</span>	</span><br><span class="line">proxy_connect_timeout 60s;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http, server, location</span></span><br><span class="line"></span><br><span class="line">定义与代理服务器建立连接的超时时间；注意time不能超过75s</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">proxy_socket_keepalive on | off;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值</span></span><br><span class="line">proxy_socket_keepalive off;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http, server, location</span></span><br><span class="line">This directive appeared in version 1.15.6.</span><br><span class="line"></span><br><span class="line">为到代理服务器的传出连接配置“TCP keepalive”行为；即应用层复用TCP层的长连接</span><br><span class="line">默认情况下，操作系统的设置对套接字有效；</span><br><span class="line">如果该指令设置为值“on”，则为套接字打开SO_KEEPALIVE套接字选项</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">proxy_send_timeout time;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值</span>	</span><br><span class="line">proxy_send_timeout 60s;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http, server, location</span></span><br><span class="line"></span><br><span class="line">设置将请求传输到代理服务器的超时时间</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">proxy_ignore_client_abort on | off;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值</span></span><br><span class="line">proxy_ignore_client_abort off;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http, server, location</span></span><br><span class="line"></span><br><span class="line">确定当客户端关闭连接而不等待响应时是否应关闭与代理服务器的连接I </span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginx（持续更新）</title>
    <url>/nginx/nginx/</url>
    <content><![CDATA[<h3 id="Nginx处理请求的过程"><a href="#Nginx处理请求的过程" class="headerlink" title="Nginx处理请求的过程"></a>Nginx处理请求的过程</h3><span id="more"></span>

<img src="/load_images/nginx2.png" alt="img" style="zoom:33%;" />

<h3 id="三个常见的应用场景"><a href="#三个常见的应用场景" class="headerlink" title="三个常见的应用场景"></a>三个常见的应用场景</h3><ul>
<li>静态资源服务（Web Server）</li>
<li>反向代理服务</li>
<li>API服务</li>
</ul>
<h3 id="Nginx的核心优势"><a href="#Nginx的核心优势" class="headerlink" title="Nginx的核心优势"></a>Nginx的核心优势</h3><ul>
<li>高并发、高性能</li>
<li>扩展性好（模块化设计）</li>
<li>异步非阻塞的事件驱动模型</li>
</ul>
<h3 id="Nginx进程"><a href="#Nginx进程" class="headerlink" title="Nginx进程"></a>Nginx进程</h3><h4 id="进程结构图-多进程结构"><a href="#进程结构图-多进程结构" class="headerlink" title="进程结构图-多进程结构"></a>进程结构图-多进程结构</h4><img src="/load_images/nginx3.png" alt="img" style="zoom:33%;" />

<p>多进程之间通过共享内存进行通信</p>
<h4 id="使用信号量管理Nginx进程"><a href="#使用信号量管理Nginx进程" class="headerlink" title="使用信号量管理Nginx进程"></a>使用信号量管理Nginx进程</h4><h5 id="常用信号量（kill-l查看信号量）"><a href="#常用信号量（kill-l查看信号量）" class="headerlink" title="常用信号量（kill -l查看信号量）"></a>常用信号量（kill -l查看信号量）</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">SIGCHLD kill -17 $PID</span><br><span class="line">SIGQUIT kill -3 $PID</span><br><span class="line">SIFTERM kill -15 $PID | kill $PID</span><br><span class="line">SIGKILL kill -9 $PID</span><br><span class="line">SIGHUP  kill -1 $PID #重读配置文件</span><br><span class="line">SIGUSR1 kill -10 $PID #重新打开日志文件</span><br><span class="line">SIGUSR2 kill -12 $PID</span><br><span class="line">SIGWINCH kill -28 $PID</span><br></pre></td></tr></table></figure>



<h5 id="master进程"><a href="#master进程" class="headerlink" title="master进程"></a>master进程</h5><img src="/load_images/nginx4.png" alt="img" style="zoom:33%;" />

<h5 id="worker进程（不建议直接对work进程发送信号）"><a href="#worker进程（不建议直接对work进程发送信号）" class="headerlink" title="worker进程（不建议直接对work进程发送信号）"></a>worker进程（不建议直接对work进程发送信号）</h5><img src="/load_images/nginx5.png" alt="img" style="zoom:33%;" />

<h5 id="命令行（命令行的原理也是向master发送信号量实现的）"><a href="#命令行（命令行的原理也是向master发送信号量实现的）" class="headerlink" title="命令行（命令行的原理也是向master发送信号量实现的）"></a>命令行（命令行的原理也是向master发送信号量实现的）</h5><img src="/load_images/nginx6.png" alt="img" style="zoom:33%;" />

<h5 id="发送信号量管理进程"><a href="#发送信号量管理进程" class="headerlink" title="发送信号量管理进程"></a>发送信号量管理进程</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">停止nginx</span></span><br><span class="line">ps -ef | grep nginx</span><br><span class="line">kill -s SIGTERM master_pid #mac中kill -TERM master_pid</span><br><span class="line">ps -ef | grep nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">重新读取配置文件</span></span><br><span class="line">ps -ef | grep nginx</span><br><span class="line">kill -s SIGHUP master_pid #mac中 -HUP</span><br><span class="line">ps -ef | grep nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">杀死worker进程(之后master进程会重新启动一个worker进程)</span></span><br><span class="line">ps -ef | grep nginx</span><br><span class="line">kill -s SIGTERM worker_pid</span><br><span class="line">ps -ef | grep nginx</span><br></pre></td></tr></table></figure>

<h5 id="命令行管理nginx进程"><a href="#命令行管理nginx进程" class="headerlink" title="命令行管理nginx进程"></a>命令行管理nginx进程</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nginx -h</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">-s signal     : send signal to a master process: stop, quit, reopen, reload</span></span><br><span class="line">nginx -s [stop, quit, reopen, reload] #reopen重新打开日志文件 reload重载配置文件</span><br></pre></td></tr></table></figure>

<h5 id="reload重载配置文件的流程"><a href="#reload重载配置文件的流程" class="headerlink" title="reload重载配置文件的流程"></a>reload重载配置文件的流程</h5><ol>
<li><strong>向master进程发送HUP信号（reload命令）</strong></li>
<li><strong>master进程检查配置语法是否正确</strong></li>
<li><strong>master进程打开监听端口（如果配置文件端口变动）</strong></li>
<li><strong>master进程使用新的配置文件启动新的worker子进程</strong></li>
<li><strong>master进程向老的worker子进程发送QUIT信号</strong></li>
<li><strong>旧的worker进程关闭监听句柄，处理完当前连接后关闭进程</strong></li>
</ol>
<img src="/load_images/nginx7.png" alt="img" style="zoom:33%;" />



<h3 id="Nginx热部署"><a href="#Nginx热部署" class="headerlink" title="Nginx热部署"></a>Nginx热部署</h3><p><strong>在不中断当前业务的前提下，对nginx进行平滑升级</strong></p>
<h4 id="热升级流程"><a href="#热升级流程" class="headerlink" title="热升级流程"></a>热升级流程</h4><ol>
<li><strong>将旧的nginx文件替换成新编译的nginx文件（目录结构要相同）</strong></li>
<li><strong>向master进程发送USR2信号</strong></li>
<li><strong>master进程修改pid文件，从nginx.pid加后缀变为nginx.pid.oldbin</strong></li>
<li><strong>master进程用新的nginx文件启动新master进程（这时候旧master和新master并存，两者都可以接受处理用户请求）</strong></li>
<li><strong>向旧的master进程发送WINCH信号，目的是退出旧的worker子进程，不退出旧master进程的目的是为了回滚情形</strong></li>
<li><strong>新功能测试没问题之后，向旧master发送QUIT型号，退出。这时候会自动删除3步骤生成的oldbin后缀名文件</strong></li>
<li><strong>如果需要回滚：向旧master发送HUP，向新的master发送QUIT</strong></li>
</ol>
<img src="/load_images/nginx8.png" alt="img" style="zoom:33%;" />



<h3 id="Nginx模块化管理机制"><a href="#Nginx模块化管理机制" class="headerlink" title="Nginx模块化管理机制"></a>Nginx模块化管理机制</h3><h4 id="模块结构图"><a href="#模块结构图" class="headerlink" title="模块结构图"></a>模块结构图</h4><img src="/load_images/nginx9.png" alt="img" style="zoom:33%;" />

<h4 id="模块体系结构"><a href="#模块体系结构" class="headerlink" title="模块体系结构"></a>模块体系结构</h4><img src="/load_images/nginx10.png" alt="img" style="zoom:33%;" />



<h3 id="编译安装Nginx"><a href="#编译安装Nginx" class="headerlink" title="编译安装Nginx"></a>编译安装Nginx</h3><h4 id="常见配置参数"><a href="#常见配置参数" class="headerlink" title="常见配置参数"></a>常见配置参数</h4><table>
<thead>
<tr>
<th align="center">参数</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">–prefix</td>
<td>指定安装的目录</td>
</tr>
<tr>
<td align="center">–user</td>
<td>运行nginx的worker子进程的属主 属主需要提前设置好</td>
</tr>
<tr>
<td align="center">–group</td>
<td>运行nginx的worker子进程的属组 属组需要提前设置好</td>
</tr>
<tr>
<td align="center">–pid-path</td>
<td>存放进程运行的pid文件的路径</td>
</tr>
<tr>
<td align="center">–conf-path</td>
<td>配置文件nginx.conf的存放路径</td>
</tr>
<tr>
<td align="center">–error-log-path</td>
<td>错误日志error.log的存放路径</td>
</tr>
<tr>
<td align="center">–http-log-path</td>
<td>访问日志access.log的存放路径</td>
</tr>
<tr>
<td align="center">–with-pcre</td>
<td>pcre库的存放路径，正则表达式会用到</td>
</tr>
<tr>
<td align="center">–with-zlib</td>
<td>zlib库的存放路径，gzip模块会用到</td>
</tr>
</tbody></table>
<h4 id="内置参数默认原则"><a href="#内置参数默认原则" class="headerlink" title="内置参数默认原则"></a>内置参数默认原则</h4><p>–with 显示加上，默认不内置</p>
<p>–without 显示去掉，默认内置</p>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><h4 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h4><img src="/load_images/nginx11.png" alt="img" style="zoom:33%;" />

<h4 id="虚拟主机分类"><a href="#虚拟主机分类" class="headerlink" title="虚拟主机分类"></a>虚拟主机分类</h4><ul>
<li><strong>基于多IP的虚拟主机</strong></li>
<li><strong>基于多端口的虚拟主机</strong></li>
<li><strong>基于域名的虚拟主机</strong></li>
</ul>
<h5 id="基于多IP"><a href="#基于多IP" class="headerlink" title="基于多IP"></a>基于多IP</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改网卡接口绑定的IP地址</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">重启网络</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改nginx配置文件server段listen 监听对应ip和端口</span></span><br><span class="line">server&#123;</span><br><span class="line">	listen 192.168.184.240;</span><br><span class="line">	server_name localhost;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server&#123;</span><br><span class="line">	listen 192.168.184.241;</span><br><span class="line">	server_name localhost;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">nginx -t查看配置文件是有报错，之后重启nginx</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">浏览器访问对应ip和端口看下效果</span></span><br></pre></td></tr></table></figure>

<h5 id="基于多端口"><a href="#基于多端口" class="headerlink" title="基于多端口"></a>基于多端口</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">	listen 8080;</span><br><span class="line">	server_name localhost;</span><br><span class="line">	</span><br><span class="line">	location / &#123;</span><br><span class="line">		root html/virtual_host1;</span><br><span class="line">		index index.html index.htm;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server&#123;</span><br><span class="line">	listen 8081;</span><br><span class="line">	server_name localhost;</span><br><span class="line">	</span><br><span class="line">	location / &#123;</span><br><span class="line">		root html/virtual_host2;</span><br><span class="line">		index index.html index.htm;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">nginx -t查看配置文件是有报错，之后重启nginx</span></span><br></pre></td></tr></table></figure>

<h5 id="基于域名的虚拟机"><a href="#基于域名的虚拟机" class="headerlink" title="基于域名的虚拟机"></a>基于域名的虚拟机</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name local.test1.com;</span><br><span class="line">	</span><br><span class="line">	location / &#123;</span><br><span class="line">		root html/domain_host1;</span><br><span class="line">		index index.html index.htm;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server&#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name local.test2.com;</span><br><span class="line">	</span><br><span class="line">	location / &#123;</span><br><span class="line">		root html/domain_host2;</span><br><span class="line">		index index.html index.htm;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="配置文件main段核心参数用法"><a href="#配置文件main段核心参数用法" class="headerlink" title="配置文件main段核心参数用法"></a>配置文件main段核心参数用法</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">user USERNAME [GROUP]</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">指定运行nginx的worker子进程的属主和属组，其中属组可以不指定</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例</span></span><br><span class="line">user nginx nginx;</span><br><span class="line"></span><br><span class="line">pid DIR</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">指定运行nginx的master主进程的pid文件存放路径</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例</span></span><br><span class="line">pid /usr/local/var/run/nginx.pid</span><br><span class="line"></span><br><span class="line">worker_rlimit_nofile number</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">指定worker子进程可以打开的最大文件句柄数</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例</span></span><br><span class="line">worker_rlimit_nofile 20480;</span><br><span class="line"></span><br><span class="line">worker_rlimit_core size</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">指定worker子进程异常终止后的core文件，用于记录分析问题</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例</span></span><br><span class="line">worker_rlimit_core 50M;</span><br><span class="line">working_directory /usr/local/var/log/nginx/tmp; #此目录对nginx要有写权限</span><br><span class="line"></span><br><span class="line">worker_processes number | auto;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">指定nginx启动的worker子进程数量</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例</span></span><br><span class="line">worker_processes 4;</span><br><span class="line">worker_processes auto;</span><br><span class="line"></span><br><span class="line">worker_cpu_affinity cpumask1 cpumask2...</span><br><span class="line">worker_cpu_affinity auto [cpumask];</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">将每个worker子进程与CPU物理核心绑定</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例</span></span><br><span class="line">worker_cpu_affinity 0001 0010 0100 1000;#4个物理核心，4个worker子进程</span><br><span class="line">worker_cpu_affinity 00000001 00000010 00001000 00010000 00100000 01000000 10000000; #8个物理核心，8个worker子进程</span><br><span class="line">worker_cpu_affinity 01 10 01 10; #2个物理核心，4个子进程</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">备注：将每个worker子进程与特定CPU物理核心绑定，优势在于：避免同一个worker子进程在不同的CPU核心上切换，缓存失效，降低性能；其实并不能真正的避免进程切换</span></span><br><span class="line"></span><br><span class="line">worker_priority number</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">执行worker子进程的<span class="built_in">nice</span>值，以调整运行nginx的优先级，通常设定为负值，以优先调用nginx</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例</span></span><br><span class="line">worker_priority -10; #优先级计算120-10=110，worker子进程的优先级为110</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">备注：Linux默认进程的优先级值是120，值越小越有限；<span class="built_in">nice</span>设定范围为-20到+19</span></span><br><span class="line"></span><br><span class="line">worker_shutdown_timeout time</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">指定worker子进程优雅退出时的超时时间</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例</span></span><br><span class="line">worker_shutdown_timeout 5s;</span><br><span class="line"></span><br><span class="line">timer_resolution time</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">worker子进程内部使用的计时器精度，调整时间间隔越大，系统调用越少，有利于性能提升；反之，系统调用越多，性能下降</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例</span></span><br><span class="line">timer_resolution 100ms;</span><br><span class="line"></span><br><span class="line">daemon on|off</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">设定nginx的运行方式，前台还是后台，前台用户调试，后台用于生产</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例</span></span><br><span class="line">daemon off;</span><br><span class="line"></span><br><span class="line">lock_file file</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">负载均衡互斥锁文件存放路径</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认配置：lock_file logs/nginx.lock</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">推荐配置：lock_file logs/nginx.lock</span></span><br></pre></td></tr></table></figure>

<h5 id="worker子进程与CPU核心绑定"><a href="#worker子进程与CPU核心绑定" class="headerlink" title="worker子进程与CPU核心绑定"></a>worker子进程与CPU核心绑定</h5><img src="/load_images/nginx12.png" alt="img" style="zoom:33%;" />

<h5 id="客户端请求处理流程"><a href="#客户端请求处理流程" class="headerlink" title="客户端请求处理流程"></a>客户端请求处理流程</h5><img src="/load_images/nginx13.png" alt="img" style="zoom:33%;" />

<h5 id="配置错误解决"><a href="#配置错误解决" class="headerlink" title="配置错误解决"></a>配置错误解决</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nginx: [emerg] getpwnam(&quot;nginx&quot;) failed in /usr/local/etc/nginx/nginx.conf:2</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">配置文件中user指定的属主，属组在系统中没有，需要创建</span></span><br></pre></td></tr></table></figure>

<h4 id="配置文件event段核心参数用法"><a href="#配置文件event段核心参数用法" class="headerlink" title="配置文件event段核心参数用法"></a>配置文件event段核心参数用法</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">use method</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">nginx使用何种事件驱动模型 method值：select、poll、kqueue、epoll、/dev/poll、eventport</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认配置：无</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">推荐不指定，让nginx自己选择</span></span><br><span class="line"></span><br><span class="line">worker_connections number</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">worker子进程能够处理的最大并发连接数</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认配置：worker_connections 1024</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">推荐配置；worker_connections 65535/worker_processes | 65535</span></span><br><span class="line"></span><br><span class="line">accept_mutex on | off</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">是否打开负载均衡互斥锁</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认配置 off</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">推荐配置 on 开启时，后台会生成一个负载均衡锁，负载均衡锁会轮流的将请求由master process发送给子进程</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果accept_mutex的值被设为off，那么当有请求需要处理时，所有的worker进程都会从waiting状态中唤醒，</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">但是只有一个worker进程能处理请求，这造成了thundering herd现象，这个现象每一秒钟会发生多次。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">它使服务器的性能下降，因为所有被唤醒的worker进程在重新进入waiting状态前会占用一段CPU时间</span></span><br><span class="line"></span><br><span class="line">accept_mutex_delay time</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">需要开启accept_mutex才会生效</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认配置 accept_mutex_delay 500ms</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">推荐配置 accept_mutex_delay 200ms</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">当accept_mutex功能启用后，只有一个持有mutex锁的worker进程会接受并处理请求，其他worker进程等待。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">accept_mutex_delay指定的时间就是这些worker进程的等待时间，过了等待时间下一个worker进程便取得mutex锁，处理请求。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">muti_accept on | off</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">worker子进程可以接收的新连接个数</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认配置：multi_accept off</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">推荐配置：multi_accept on 打开后，worker进程会一次性接受监听队列中的所有请求，然后处理</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果web服务器面对的是一个持续的请求流，那么启用multi_accept可能会造成worker进程一次接受的请求大于worker_connections指定可以接受的请求数。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">这就是overflow，这个overflow会造成性能损失，overflow这部分的请求不会受到处理</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="server-name"><a href="#server-name" class="headerlink" title="server_name"></a>server_name</h4><h5 id="指令的用法"><a href="#指令的用法" class="headerlink" title="指令的用法"></a>指令的用法</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">需要在hosts文件中配置DNS</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法结构</span></span><br><span class="line">server_name name1 name2 name3 ...;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例1 精确匹配</span></span><br><span class="line">server_name local.test.com;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例2</span></span><br><span class="line">server_name *.test.com; #左侧通配符匹配</span><br><span class="line">server_name local.test.*; #右侧通配符匹配</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例3</span></span><br><span class="line">server_name local.test.com *.test.com;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例4</span></span><br><span class="line">server_name ~^local\.test\..*$ #正则表达式匹配</span><br></pre></td></tr></table></figure>

<h5 id="指令用法优先级"><a href="#指令用法优先级" class="headerlink" title="指令用法优先级"></a>指令用法优先级</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">多域名如何匹配</span></span><br><span class="line">server&#123;</span><br><span class="line">	server_name local.test.com;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server&#123;</span><br><span class="line">	server_name *.test.com;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server&#123;</span><br><span class="line">	server_name local.test.*;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server&#123;</span><br><span class="line">	server_name ~^local\.test\..*$;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">问题：访问local.test.com，这几个server都能够匹配，那么到底访问哪个server呢？</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">这就涉及到指令写法的优先级</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">优先级从高到底依次为：精确匹配、左侧通配符匹配、右侧通配符匹配、正则表达式匹配</span></span><br></pre></td></tr></table></figure>

<h4 id="root和alias"><a href="#root和alias" class="headerlink" title="root和alias"></a>root和alias</h4><h5 id="root指令"><a href="#root指令" class="headerlink" title="root指令"></a>root指令</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root path;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值：root html;</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文:	http, server, location, <span class="keyword">if</span> <span class="keyword">in</span> location</span></span><br></pre></td></tr></table></figure>

<h5 id="alias指令"><a href="#alias指令" class="headerlink" title="alias指令"></a>alias指令</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">alias path;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值：无</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：location</span></span><br></pre></td></tr></table></figure>

<h5 id="root和alias的相同点和区别"><a href="#root和alias的相同点和区别" class="headerlink" title="root和alias的相同点和区别"></a>root和alias的相同点和区别</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">相同点</span></span><br><span class="line">URI到磁盘文件的映射</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">区别</span></span><br><span class="line">root会将定义路径与URI叠加；alias则只取定义路径</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例</span></span><br><span class="line">location /picture &#123;</span><br><span class="line">	root /usr/local/Celler/nginx/1.23.1/html/picture;</span><br><span class="line">&#125;</span><br><span class="line">客户端请求local.test.com/picture/1.jpg，则对应磁盘映射路径/usr/local/Celler/nginx/1.23.1/html/picture/picture/1.jpg </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">root会把URI叠加上去，所以root只需要写成root /usr/local/Celler/nginx/1.23.1/html即可</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">可以通过error.log查看错误信息</span></span><br><span class="line"></span><br><span class="line">location /picture &#123;</span><br><span class="line">	alias /usr/local/Celler/nginx/1.23.1/html/picture/; #使用alias，末尾一定加/</span><br><span class="line">&#125;</span><br><span class="line">客户端请求local.test.com/picture/1.jpg，则对应磁盘映射路径/usr/local/Celler/nginx/1.23.1/html/picture/1.jpg #alias不会把URI叠加上去</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">注意事项</span></span><br><span class="line">使用alias，末尾一定加/</span><br><span class="line">alias只能位于location块中</span><br></pre></td></tr></table></figure>

<h4 id="location基础用法"><a href="#location基础用法" class="headerlink" title="location基础用法"></a>location基础用法</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法结构</span></span><br><span class="line">location [ = | ~ | ~* | ^~ ] uri &#123; ... &#125;</span><br><span class="line">location @name &#123; ... &#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：server, location</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>匹配规则</th>
<th>含义</th>
<th>示例</th>
<th>优先级</th>
</tr>
</thead>
<tbody><tr>
<td>&#x3D;</td>
<td>精确匹配</td>
<td>location &#x3D; &#x2F;images&#x2F;{ … }</td>
<td>最高</td>
</tr>
<tr>
<td>^~</td>
<td>匹配到即停止搜索</td>
<td>location ^~ &#x2F;images&#x2F; { … }</td>
<td></td>
</tr>
<tr>
<td>~</td>
<td>正则匹配，区分大小写</td>
<td>location ~ .(jpg|gif)$ { … }</td>
<td></td>
</tr>
<tr>
<td>~*</td>
<td>正则匹配，不区分大小写</td>
<td>location ~* .{jpg|gif}$ { … }</td>
<td></td>
</tr>
<tr>
<td>不带任何符号</td>
<td></td>
<td>location &#x2F; { … }</td>
<td>最低</td>
</tr>
</tbody></table>
<h5 id="官网示例"><a href="#官网示例" class="headerlink" title="官网示例"></a>官网示例</h5><p><a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#location">http://nginx.org/en/docs/http/ngx_http_core_module.html#location</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Let’s illustrate the above by an example:</span><br><span class="line"></span><br><span class="line">location = / &#123;</span><br><span class="line">    [ configuration A ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location / &#123;</span><br><span class="line">    [ configuration B ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location /documents/ &#123;</span><br><span class="line">    [ configuration C ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location ^~ /images/ &#123;</span><br><span class="line">    [ configuration D ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location ~* \.(gif|jpg|jpeg)$ &#123;</span><br><span class="line">    [ configuration E ]</span><br><span class="line">&#125;</span><br><span class="line">The “/” request will match configuration A, #A和B都能匹配到，但是=的优先级高，所以最终匹配的是A</span><br><span class="line">the “/index.html” request will match configuration B, #A和B都能匹配到，但是A是完全精确匹配，只有在完全匹配/的时候才会走A，所以这里匹配的是B</span><br><span class="line">the “/documents/document.html” request will match configuration C, #B和C都能匹配到，但是C匹配的更精准</span><br><span class="line">the “/images/1.gif” request will match configuration D, #D和E都能匹配到，但是^~优先级比~*高，所以匹配D</span><br><span class="line">and the “/documents/1.jpg” request will match configuration E. #C和E都能匹配到，但是~*优先级比E高，所以匹配E</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">在都能匹配到的情况下，最终匹配优先级高的</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">注意</span></span><br><span class="line">/test/ &#123; ... &#125;和^~ /test/ &#123; ... &#125; 这两种写法同时出现会存在冲突，nginx认为这两个配置是重复的</span><br></pre></td></tr></table></figure>

<h5 id="location中URL结尾的反斜线"><a href="#location中URL结尾的反斜线" class="headerlink" title="location中URL结尾的反斜线"></a>location中URL结尾的反斜线</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">不带/</span></span><br><span class="line">location /test &#123; ... &#125; </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">处理规则：</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">先将<span class="built_in">test</span>作为一个目录，去root定义的目录找<span class="built_in">test</span>文件夹</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">test</span>目录存在：根据index配置去找对应文件，如果index没有配置，默认去找index.html；找不到对应文件，返回403</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">test</span>目录不存在：将<span class="built_in">test</span>作为一个文件，如果文件存在，将文件内容返回，Chrome可能存在问题，可以换个浏览器</span></span><br><span class="line"></span><br><span class="line">location /test/ &#123; ... &#125; </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">处理规则：</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">直接将<span class="built_in">test</span>作为一个目录，去root定义的目录找<span class="built_in">test</span>文件夹，如果没有这个文件夹，不会将<span class="built_in">test</span>作为文件处理，返回404</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">test</span>目录存在：根据index配置去找对应文件，如果index没有配置，默认去找index.html；找不到对应文件，返回403</span></span><br></pre></td></tr></table></figure>

<h4 id="stub-status模块的用法"><a href="#stub-status模块的用法" class="headerlink" title="stub_status模块的用法"></a>stub_status模块的用法</h4><p><strong>nginx监控页面的模块</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法结构</span></span><br><span class="line">stub_status;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">低于1.7.5版本：stub_status on;</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值:	—</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文:	server, location</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例</span></span><br><span class="line">location /uri &#123; #uri要具有保密性，防止暴露服务器信息</span><br><span class="line">	stub_status;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">注意：要想使用此指令，需要在编译Nginx的时候指定-with-http_stub_status_module</span></span><br></pre></td></tr></table></figure>

<h5 id="状态信息"><a href="#状态信息" class="headerlink" title="状态信息"></a>状态信息</h5><table>
<thead>
<tr>
<th>状态项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>Active Connections</td>
<td>活跃的连接数量</td>
</tr>
<tr>
<td>accepts</td>
<td>接受的客户端连接总数量</td>
</tr>
<tr>
<td>handled</td>
<td>处理的客户端连接总数量</td>
</tr>
<tr>
<td>requests</td>
<td>客户端总的请求数量</td>
</tr>
<tr>
<td>Reading</td>
<td>读取客户端的连接数</td>
</tr>
<tr>
<td>Writing</td>
<td>相应数据到客户端的连接数</td>
</tr>
<tr>
<td>Waiting</td>
<td>空闲客户端请求连接数量</td>
</tr>
</tbody></table>
<h5 id="内嵌变量"><a href="#内嵌变量" class="headerlink" title="内嵌变量"></a>内嵌变量</h5><table>
<thead>
<tr>
<th>变量名</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>$connections_active</td>
<td>同Active connections值</td>
</tr>
<tr>
<td>$connections_reading</td>
<td>同Reading值</td>
</tr>
<tr>
<td>$connections_writing</td>
<td>同Writing值</td>
</tr>
<tr>
<td>$connections_waiting</td>
<td>同Waiting值</td>
</tr>
</tbody></table>
<h5 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name local.test.com;</span><br><span class="line">	root html;</span><br><span class="line">	location /stub_status &#123;</span><br><span class="line">		stub_status;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">浏览器访问local.test.com/stub_status</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">页面结果展示（刷新页面数据会变动）：</span></span><br><span class="line">Active connections: 2 </span><br><span class="line">server accepts handled requests</span><br><span class="line"> 26 26 81 </span><br><span class="line">Reading: 0 Writing: 1 Waiting: 1 </span><br></pre></td></tr></table></figure>

<h3 id="HTTP核心模块"><a href="#HTTP核心模块" class="headerlink" title="HTTP核心模块"></a>HTTP核心模块</h3><h4 id="connection和request"><a href="#connection和request" class="headerlink" title="connection和request"></a>connection和request</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">基本含义</span></span><br><span class="line">connection是连接，即常说的tcp连接，三次握手，状态机</span><br><span class="line">request是请求，例如http请求，无状态协议</span><br><span class="line">request是必须建立在connection之上</span><br></pre></td></tr></table></figure>

<h4 id="limit-conn限制connection的模块"><a href="#limit-conn限制connection的模块" class="headerlink" title="limit_conn限制connection的模块"></a>limit_conn限制connection的模块</h4><ul>
<li>作用是限制客户端并发连接数</li>
<li>默认编译进Nginx，通过–without-http_limit_conn_module禁用</li>
<li>使用共享内存，对所有worker子进程生效</li>
</ul>
<h5 id="常用指令"><a href="#常用指令" class="headerlink" title="常用指令"></a>常用指令</h5><ul>
<li><strong>limit_conn_zone</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">limit_conn_zone key zone=name:size;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">说明：key 可以是文本、变量或文本与变量的组合；name需要全局唯一。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值：无</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">官网示例：对用户IP进行并发计数，将计数内存区命名为addr，设置计数内存区大小为10MB</span></span><br><span class="line">limit_conn_zone $binary_remote_addr zone=addr:10m;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">官网示例说明</span></span><br><span class="line">Note that instead of $remote_addr, the $binary_remote_addr variable is used here. </span><br><span class="line">The $remote_addr variable’s size can vary from 7 to 15 bytes. The stored state occupies either 32 or 64 bytes of memory on 32-bit platforms and always 64 bytes on 64-bit platforms. </span><br><span class="line">The $binary_remote_addr variable’s size is always 4 bytes for IPv4 addresses or 16 bytes for IPv6 addresses. The stored state always occupies 32 or 64 bytes on 32-bit platforms and 64 bytes on 64-bit platforms. </span><br><span class="line">One megabyte(兆字节) zone can keep about 32 thousand 32-byte states or about 16 thousand 64-byte states. If the zone storage is exhausted, the server will return the error to all further requests.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例：限制同一server最大并发数</span></span><br><span class="line">limit_conn_zone $server_name zone=perserver:10m;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>limit_conn_status</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">limit_conn_status code;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值</span>	</span><br><span class="line">limit_conn_status 503;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http, server, location</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">说明：指定nginx回复那些被禁用的连接请求时的状态码，默认情况下是503（Service Unavailable 服务不可用）。当限制行为发生的时候，返回的状态码</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">状态码必须在400到599之间</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>limit_conn_log_level</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">limit_conn_log_level info | notice | warn | error;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值</span></span><br><span class="line">limit_conn_log_level error;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http, server, location</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">说明：为服务器限制连接数的情况设置所需的日志记录级别。当限制行为发生的时候，记录日志。</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>limit_conn</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">limit_conn zone number;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值：无</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http, server, location</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Sets the shared memory zone and the maximum allowed number of connections <span class="keyword">for</span> a given key value. When this <span class="built_in">limit</span> is exceeded, the server will <span class="built_in">return</span> the error <span class="keyword">in</span> reply to a request</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例：每个IP地址，一次只允许一个连接</span></span><br><span class="line">limit_conn_zone $binary_remote_addr zone=addr:10m;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    location /download/ &#123;</span><br><span class="line">        limit_conn addr 1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="limit-req限制request的模块"><a href="#limit-req限制request的模块" class="headerlink" title="limit_req限制request的模块"></a>limit_req限制request的模块</h4><ul>
<li>用于限制客户端处理请求的平均速率</li>
<li>默认编译进Nginx，通过–without-http_limit_req_module禁用</li>
<li>使用共享内存，对所有worker子进程生效</li>
<li>限流算法：leaky_bucket</li>
</ul>
<img src="/load_images/nginx14.png" alt="img" style="zoom: 50%;" />

<h5 id="常用指令-1"><a href="#常用指令-1" class="headerlink" title="常用指令"></a>常用指令</h5><ul>
<li><strong>limit_req_zone</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">limit_req_zone key zone=name:size rate=rate [sync];</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值：无</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例</span></span><br><span class="line">limit_req_zone $binary_remote_addr zone=one:10m rate=1r/s; #每秒一个请求</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">限制客户端请求平均速率为2r/m，每分钟2个请求，即每30秒处理一个请求，不会在第一个30秒内处理两个请求，即使第一个请求很快处理完。</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>limit_req_status</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">limit_req_status code;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值</span></span><br><span class="line">limit_req_status 503;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http、server、location</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>limit_req_log_level</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">limit_req_log_level info | notice | warn | error;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值</span></span><br><span class="line">limit_req_log_level error;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http, server, location</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>limit_req</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">limit_req zone=name [burst=number] [nodelay | delay=number];</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值：无</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http, server, location</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例：平均每秒允许不超过1个请求，突发不超过5个请求</span></span><br><span class="line">limit_req_zone $binary_remote_addr zone=one:10m rate=1r/s;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">	error_log logs/one.log info;</span><br><span class="line">    location /search/ &#123;</span><br><span class="line">		limit_req_status 504;</span><br><span class="line">		limit_req_log_level notice;</span><br><span class="line">		limit_req zone=one burst=5;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="access模块"><a href="#access模块" class="headerlink" title="access模块"></a>access模块</h4><p>限制特定IP或网段访问</p>
<h5 id="指令集"><a href="#指令集" class="headerlink" title="指令集"></a>指令集</h5><ul>
<li><strong>allow</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">allow address | CIDR | unix: | all;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值：无</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http, server, location, limit_except</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>deny</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">deny address | CIDR | unix: | all;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值：无</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http, server, location, limit_except</span></span><br></pre></td></tr></table></figure>

<h5 id="组合示例"><a href="#组合示例" class="headerlink" title="组合示例"></a>组合示例</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    deny  192.168.1.1;</span><br><span class="line">    allow 192.168.1.0/24; #除了192.168.1.1以外，都能访问，如果两行互换位置，那么deny不会生效，因为allow的范围包含了192.168.1.1</span><br><span class="line">    </span><br><span class="line">    allow 10.1.1.0/16;</span><br><span class="line">    </span><br><span class="line">    allow 2001:0db8::/32;</span><br><span class="line">    </span><br><span class="line">    deny  all; #除上面allow的地址以外都拒绝掉</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Auth-basic模块"><a href="#Auth-basic模块" class="headerlink" title="Auth_basic模块"></a>Auth_basic模块</h4><p>限制特定用户访问</p>
<h5 id="基本功能"><a href="#基本功能" class="headerlink" title="基本功能"></a>基本功能</h5><ul>
<li>基于HTTP Basic Authentication协议进行用户名密码认证</li>
<li>默认已编译进Nginx，通过–without-http_auth_basic_module禁用</li>
</ul>
<h5 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h5><ul>
<li>auth_basic</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">auth_basic string | off;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值</span></span><br><span class="line">auth_basic off;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http, server, location, limit_except</span></span><br></pre></td></tr></table></figure>

<ul>
<li>auth_basic_user_file</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法：auth_basic_user_file file;</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值：无</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http, server, location, limit_except</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">官网说明</span></span><br><span class="line">file为用户名密码保存的文件，file可以是一个变量</span><br><span class="line">file文件内容格式：</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">comment</span></span><br><span class="line">name1:password1</span><br><span class="line">name2:password2:comment</span><br><span class="line">name3:password3</span><br><span class="line"></span><br><span class="line">The following password types are supported:</span><br><span class="line">· encrypted with the crypt() function; can be generated using the “htpasswd” utility from the Apache HTTP Server distribution or the “openssl passwd” command;</span><br><span class="line">· hashed with the Apache variant of the MD5-based password algorithm (apr1); can be generated with the same tools;</span><br><span class="line">· specified by the “&#123;scheme&#125;data” syntax (1.0.3+) as described in RFC 2307; currently implemented schemes include PLAIN (an example one, should not be used), SHA (1.3.13) (plain SHA-1 hashing, should not be used) and SSHA (salted SHA-1 hashing, used by some software packages, notably OpenLDAP and Dovecot).</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="用法示例"><a href="#用法示例" class="headerlink" title="用法示例"></a>用法示例</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    auth_basic           &quot;closed site&quot;;</span><br><span class="line">    auth_basic_user_file conf/htpasswd;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">注意：</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认去nginx配置文件目录下去找auth_basic_user_file指定的密码文件</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">（如mac电脑，去/usr/local/etc/nginx/conf/htpasswd，其中conf/htpasswd是auth_basic_user_file指令指定的）</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">除非使用绝对路径指定新目录</span></span><br></pre></td></tr></table></figure>

<h5 id="生成密码文件工具"><a href="#生成密码文件工具" class="headerlink" title="生成密码文件工具"></a>生成密码文件工具</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">htpasswd</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">所属软件包：httpd_tools</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">生成新密码文件：</span></span><br><span class="line">htpasswd -c encrypt_pass #encrypt_pass密码文件名</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">添加新用户密码：</span></span><br><span class="line">htpasswd -b encrypt_pass mike 123456 #向encrypt_pass文件添加新用户密码</span><br></pre></td></tr></table></figure>

<h4 id="auth-request模块"><a href="#auth-request模块" class="headerlink" title="auth_request模块"></a>auth_request模块</h4><h5 id="基本功能-1"><a href="#基本功能-1" class="headerlink" title="基本功能"></a>基本功能</h5><ul>
<li>基于子请求收到的HTTP响应码做访问控制</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">官网说明</span></span><br><span class="line">If the subrequest returns a 2xx response code, the access is allowed. </span><br><span class="line">If it returns 401 or 403, the access is denied with the corresponding error code. </span><br><span class="line">Any other response code returned by the subrequest is considered an error.</span><br><span class="line"></span><br><span class="line">For the 401 error, the client also receives the “WWW-Authenticate” header from the subrequest response.</span><br></pre></td></tr></table></figure>

<img src="/load_images/nginx15.png" alt="img" style="zoom:50%;" />

<ul>
<li>默认没有编译进Nginx，通过–with-http_auth_request_module启用</li>
</ul>
<h5 id="指令-1"><a href="#指令-1" class="headerlink" title="指令"></a>指令</h5><p>根据子请求的结果启用授权，并设置子请求将发送到的URI。</p>
<ul>
<li>auth_request</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法auth_request uri | off;</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值</span></span><br><span class="line">auth_request off;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http, server, location</span></span><br></pre></td></tr></table></figure>

<ul>
<li>auth_request_set</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">auth_request_set $variable value;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值：无</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http, server, location</span></span><br></pre></td></tr></table></figure>

<h5 id="用法示例-1"><a href="#用法示例-1" class="headerlink" title="用法示例"></a>用法示例</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">官网示例</span></span><br><span class="line">location /private/ &#123;</span><br><span class="line">    auth_request /auth;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location = /auth &#123;</span><br><span class="line">    proxy_pass http://127.0.0.1:8080/verify;</span><br><span class="line">    proxy_pass_request_body off;</span><br><span class="line">    proxy_set_header Content-Length &quot;&quot;;</span><br><span class="line">    proxy_set_header X-Original-URI $request_uri;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">本地示例</span></span><br><span class="line">server &#123;</span><br><span class="line">	listen 82;</span><br><span class="line">	server_name localhost;</span><br><span class="line"></span><br><span class="line">    root html;</span><br><span class="line"></span><br><span class="line">    location /oa/ &#123;</span><br><span class="line">    	auth_request /auth;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location = /auth &#123;</span><br><span class="line">    	return 200 &quot;test auth_request&quot;;</span><br><span class="line">    	#return 403;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="rewrite模块"><a href="#rewrite模块" class="headerlink" title="rewrite模块"></a>rewrite模块</h4><h5 id="指令-2"><a href="#指令-2" class="headerlink" title="指令"></a>指令</h5><ul>
<li><strong>return指令</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">return code [text]; #code为2xx时，text才会在body中返回</span><br><span class="line">return code URL; #用于重定向，code为3xx</span><br><span class="line">return URL; #URL应以“http://”、“https://”或“$scheme”字符串开头</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值：无</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：server, location, <span class="keyword">if</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">说明</span></span><br><span class="line">停止处理请求，直接向客户端返回响应码或重定向到其他URL（非标准code 444 关闭连接而不发送响应头）</span><br><span class="line">执行return指令后，location中后续指令将不会被执行</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例</span></span><br><span class="line">location / &#123;</span><br><span class="line">	......</span><br><span class="line">	return 404;</span><br><span class="line">	......</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">本地示例</span></span><br><span class="line">server &#123;</span><br><span class="line">	listen 81;</span><br><span class="line">	root html;</span><br><span class="line">	</span><br><span class="line">	location / &#123;</span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash"><span class="built_in">return</span> 200;</span></span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash"><span class="built_in">return</span> 200 <span class="string">&quot;sucess&quot;</span>;</span></span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash"><span class="built_in">return</span> 302 /test;</span></span><br><span class="line">		return http://localhost:82/;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	location /test &#123;</span><br><span class="line">		index test.html;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">	listen 82;</span><br><span class="line">	root html;</span><br><span class="line"></span><br><span class="line">	location / &#123;</span><br><span class="line">		index index.html;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">命令行curl http://localhost:81 -I 查看响应头部</span></span><br></pre></td></tr></table></figure>



<h5 id="重定向状态码"><a href="#重定向状态码" class="headerlink" title="重定向状态码"></a>重定向状态码</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">HTTP 1.0标准</span><br><span class="line">	· 301 : 永久重定向</span><br><span class="line">	· 302 : 临时重定向，禁止被缓存</span><br><span class="line"></span><br><span class="line">HTTP 1.1标准</span><br><span class="line">	· 303 : 临时重定向，禁止缓存，允许改变方法</span><br><span class="line">	· 307 : 临时重定向，禁止缓存，不允许改变方法</span><br><span class="line">	· 308 : 永久重定向，不允许改变方法</span><br></pre></td></tr></table></figure>

<p>永久重定向和临时重定向</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">· 永久重定向  假如访问a.com时永久重定向到了b.com，浏览器在收到响应后，显示b.com的内容</span><br><span class="line">  下一次访问a.com时浏览器会直接跳转到 b.com，不会再请求a.com（本地cache）</span><br><span class="line"></span><br><span class="line">· 临时重定向  假如访问a.com时临时重定向到了b.com，浏览器在收到响应后，显示的是b.com的内容；</span><br><span class="line">  下一次当你请求a.com时浏览器还会先请求a.com，然后再重定向到b.com</span><br></pre></td></tr></table></figure>



<ul>
<li><strong>rewrite指令</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">rewrite regex replacement [flag];</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值：无</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：server, location, <span class="keyword">if</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">rewrite指令按照他们在配置文件中出现的顺序依次执行</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">可以使用flag终止对指令进一步处理</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果替换字符串以http://、https://、<span class="variable">$scheme</span>开头，那么会停止处理，并将重定向返回给客户端</span></span><br></pre></td></tr></table></figure>

<p>flag参数说明</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">· last 本条规则匹配完之后，继续匹配location</span><br><span class="line">· break 本条规则匹配完之后，直接去对应replacement替换字符串位置查找文件，不再继续匹配location</span><br><span class="line">· redirect 如果replacement不是以http://、https://、$scheme开头，返回302临时重定向 </span><br><span class="line">· permanent 返回301永久重定向</span><br></pre></td></tr></table></figure>

<p>示例</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">	listen 82;</span><br><span class="line">	root html/test;</span><br><span class="line">	</span><br><span class="line">	location / &#123;</span><br><span class="line">		index test.html;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	location /images &#123;</span><br><span class="line">		rewrite /images/(.*) /pics/$1; #$1代表正则第一个匹配的数据</span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">rewrite /images/(.*) /pics/<span class="variable">$1</span> last;</span></span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">rewrite /images/(.*) /pics/<span class="variable">$1</span> <span class="built_in">break</span>;</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	location /pics &#123;</span><br><span class="line">		rewrite /pics/(.*) /photos/$1;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	location /photos &#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li><strong>return和rewrite执行顺序</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">return</span>和rewrite按顺序执行</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例1</span></span><br><span class="line">location /images &#123;</span><br><span class="line">		rewrite /images/(.*) /pics/$1; #rewrite没有flag标识</span><br><span class="line">		return 200 &quot;return 200 in /images&quot;;</span><br><span class="line">&#125;</span><br><span class="line">location /pics &#123;</span><br><span class="line">  index index.html;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">访问127.0.0.1:82/images/index.html</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">执行过程：先匹配到rewrite，由于没有flag，所以顺序执行<span class="built_in">return</span>，结果<span class="string">&quot;return 200 in /images&quot;</span>；</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例2</span></span><br><span class="line">location /images &#123;</span><br><span class="line">		rewrite /images/(.*) /pics/$1 last|break; #rewrite的flag为last</span><br><span class="line">		return 200 &quot;return 200 in /images&quot;;</span><br><span class="line">&#125;</span><br><span class="line">location /pics &#123;</span><br><span class="line">  index index.html; #index.html内容为pics test server</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">访问127.0.0.1:82/images/index.html</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">flag为last 执行过程：先匹配到rewrite，由于flag为last，所以继续匹配location到/pics，结果为pics <span class="built_in">test</span> server；</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">flag为<span class="built_in">break</span> 执行过程：先匹配到rewrite，由于flag为<span class="built_in">break</span>，不会继续匹配location，直接查找/pics/index.html文件，结果为pics <span class="built_in">test</span> server；</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例3</span></span><br><span class="line">location /images &#123;</span><br><span class="line">		rewrite /images/(.*) /pics/$1 last;</span><br><span class="line">		return 200 &quot;return 200 in /images&quot;;</span><br><span class="line">&#125;</span><br><span class="line">location /pics &#123;</span><br><span class="line">	rewrite /pics/(.*) /photos/$1 last;</span><br><span class="line">  return 200 &quot;return 200 in /pics&quot;;</span><br><span class="line">&#125;</span><br><span class="line">location /photos &#123;</span><br><span class="line">  return 200 &quot;return 200 in /photos&quot;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">访问127.0.0.1:82/images/index.html</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">flag都为last，结果<span class="string">&quot;return 200 in /photos&quot;</span>；</span> </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例4</span></span><br><span class="line">location /photos &#123;</span><br><span class="line">  return 200 &quot;return 200 in /photos&quot;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">访问127.0.0.1:82/photos/index.html</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">结果<span class="string">&quot;return 200 in /photos&quot;</span>；原因：如果有<span class="built_in">return</span>的话，返回的时候就会优先执行<span class="built_in">return</span>，而不是去返回index.html文件内容</span></span><br></pre></td></tr></table></figure>



<ul>
<li><strong>if指令</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">if (condition) &#123; ... &#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值：无</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：server, location</span></span><br></pre></td></tr></table></figure>

<p>condition</p>
<table>
<thead>
<tr>
<th>操作符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>$variable</td>
<td>仅为变量时，值为空或以0开头字符串都会被当做false处理</td>
</tr>
<tr>
<td>&#x3D;或!&#x3D;</td>
<td>相等或不等</td>
</tr>
<tr>
<td>~</td>
<td>与指定正则表达式模式匹配时返回“真”，判断匹配与否时区分字符大小写</td>
</tr>
<tr>
<td>~*</td>
<td>与指定正则表达式模式匹配时返回“真”，判断匹配与否时不区分字符大小写</td>
</tr>
<tr>
<td>!~</td>
<td>与指定正则表达式模式不匹配时返回“真”，判断匹配与否时区分字符大小写</td>
</tr>
<tr>
<td>!~*</td>
<td>与指定正则表达式模式不匹配时返回“真”，判断匹配与否时不区分字符大小写</td>
</tr>
<tr>
<td>-f或!-f</td>
<td>检查文件存在或不存在</td>
</tr>
<tr>
<td>-d或!-d</td>
<td>检查目录存在或不存在</td>
</tr>
<tr>
<td>-e或!-e</td>
<td>检查文件、目录、符号链接等存在或不存在</td>
</tr>
<tr>
<td>-x或!-x</td>
<td>检查文件可执行或不可执行</td>
</tr>
</tbody></table>
<p>示例</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">	listen 83;</span><br><span class="line">	root html/test;</span><br><span class="line">	</span><br><span class="line">	location / &#123;</span><br><span class="line">		if ( $uri = &quot;/images/&quot; ) &#123;</span><br><span class="line">			rewrite (.*) /pics/ break;</span><br><span class="line">		&#125;</span><br><span class="line">		return 200 &quot;test if failed\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">执行结果 访问127.0.0.1:83/images/</span></span><br><span class="line">test if failed #if执行完之后，if之外的return会被执行，一般情况下不会这么写</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="autoindex模块"><a href="#autoindex模块" class="headerlink" title="autoindex模块"></a>autoindex模块</h4><h5 id="基本功能-2"><a href="#基本功能-2" class="headerlink" title="基本功能"></a>基本功能</h5><ul>
<li>用户请求以&#x2F;结尾时，列出目录结构</li>
</ul>
<h5 id="指令-3"><a href="#指令-3" class="headerlink" title="指令"></a>指令</h5><ul>
<li>autoindex</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">autoindex on | off;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值</span>	</span><br><span class="line">autoindex off;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http, server, location</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">是否开启目录展示</span></span><br></pre></td></tr></table></figure>

<ul>
<li>autoindex_exact_size</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">autoindex_exact_size on | off;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值</span></span><br><span class="line">autoindex_exact_size on;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http, server, location</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">针对HTML模式，指定是否应在目录列表中输出确切的文件大小，或者四舍五入为千字节、兆字节和千兆字节</span></span><br></pre></td></tr></table></figure>

<ul>
<li>autoindex_format</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">autoindex_format html | xml | json | jsonp;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值</span></span><br><span class="line">autoindex_format html;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http, server, location</span></span><br><span class="line">This directive appeared in version 1.7.9.</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">设置目录列表的格式</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">使用JSONP格式时，回调函数的名称由回调请求参数设置。如果参数缺失或值为空，则使用JSON格式</span></span><br></pre></td></tr></table></figure>

<ul>
<li>autoindex_localtime</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">autoindex_localtime on | off;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认值</span></span><br><span class="line">autoindex_localtime off;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上下文：http, server, location</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">对于HTML格式，指定目录列表中的时间是否应以本地时区或UTC输出。</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例</span></span><br><span class="line">server &#123;</span><br><span class="line">	listen 84;</span><br><span class="line">	root html/test;</span><br><span class="line">	</span><br><span class="line">	location /download/ &#123;</span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">index a.html;</span></span><br><span class="line">		autoindex on;</span><br><span class="line">		autoindex_exact_size on;</span><br><span class="line">		autoindex_format html;</span><br><span class="line">		autoindex_localtime off;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">注意：index指令显示指定时，如果指定文件存在，那么autoindex不会生效；index指令不存在时，如果文件中存在index.html文件，那么autoindex也不会生效，默认会展示index.html内容</span></span><br></pre></td></tr></table></figure>

<h4 id="Nginx中的变量"><a href="#Nginx中的变量" class="headerlink" title="Nginx中的变量"></a>Nginx中的变量</h4><img src="/load_images/nginx16.png" alt="img" style="zoom: 40%;" />

<h5 id="变量分类"><a href="#变量分类" class="headerlink" title="变量分类"></a>变量分类</h5><ul>
<li>TCP连接变量</li>
</ul>
<table>
<thead>
<tr>
<th>变量名</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>remote_addr</td>
<td>客户端IP地址</td>
</tr>
<tr>
<td>remote_port</td>
<td>客户端端口</td>
</tr>
<tr>
<td>server_addr</td>
<td>服务端IP地址</td>
</tr>
<tr>
<td>server_port</td>
<td>服务端端口</td>
</tr>
<tr>
<td>server_protocol</td>
<td>服务端协议</td>
</tr>
<tr>
<td>binary_remote_addr</td>
<td>二进制格式的客户端IP地址</td>
</tr>
<tr>
<td>connection</td>
<td>TCP连接的序号，递增</td>
</tr>
<tr>
<td>connection_requests</td>
<td>TCP连接当前的请求数量</td>
</tr>
<tr>
<td>proxy_protocol_addr</td>
<td>若使用了proxy_protocol协议，则返回协议中的地址，否则返回空</td>
</tr>
<tr>
<td>proxy_protocol_port</td>
<td>若使用了proxy_protocol协议，则返回协议中的端口，否则返回空</td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen 85;</span><br><span class="line">        root html;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">                return 200 &quot;remote_addr: $remote_addr</span><br><span class="line">remote_port: $remote_port</span><br><span class="line">server_addr: $server_addr</span><br><span class="line">server_port: $server_port</span><br><span class="line">server_protocol: $server_protocol</span><br><span class="line">proxy_protocol_addr: $proxy_protocol_addr</span><br><span class="line">proxy_protocol_port: $proxy_protocol_port</span><br><span class="line">connection_requests: $connection_requests</span><br><span class="line">connection: $connection &quot;;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">结果</span></span><br></pre></td></tr></table></figure>

<p><img src="/load_images/nginx17.png" alt="img"></p>
<ul>
<li><p>HTTP请求变量</p>
</li>
<li><p>Nginx处理HTTP请求产生的变量</p>
</li>
<li><p>Nginx返回响应变量</p>
</li>
<li><p>Nginx内部变量</p>
</li>
</ul>
<p><strong>HTTP请求变量</strong></p>
<table>
<thead>
<tr>
<th>变量名</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>uri</td>
<td>请求的URL，不包含参数</td>
</tr>
<tr>
<td>request_uri</td>
<td>请求的URL，包含参数</td>
</tr>
<tr>
<td>scheme</td>
<td>协议名，http或https</td>
</tr>
<tr>
<td>request_method</td>
<td>请求方法</td>
</tr>
<tr>
<td>request_length</td>
<td>全部请求的长度，包括请求行、请求头、请求体</td>
</tr>
<tr>
<td>args</td>
<td>全部参数字符串</td>
</tr>
<tr>
<td>arg_参数名</td>
<td>特定参数值</td>
</tr>
<tr>
<td>is_args</td>
<td>URL中有参数，则返回?，否则返回空</td>
</tr>
<tr>
<td>query_string</td>
<td>与args相同</td>
</tr>
<tr>
<td>remote_user</td>
<td>由HTTP Basic Authentication协议传入的用户名</td>
</tr>
<tr>
<td><strong>特殊变量（这些变量Nginx可能会做一些处理）</strong></td>
<td></td>
</tr>
<tr>
<td>host</td>
<td>优先级顺序：请求行中的host，请求头中的Host ，请求匹配到的server_name</td>
</tr>
<tr>
<td>http_user_agent</td>
<td>用户浏览器</td>
</tr>
<tr>
<td>http_referer</td>
<td>从哪些链接过来的请求 例如从百度搜索到的链接</td>
</tr>
<tr>
<td>http_via</td>
<td>经过一层代理服务器，添加对应代理服务器的信息</td>
</tr>
<tr>
<td>http_x_forwarded_for</td>
<td>获取用户真实IP</td>
</tr>
<tr>
<td>http_cookie</td>
<td>用户cookie</td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例1</span></span><br><span class="line">server &#123;</span><br><span class="line">        listen 86;</span><br><span class="line">        root html/test;</span><br><span class="line"></span><br><span class="line">        location /test &#123;</span><br><span class="line">                return 200 &quot;uri: $uri</span><br><span class="line">request_uri: $request_uri</span><br><span class="line">scheme: $scheme</span><br><span class="line">request_method: $request_method</span><br><span class="line">request_length: $request_length</span><br><span class="line">is_args: $is_args</span><br><span class="line">args: $args</span><br><span class="line">query_string: $query_string</span><br><span class="line">remote_user: $remote_user &quot;;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">curl <span class="string">&#x27;127.0.0.1:86/test?a=123&amp;b=234&#x27;</span></span></span><br><span class="line">uri: /test</span><br><span class="line">request_uri: /test?a=123&amp;b=234</span><br><span class="line">scheme: http</span><br><span class="line">request_method: GET</span><br><span class="line">request_length: 92</span><br><span class="line">is_args: ?</span><br><span class="line">args: a=123&amp;b=234</span><br><span class="line">query_string: a=123&amp;b=234</span><br><span class="line">remote_user:</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例2</span></span><br><span class="line">server &#123;</span><br><span class="line">        listen 87;</span><br><span class="line">        root html/test;</span><br><span class="line"></span><br><span class="line">        location /test &#123;</span><br><span class="line">                return 200 &quot;host: $host&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">curl 127.0.0.1:87/test</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">结果：host: 127.0.0.1</span></span><br><span class="line"></span><br><span class="line">curl 127.0.0.1:87/test -H &quot;Host: test.nginx.com&quot; #-H 添加头信息</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">结果：host: test.nginx.com</span></span><br></pre></td></tr></table></figure>

<p><strong>处理HTTP请求相关变量</strong></p>
<table>
<thead>
<tr>
<th>变量名</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>request_time</td>
<td>处理请求已耗费的时间</td>
</tr>
<tr>
<td>request_completion</td>
<td>请求处理完成返回OK，否则返回空</td>
</tr>
<tr>
<td>server_name</td>
<td>匹配请求的server_name值</td>
</tr>
<tr>
<td>https</td>
<td>若开启https，则返回on，否则返回空</td>
</tr>
<tr>
<td>request_filename</td>
<td>磁盘文件系统待访问文件的完整路径</td>
</tr>
<tr>
<td>document_root</td>
<td>由URI和root&#x2F;alias规则生成的文件夹路径</td>
</tr>
<tr>
<td>realpath_root</td>
<td>将document_root中的软链接换成真实路径</td>
</tr>
<tr>
<td>limit_rate</td>
<td>返回响应时的速度上限值</td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例</span></span><br><span class="line">server &#123;</span><br><span class="line">	listen 88;</span><br><span class="line">	server_name localhost;</span><br><span class="line">	root html/test;</span><br><span class="line">	</span><br><span class="line">	location / &#123;</span><br><span class="line">		set $limit_rate 50;</span><br><span class="line">		return 200 &#x27;request_time: $request_time</span><br><span class="line">request_id: $request_id</span><br><span class="line">server_name: $server_name</span><br><span class="line">document_root: $document_root</span><br><span class="line">realpath_root: $realpath_root</span><br><span class="line">limit_rate: $limit_rate&#x27;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">curl 127.0.0.1:88</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">结果</span></span><br><span class="line">request_time: 0.000</span><br><span class="line">request_id: 5108c925220dc0f7b991ce25074edfd8</span><br><span class="line">server_name: localhost</span><br><span class="line">document_root: /usr/local/Cellar/nginx/1.23.1/html/test</span><br><span class="line">realpath_root: /usr/local/var/www/test</span><br><span class="line">limit_rate: 50</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginx-负载均衡</title>
    <url>/nginx/load_balancer/</url>
    <content><![CDATA[<h3 id="Nginx应用场景-负载均衡"><a href="#Nginx应用场景-负载均衡" class="headerlink" title="Nginx应用场景-负载均衡"></a>Nginx应用场景-负载均衡</h3><h4 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h4><p>将请求代理到多台服务器去执行，这里的多台服务器通常承担一样的功能任务</p>
<span id="more"></span>

<h4 id="原理图"><a href="#原理图" class="headerlink" title="原理图"></a>原理图</h4><img src="/load_images/nginx_load_balance1.png" alt="img" style="zoom: 33%;" />

<h4 id="uptream模块及相关指令"><a href="#uptream模块及相关指令" class="headerlink" title="uptream模块及相关指令"></a>uptream模块及相关指令</h4><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">upstream</span>定义一组服务器</span><br><span class="line"><span class="comment">#语法</span></span><br><span class="line"><span class="section">upstream</span> name &#123; ... &#125;</span><br><span class="line"><span class="comment">#默认值：无</span></span><br><span class="line"><span class="comment">#上下文：http</span></span><br><span class="line"></span><br><span class="line">server可以监听不同的端口</span><br><span class="line">监听TCP和UNIX域套接字的server可以混合使用</span><br><span class="line"></span><br><span class="line"><span class="comment">#示例</span></span><br><span class="line"><span class="section">upstream</span> backend &#123;</span><br><span class="line">    <span class="attribute">server</span> backend1.example.com weight=<span class="number">5</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">127.0.0.1:8080</span>       max_fails=<span class="number">3</span> fail_timeout=<span class="number">30s</span>;</span><br><span class="line">    <span class="attribute">server</span> unix:/tmp/backend3;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">server</span> backup1.example.com  backup;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#说明</span></span><br><span class="line">默认情况下，请求使用加权循环平衡方法（<span class="attribute">a</span> weighted round-robin balancing method）在服务器之间分配</span><br><span class="line">上述示例，每<span class="number">7</span>个请求将按以下方式分发：第一个server分配<span class="number">5</span>个，第二、第三个server各一个；</span><br><span class="line">如果在与服务器通信时发生错误，请求被传递到下一个服务器，依次类推，直到尝试所有正常运行的服务器</span><br><span class="line">如果无法从任何服务器获得成功响应，那么客户端将收到与最后一个backup服务器通信的结果</span><br></pre></td></tr></table></figure>

<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment">#server语法</span></span><br><span class="line"><span class="attribute">server</span> address [parameters];</span><br><span class="line"><span class="comment">#默认值：无</span></span><br><span class="line"><span class="comment">#上下文：upstream</span></span><br><span class="line"></span><br><span class="line">address可以是IP、域名，也可以带上端口(默认80端口)，也可以是一个UNIX套接字路径</span><br><span class="line">解析为多个IP地址的域名一次定义多个服务器</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>parameters可选值</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>weight&#x3D;number</td>
<td>权重值，默认为1</td>
</tr>
<tr>
<td>max_conns&#x3D;number</td>
<td>上游服务器的最大并发连接数</td>
</tr>
<tr>
<td>fail_timeout&#x3D;time</td>
<td>服务器不可用的判定时间</td>
</tr>
<tr>
<td>max_fails&#x3D;number</td>
<td>服务器不可用的检查次数</td>
</tr>
<tr>
<td>backup</td>
<td>备份服务器，仅当其他主服务器都不可用时，将被传递请求</td>
</tr>
<tr>
<td>down</td>
<td>标记服务器长期不可用，离线维护</td>
</tr>
<tr>
<td>resolve</td>
<td>监控服务器域名对应的IP地址变化，自动修改upstream配置，无需重启nginx；服务器组必须驻留在共享内存中</td>
</tr>
</tbody></table>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line">keepalive：限制每个worker子进程与上游服务器空闲长连接的最大数量</span><br><span class="line"></span><br><span class="line"><span class="comment">#语法</span></span><br><span class="line"><span class="attribute">keepalive</span> connections;</span><br><span class="line"><span class="comment">#默认值：无</span></span><br><span class="line"><span class="comment">#上下文：upstream</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#简单示例</span></span><br><span class="line"><span class="attribute">keepalive</span> <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#For HTTP</span></span><br><span class="line"><span class="section">upstream</span> http_backend &#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">127.0.0.1:8080</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">keepalive</span> <span class="number">16</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> /http/ &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://http_backend;</span><br><span class="line">        <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>; <span class="comment">#proxy_http_version需要设置为1.1</span></span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="string">&quot;&quot;</span>; <span class="comment">#proxy_set_header设置Connection为空</span></span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#说明，如果不设置proxy_http_version为1.1，那么proxy_set_header需要设置Connection为Keep-Alive；不建议这么做</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#For FastCGI</span></span><br><span class="line"><span class="section">upstream</span> fastcgi_backend &#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">127.0.0.1:9000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">keepalive</span> <span class="number">8</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> /fastcgi/ &#123;</span><br><span class="line">        <span class="attribute">fastcgi_pass</span> fastcgi_backend;</span><br><span class="line">        <span class="attribute">fastcgi_keep_conn</span> <span class="literal">on</span>; <span class="comment">#需要设置fastcgi_keep_conn为on</span></span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#关于负载均衡注意点</span></span><br><span class="line">当使用默认循环方法以外的负载均衡方法时，需要在keepalive指令之前启用它们。</span><br></pre></td></tr></table></figure>

<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line">keepalive_requests：设置一个keepalive连接可以处理的最大请求数。在发出最大请求数后，连接将关闭。</span><br><span class="line"></span><br><span class="line"><span class="comment">#语法</span></span><br><span class="line"><span class="attribute">keepalive_requests</span> number;</span><br><span class="line"><span class="comment">#默认值</span></span><br><span class="line"><span class="attribute">keepalive_requests</span> <span class="number">1000</span>; <span class="comment">#在1.19.10版本之前，默认值为 100</span></span><br><span class="line"><span class="comment">#上下文：upstream</span></span><br><span class="line"><span class="attribute">This</span> directive appeared in version <span class="number">1</span>.<span class="number">15</span>.<span class="number">3</span>.</span><br><span class="line"></span><br><span class="line">Closing connections periodically is necessary to free per-connection memory allocations. </span><br><span class="line">Therefore, using too high maximum number of requests could result in excessive memory usage and not recommended.</span><br></pre></td></tr></table></figure>

<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line">keepalive_time：限制通过一个保活连接处理请求的最长时间。到了这个时间后，在后续的请求处理之后关闭连接</span><br><span class="line"></span><br><span class="line"><span class="comment">#语法</span></span><br><span class="line"><span class="attribute">keepalive_time</span> time;</span><br><span class="line"><span class="comment">#默认值</span></span><br><span class="line"><span class="attribute">keepalive_time</span> <span class="number">1h</span>;</span><br><span class="line"><span class="comment">#上下文upstream</span></span><br><span class="line"><span class="attribute">This</span> directive appeared in version <span class="number">1</span>.<span class="number">19</span>.<span class="number">10</span>.</span><br></pre></td></tr></table></figure>

<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line">keepalive_timeout：空闲连接的最长保持时间</span><br><span class="line"></span><br><span class="line"><span class="comment">#语法</span></span><br><span class="line"><span class="attribute">keepalive_timeout</span> timeout;</span><br><span class="line"><span class="comment">#默认值</span></span><br><span class="line"><span class="attribute">keepalive_timeout</span> <span class="number">60s</span>;</span><br><span class="line"><span class="comment">#上下文：upstream</span></span><br><span class="line"><span class="attribute">This</span> directive appeared in version <span class="number">1</span>.<span class="number">15</span>.<span class="number">3</span>.</span><br></pre></td></tr></table></figure>

<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line">queue：如果在处理请求时无法立即选择上游服务器，则该请求将被放入队列中</span><br><span class="line"></span><br><span class="line"><span class="comment">#语法</span></span><br><span class="line"><span class="attribute">queue</span> number [timeout=time];</span><br><span class="line"><span class="comment">#默认值：无</span></span><br><span class="line"><span class="comment">#上下文：upstream</span></span><br><span class="line"><span class="attribute">This</span> directive appeared in version <span class="number">1</span>.<span class="number">5</span>.<span class="number">12</span>.</span><br><span class="line"></span><br><span class="line"><span class="comment">#说明</span></span><br><span class="line">number指定在队列可以同时存在的最大请求数</span><br><span class="line">如果队列已满，或者在 timeout 参数指定的时间段内无法选择传递请求的服务器，则会向客户端返回 <span class="number">502</span> (Bad Gateway) 错误。</span><br></pre></td></tr></table></figure>

<h4 id="简单负载均衡示例"><a href="#简单负载均衡示例" class="headerlink" title="简单负载均衡示例"></a>简单负载均衡示例</h4><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment">#上游服务器，通过端口实现多台server</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">8002</span>;</span><br><span class="line"></span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">                <span class="attribute">return</span> <span class="number">200</span> <span class="string">&#x27;Return Result For Server 8002\n&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">8003</span>;</span><br><span class="line"></span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">                <span class="attribute">return</span> <span class="number">200</span> <span class="string">&#x27;Return Result For Server 8003\n&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">8004</span>;</span><br><span class="line"></span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">                <span class="attribute">return</span> <span class="number">200</span> <span class="string">&#x27;Return Result For Server 8004\n&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment">#负载均衡服务器</span></span><br><span class="line"><span class="section">upstream</span> load_balancer &#123;</span><br><span class="line">        <span class="attribute">server</span> ip:<span class="number">8002</span>;</span><br><span class="line">        <span class="attribute">server</span> ip:<span class="number">8003</span>;</span><br><span class="line">        <span class="attribute">server</span> ip:<span class="number">8004</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">92</span>;</span><br><span class="line"></span><br><span class="line">        <span class="section">location</span> /balance/ &#123;</span><br><span class="line">                <span class="attribute">proxy_pass</span> http://load_balancer;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="哈希算法"><a href="#哈希算法" class="headerlink" title="哈希算法"></a>哈希算法</h4><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment">#语法</span></span><br><span class="line"><span class="attribute">hash</span> key [consistent];</span><br><span class="line"><span class="comment">#默认值：无</span></span><br><span class="line"><span class="comment">#上下文：upstream</span></span><br><span class="line"><span class="attribute">This</span> directive appeared in version <span class="number">1</span>.<span class="number">7</span>.<span class="number">2</span>.</span><br><span class="line"></span><br><span class="line">基于key的哈希值来做客户端和服务端的映射。</span><br><span class="line">key可以包含文本、变量及其组合</span><br><span class="line">注意，从服务器组中添加或删除服务器可能会导致将大部分密钥重新映射到不同的服务器</span><br><span class="line"></span><br><span class="line">如果指定了consistent一致参数，则将使用ketama一致哈希方法。</span><br><span class="line">该方法确保在将服务器添加到组或从组中删除时，只有少数密钥将重新映射到不同的服务器。</span><br><span class="line">这有助于为缓存服务器实现更高的缓存命中率</span><br></pre></td></tr></table></figure>

<h5 id="基于uri的哈希值做简单负载均衡"><a href="#基于uri的哈希值做简单负载均衡" class="headerlink" title="基于uri的哈希值做简单负载均衡"></a>基于uri的哈希值做简单负载均衡</h5><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment">#上游服务器</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">8005</span>;</span><br><span class="line"></span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">                <span class="attribute">return</span> <span class="number">200</span> <span class="string">&#x27;Return Result For Server 8005\n&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">8006</span>;</span><br><span class="line"></span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">                <span class="attribute">return</span> <span class="number">200</span> <span class="string">&#x27;Return Result For Server 8006\n&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment">#负载均衡服务器</span></span><br><span class="line"><span class="section">upstream</span> hash &#123;</span><br><span class="line">        <span class="attribute">hash</span> <span class="variable">$request_uri</span>;</span><br><span class="line">        <span class="attribute">server</span> ip:<span class="number">8005</span>;</span><br><span class="line">        <span class="attribute">server</span> ip:<span class="number">8006</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">93</span>;</span><br><span class="line"></span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">                <span class="attribute">proxy_pass</span> http://hash;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl 127.0.0.1:93/a</span><br><span class="line">Return Result For Server 8005</span><br><span class="line"></span><br><span class="line">curl 127.0.0.1:93/b</span><br><span class="line">Return Result For Server 8006</span><br></pre></td></tr></table></figure>

<h4 id="ip-hash算法"><a href="#ip-hash算法" class="headerlink" title="ip_hash算法"></a>ip_hash算法</h4><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment">#语法：</span></span><br><span class="line">ip_hash;</span><br><span class="line"><span class="comment">#默认值：无</span></span><br><span class="line"><span class="comment">#上下文：upstream</span></span><br><span class="line"></span><br><span class="line">指定服务器组应使用基于客户端IP地址在服务器之间分配请求的负载均衡方法</span><br><span class="line">客户端IPv4地址的前三个八位字节或整个IPv6地址用作散列密钥</span><br><span class="line">该方法确保来自同一客户端的请求将始终传递到同一服务器，除非该服务器不可用。在后一种情况下，客户端请求将被传递到另一台服务器</span><br><span class="line"></span><br><span class="line">如果需要临时删除其中一台服务器，则应使用down参数对其进行标记，以保留客户端IP地址的当前哈希</span><br><span class="line"><span class="section">upstream</span> backend &#123;</span><br><span class="line">    ip_hash;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">server</span> backend1.example.com;</span><br><span class="line">    <span class="attribute">server</span> backend2.example.com;</span><br><span class="line">    <span class="attribute">server</span> backend3.example.com down;</span><br><span class="line">    <span class="attribute">server</span> backend4.example.com;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="最少连接数算法"><a href="#最少连接数算法" class="headerlink" title="最少连接数算法"></a>最少连接数算法</h4><p>考虑上游服务器的负载情况，挑选一台当前已建立连接数量最少的服务器去分配请求</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment">#语法：</span></span><br><span class="line">least_conn;</span><br><span class="line"><span class="comment">#默认值：无</span></span><br><span class="line"><span class="comment">#上下文：upstream</span></span><br><span class="line"><span class="attribute">This</span> directive appeared in versions <span class="number">1</span>.<span class="number">3</span>.<span class="number">1</span> and <span class="number">1</span>.<span class="number">2</span>.<span class="number">2</span>.</span><br><span class="line"></span><br><span class="line">指定组应使用将请求传递到具有最少活动连接数的服务器的负载均衡方法，同时考虑服务器的权重</span><br><span class="line">如果有多个这样的服务器，则使用加权循环平衡方法依次尝试它们。</span><br><span class="line"></span><br><span class="line">不同的worker process不知道其他子进程的连接情况，此时需要共享内存去解决这个问题</span><br></pre></td></tr></table></figure>

<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment">#语法</span></span><br><span class="line"><span class="attribute">zone</span> name [size];</span><br><span class="line"><span class="comment">#默认值：无</span></span><br><span class="line"><span class="comment">#上下文：upstream</span></span><br><span class="line"><span class="attribute">This</span> directive appeared in version <span class="number">1</span>.<span class="number">9</span>.<span class="number">0</span>.</span><br><span class="line"></span><br><span class="line">定义共享内存区域的名称和大小，以保持worker进程之间共享的组配置和运行时状态。</span><br><span class="line">几个组可以共享同一个区域。在这种情况下，只指定一次大小就足够了。</span><br><span class="line"></span><br><span class="line">upstream demo &#123;</span><br><span class="line">    <span class="attribute">zone</span> test <span class="number">10M</span>;</span><br><span class="line">    </span><br><span class="line">    ......</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="容错机制"><a href="#容错机制" class="headerlink" title="容错机制"></a>容错机制</h4><p>Nginx针对上游服务返回异常时的容错机制</p>
<h5 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h5><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment">#语法</span></span><br><span class="line"><span class="attribute">proxy_next_upstream</span> <span class="literal">error</span> | timeout | invalid_header | http_500 | http_502 | http_503 | http_504 | http_403 | http_404 | http_429 | non_idempotent | <span class="literal">off</span> ...;</span><br><span class="line"><span class="comment">#默认值	</span></span><br><span class="line"><span class="attribute">proxy_next_upstream</span> <span class="literal">error</span> timeout;</span><br><span class="line"><span class="comment">#上下文：http, server, location</span></span><br><span class="line"></span><br><span class="line">指定在哪些情况下应将请求传递给下一个服务器</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>可选参数</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>error</td>
<td>与上游服务器建立连接、向其传递请求或读取响应头时发生错误</td>
</tr>
<tr>
<td>timeout</td>
<td>与上游服务器建立连接、向其传递请求或读取响应头时发生超时</td>
</tr>
<tr>
<td>invalid_header</td>
<td>上游服务器返回空响应或无效响应</td>
</tr>
<tr>
<td>http_500</td>
<td>服务器返回了带有代码 500 的响应</td>
</tr>
<tr>
<td>http_502</td>
<td>服务器返回了带有代码 502 的响应</td>
</tr>
<tr>
<td>http_503</td>
<td>服务器返回了带有代码 503 的响应</td>
</tr>
<tr>
<td>http_504</td>
<td>服务器返回了带有代码 504的响应</td>
</tr>
<tr>
<td>http_403</td>
<td>服务器返回了带有代码 403 的响应</td>
</tr>
<tr>
<td>http_404</td>
<td>服务器返回了带有代码 404 的响应</td>
</tr>
<tr>
<td>http_429</td>
<td>服务器返回了带有代码 429 的响应</td>
</tr>
<tr>
<td>non_idempotent</td>
<td>通常，如果请求已发送到上游服务器，则使用非幂等方法（POST、LOCK、PATCH）的请求不会传递到下一个服务器；<br />显式启用此选项允许重试此类请求</td>
</tr>
<tr>
<td>off</td>
<td>禁止将请求传递到下一个服务器</td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">应该记住，只有在尚未向客户端发送任何内容的情况下，才有可能将请求传递给下一个服务器。也就是说，如果在传输响应的过程中发生错误或超时，则无法解决此问题</span><br><span class="line"></span><br><span class="line">该指令还定义了与服务器通信不成功的尝试：upstream模块的max_fails设置的不成功尝试次数</span><br><span class="line">error、timeout和invalid_header总是被当做不成功尝试，即使它们没有在指令中指定</span><br><span class="line">http_500、http_502、http_503、http_504 和 http_429 的情况只有在指令中指定时才被认为是不成功的尝试</span><br><span class="line">http_403 和 http_404 的情况永远不会被认为是不成功的尝试。</span><br><span class="line"></span><br><span class="line">将请求传递到下一个服务器可能会受到尝试次数max_fails和时间fail_timeout的限制</span><br></pre></td></tr></table></figure>

<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment">#语法</span></span><br><span class="line"><span class="attribute">proxy_next_upstream_timeout</span> time;</span><br><span class="line"><span class="comment">#默认值	</span></span><br><span class="line"><span class="attribute">proxy_next_upstream_timeout</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">#上下文：http, server, location</span></span><br><span class="line"><span class="attribute">This</span> directive appeared in version <span class="number">1</span>.<span class="number">7</span>.<span class="number">5</span>.</span><br><span class="line"></span><br><span class="line">限制可以将请求传递到下一个服务器的时间。 <span class="number">0</span>值关闭此限制。</span><br></pre></td></tr></table></figure>

<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment">#语法</span></span><br><span class="line"><span class="attribute">proxy_next_upstream_tries</span> number;</span><br><span class="line"><span class="comment">#默认值	</span></span><br><span class="line"><span class="attribute">proxy_next_upstream_tries</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">#上下文：http, server, location</span></span><br><span class="line"><span class="attribute">This</span> directive appeared in version <span class="number">1</span>.<span class="number">7</span>.<span class="number">5</span>.</span><br><span class="line"></span><br><span class="line">限制将请求传递到下一个服务器的可能尝试次数。 <span class="number">0</span>值关闭此限制。</span><br></pre></td></tr></table></figure>

<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment">#语法</span></span><br><span class="line"><span class="attribute">proxy_read_timeout</span> time;</span><br><span class="line"><span class="comment">#默认值	</span></span><br><span class="line"><span class="attribute">proxy_read_timeout</span> <span class="number">60s</span>;</span><br><span class="line"><span class="comment">#上下文：http, server, location</span></span><br><span class="line"></span><br><span class="line">定义从代理服务器读取响应的超时时间</span><br><span class="line">超时仅在两个连续的读取操作之间设置，不是为了整个响应的传输</span><br><span class="line">如果代理服务器在这段时间内没有传输任何内容，则关闭连接</span><br></pre></td></tr></table></figure>

<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment">#语法</span></span><br><span class="line"><span class="attribute">proxy_intercept_errors</span> <span class="literal">on</span> | <span class="literal">off</span>;</span><br><span class="line"><span class="comment">#默认值	</span></span><br><span class="line"><span class="attribute">proxy_intercept_errors</span> <span class="literal">off</span>;</span><br><span class="line"><span class="comment">#上下文：http, server, location</span></span><br><span class="line"></span><br><span class="line">上游服务器响应码大于300时，是直接将上游响应返回给客户端（off）还是被拦截并重定向到nginx以使用error_page指令进行处理（on）</span><br></pre></td></tr></table></figure>

<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment">#语法</span></span><br><span class="line"><span class="attribute">error_page</span> code ... [=[response]] uri;</span><br><span class="line"><span class="comment">#默认值：无</span></span><br><span class="line"><span class="comment">#上下文：http, server, location, if in location</span></span><br><span class="line">定义将针对指定错误显示的 URI。 <span class="attribute">uri</span> 值可以包含变量</span><br><span class="line"></span><br><span class="line"><span class="comment">#示例</span></span><br><span class="line">error_page <span class="number">404</span>             /<span class="number">404</span>.html;</span><br><span class="line"><span class="attribute">error_page</span> <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span> /50x.html;</span><br><span class="line">这会导致内部重定向到指定的 uri，客户端请求方法更改为“GET”（对于“GET”和“HEAD”以外的所有方法）</span><br><span class="line"></span><br><span class="line"><span class="comment">#示例</span></span><br><span class="line">此外，可以使用“=response”语法将响应码更改为另一个码，例如：</span><br><span class="line"><span class="attribute">error_page</span> <span class="number">404</span> =<span class="number">200</span> /empty.gif;</span><br><span class="line"></span><br><span class="line"><span class="comment">#示例</span></span><br><span class="line">如果错误响应由代理服务器或FastCGI/uwsgi/SCGI/<span class="attribute">gRPC</span> 服务器处理，</span><br><span class="line">并且服务器可能返回不同的响应代码（例如，<span class="number">200</span>、<span class="number">302</span>、<span class="number">401</span> 或 <span class="number">404</span>），那么这些返回的状态码也可以由本指令处理：</span><br><span class="line">error_page <span class="number">404</span> = /<span class="number">404</span>.php;</span><br><span class="line"></span><br><span class="line"><span class="comment">#示例</span></span><br><span class="line">如果在内部重定向过程中不需要更改URI和方法,可以将错误处理传递到命名路径</span><br><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line">    <span class="attribute">error_page</span> <span class="number">404</span> = <span class="variable">@fallback</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">location</span> <span class="variable">@fallback</span> &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://backend;</span><br><span class="line">&#125;</span><br><span class="line">如果处理uri产生了错误，那么nginx将最后一次出错的HTTP响应状态码返回给客户端。也就是说备用服务器还是不行的话会直接展示这台服务器的响应码。</span><br><span class="line"></span><br><span class="line"><span class="comment">#示例</span></span><br><span class="line">也可以使用URL重定向进行错误处理：</span><br><span class="line"><span class="attribute">error_page</span> <span class="number">403</span>      http://example.com/forbidden.html; <span class="comment">#使用URL重定向，默认情况下会向客户端返回响应码302</span></span><br><span class="line"><span class="attribute">error_page</span> <span class="number">404</span> =<span class="number">301</span> http://example.com/notfound.html; <span class="comment">#使用URL重定向，只能更改为重定向状态代码之一（301、302、303、307 和 308）</span></span><br><span class="line">总结：使用URL重定向，默认情况下会向客户端返回响应码302。而且它只能更改为重定向状态代码之一（301、302、303、307 和 308）。</span><br><span class="line"></span><br><span class="line">当且仅当当前级别上没有定义 <span class="attribute">error_page</span> 指令时，这些指令才从先前的配置级别继承。</span><br></pre></td></tr></table></figure>



<h5 id="简单示例"><a href="#简单示例" class="headerlink" title="简单示例"></a>简单示例</h5><p>一、模拟一台服务器挂掉（通过注释掉8008server配置模拟）</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment">#上游服务器配置</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">8007</span>;</span><br><span class="line"></span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">                <span class="attribute">return</span> <span class="number">200</span> <span class="string">&#x27;Return Result For Server 8007\n&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#server &#123;</span></span><br><span class="line"><span class="comment">#        listen 8008;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#        location / &#123;</span></span><br><span class="line"><span class="comment">#                return 200 &#x27;Return Result For Server 8008\n&#x27;;</span></span><br><span class="line"><span class="comment">#        &#125;</span></span><br><span class="line"><span class="comment">#&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment">#负载均衡服务器配置</span></span><br><span class="line"><span class="section">upstream</span> test_tolerant_server &#123;</span><br><span class="line">        <span class="attribute">server</span> ip|domain:<span class="number">8007</span>;</span><br><span class="line">        <span class="attribute">server</span> ip|domain:<span class="number">8008</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">94</span>;</span><br><span class="line"></span><br><span class="line">        <span class="section">location</span> /test/ &#123;</span><br><span class="line">                <span class="attribute">proxy_pass</span> http://test_tolerant_server;</span><br><span class="line">                <span class="attribute">proxy_next_upstream</span> <span class="literal">off</span>; <span class="comment">#禁止将请求传递到下一个服务器</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attribute">curl</span> <span class="number">127.0.0.1:94</span>/test/ -V <span class="comment">#查看详细信息</span></span><br></pre></td></tr></table></figure>

<p><img src="/load_images/nginx_load_balance2.png" alt="img"></p>
<p>可以看到，当请求被分配到8008这个服务器的时候，直接返回502，而不会尝试将请求发送给其他服务器（8007）。</p>
<p>二、模拟一台服务器响应超时</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment">#上游服务器配置</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">8007</span>;</span><br><span class="line"></span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">                <span class="attribute">return</span> <span class="number">200</span> <span class="string">&#x27;Return Result For Server 8007\n&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">8008</span>;</span><br><span class="line"></span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">        		<span class="attribute">set</span> <span class="variable">$limit_rate</span> <span class="number">1</span>; <span class="comment">#设置响应速率，为了模拟响应超时场景，这里把速率设为1字节</span></span><br><span class="line">                <span class="attribute">return</span> <span class="number">200</span> <span class="string">&#x27;Return Result For Server 8008\n&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment">#负载均衡服务器配置</span></span><br><span class="line"><span class="section">upstream</span> test_tolerant_server &#123;</span><br><span class="line">        <span class="attribute">server</span> ip|domain:<span class="number">8007</span>;</span><br><span class="line">        <span class="attribute">server</span> ip|domain:<span class="number">8008</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">94</span>;</span><br><span class="line"></span><br><span class="line">        <span class="section">location</span> /test/ &#123;</span><br><span class="line">                <span class="attribute">proxy_pass</span> http://test_tolerant_server;</span><br><span class="line">                <span class="attribute">proxy_next_upstream</span> timeout;</span><br><span class="line">        		<span class="attribute">proxy_read_timeout</span> <span class="number">5</span>; <span class="comment">#从上游服务器读取响应的超时时间</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行结果：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl 127.0.0.1:94/test/</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">可以看到当请求被分到8008server时，响应有明显的延迟，5秒后请求被转发到8007server</span></span><br></pre></td></tr></table></figure>



<p>三、模拟响应码</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment">#上游服务器配置</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">8007</span>;</span><br><span class="line"></span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">                <span class="attribute">return</span> <span class="number">200</span> <span class="string">&#x27;Return Result For Server 8007\n&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">8008</span>;</span><br><span class="line"></span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">                <span class="attribute">return</span> <span class="number">503</span> <span class="string">&#x27;Return Result For Server 8008\n&#x27;</span>; <span class="comment">#设置响应码为503</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment">#负载均衡服务器配置</span></span><br><span class="line"><span class="section">upstream</span> test_tolerant_server &#123;</span><br><span class="line">        <span class="attribute">server</span> ip|domain:<span class="number">8007</span>;</span><br><span class="line">        <span class="attribute">server</span> ip|domain:<span class="number">8008</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">94</span>;</span><br><span class="line"></span><br><span class="line">        <span class="section">location</span> /test/ &#123;</span><br><span class="line">                <span class="attribute">proxy_pass</span> http://test_tolerant_server;</span><br><span class="line">                <span class="attribute">proxy_next_upstream</span> http_503; <span class="comment">#设置在http响应码为503时把请求转发到其他服务器</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl 127.0.0.1:94/test/</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">只会把请求打到8007server上</span></span><br></pre></td></tr></table></figure>



<p>四、模拟响应码-通过error_page处理</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment">#上游服务器配置</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">8007</span>;</span><br><span class="line"></span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">                <span class="attribute">return</span> <span class="number">200</span> <span class="string">&#x27;Return Result For Server 8007\n&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">8008</span>;</span><br><span class="line"></span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">                <span class="attribute">return</span> <span class="number">503</span> <span class="string">&#x27;Return Result For Server 8008\n&#x27;</span>; <span class="comment">#设置响应码为503</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment">#负载均衡服务器配置</span></span><br><span class="line"><span class="section">upstream</span> test_tolerant_server &#123;</span><br><span class="line">        <span class="attribute">server</span> ip|domain:<span class="number">8007</span>;</span><br><span class="line">        <span class="attribute">server</span> ip|domain:<span class="number">8008</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">94</span>;</span><br><span class="line"></span><br><span class="line">        <span class="section">location</span> /<span class="number">503</span>.html &#123; <span class="comment">#注意创建503.html文件</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="section">location</span> /test/ &#123;</span><br><span class="line">                <span class="attribute">proxy_pass</span> http://test_tolerant_server;</span><br><span class="line">                <span class="attribute">proxy_intercept_errors</span> <span class="literal">on</span>;</span><br><span class="line">                <span class="attribute">error_page</span> <span class="number">503</span> /<span class="number">503</span>.html;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl 127.0.0.1:94/test/</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">可以看到，当请求被分配到8008服务器的时候，会被重定向到503error_page</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>mailhog邮件服务</title>
    <url>/mail/mailhog/</url>
    <content><![CDATA[<p><a href="https://github.com/mailhog/MailHog">MailHog</a></p>
<span id="more"></span>

<h5 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">brew update</span><br><span class="line">brew search mailhog</span><br><span class="line">brew install mailhog</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">运行</span></span><br><span class="line">mailhog</span><br></pre></td></tr></table></figure>

<p>the SMTP server starts on port 1025<br>the HTTP server starts on port 8025</p>
<h5 id="laravel-env文件配置"><a href="#laravel-env文件配置" class="headerlink" title="laravel .env文件配置"></a>laravel .env文件配置</h5><p><img src="/load_images/mailhog.png" alt="img"></p>
]]></content>
      <categories>
        <category>Mail</category>
      </categories>
      <tags>
        <tag>Mail</tag>
      </tags>
  </entry>
  <entry>
    <title>Mac使用技巧（持续更新）</title>
    <url>/mac/use_tips/</url>
    <content><![CDATA[<h4 id="一、vim中鼠标滚动"><a href="#一、vim中鼠标滚动" class="headerlink" title="一、vim中鼠标滚动"></a>一、vim中鼠标滚动</h4><span id="more"></span>

<h5 id="1-Iterm2中设置（有弊端）"><a href="#1-Iterm2中设置（有弊端）" class="headerlink" title="1.Iterm2中设置（有弊端）"></a>1.Iterm2中设置（有弊端）</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">iterm2-&gt;</span><span class="language-bash">Profiles-&gt;advanced</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">搜索mouse</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">设置up down 设置的值要符合vim的操作命令(vim编辑中j为光标向下移动，k为向上移动)</span></span><br><span class="line">Scorll whell down sends the specified text when in alternate screen mode. 设置为/j</span><br><span class="line">Scorll whell up sends the specified text when in alternate screen mode. 设置为/k</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">此设置有个弊端就是，vim在编辑模式，上下滚动鼠标会输入j/k</span></span><br></pre></td></tr></table></figure>

<h5 id="2-x2F-vimrc文件中设置-建议"><a href="#2-x2F-vimrc文件中设置-建议" class="headerlink" title="2.~&#x2F;.vimrc文件中设置(建议)"></a>2.~&#x2F;.vimrc文件中设置(建议)</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim ~/.vimrc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">添加配置</span></span><br><span class="line">set mouse=a</span><br></pre></td></tr></table></figure>

<h5 id="3-pecl安装swoole问题"><a href="#3-pecl安装swoole问题" class="headerlink" title="3.pecl安装swoole问题"></a>3.pecl安装swoole问题</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">可以通过--with-openssl-dir指定openssl位置</span></span><br><span class="line">enable sockets supports? [no] : yes</span><br><span class="line">enable openssl support? [no] : yes --with-openssl-dir=/usr/local/Cellar/openssl@1.1/1.1.1q</span><br></pre></td></tr></table></figure>

<h5 id="4-phpstorm安装swoole插件"><a href="#4-phpstorm安装swoole插件" class="headerlink" title="4.phpstorm安装swoole插件"></a>4.phpstorm安装swoole插件</h5><p><img src="/load_images/mac_use1.png" alt="img"></p>
]]></content>
      <categories>
        <category>Mac</category>
      </categories>
      <tags>
        <tag>Mac</tag>
      </tags>
  </entry>
  <entry>
    <title>PHP-编译安装扩展</title>
    <url>/php/php_extension/</url>
    <content><![CDATA[<h4 id="安装示例"><a href="#安装示例" class="headerlink" title="安装示例"></a>安装示例</h4><h5 id="一、执行phpize"><a href="#一、执行phpize" class="headerlink" title="一、执行phpize"></a>一、执行phpize</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">进入php7.4的源码包中gd扩展的目录</span></span><br><span class="line">cd /usr/local/src/php-7.4.28/ext/gd</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">执行phpize</span></span><br><span class="line">/usr/local/php/php74/bin/phpize</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h5 id="二、此编译成功后会生成configure可执行文件："><a href="#二、此编译成功后会生成configure可执行文件：" class="headerlink" title="二、此编译成功后会生成configure可执行文件："></a>二、此编译成功后会生成configure可执行文件：</h5><p><img src="/load_images/php_extension1.png" alt="img"></p>
<p><img src="/load_images/php_extension2.png" alt="img"></p>
<h5 id="三、然后执行："><a href="#三、然后执行：" class="headerlink" title="三、然后执行："></a>三、然后执行：</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./configure --with-php-config=/usr/local/php/php74/bin/php-config</span><br></pre></td></tr></table></figure>

<p><img src="/load_images/php_extension3.png" alt="imag"></p>
<h5 id="四、编译成功后会生成对应的Makefile："><a href="#四、编译成功后会生成对应的Makefile：" class="headerlink" title="四、编译成功后会生成对应的Makefile："></a>四、编译成功后会生成对应的Makefile：</h5><p><img src="/load_images/php_extension4.png" alt="img"></p>
<h5 id="五、make-amp-amp-make-install"><a href="#五、make-amp-amp-make-install" class="headerlink" title="五、make &amp;&amp; make install"></a>五、make &amp;&amp; make install</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<h5 id="六、修改php-ini"><a href="#六、修改php-ini" class="headerlink" title="六、修改php.ini"></a>六、修改php.ini</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo &quot;extension=\&quot;gd.so\&quot;&quot; &gt;&gt; /usr/local/php/php74/etc/php.ini</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">之后重启PHP</span></span><br><span class="line"></span><br><span class="line">php74 -m</span><br></pre></td></tr></table></figure>



<p>需要注意的是，如果在安装php的时候，指定了–enable-gd，那么再使用编译安装gd，就会出现以下报错：</p>
<p><img src="/load_images/php_extension5.png" alt="img"></p>
<p>原因是：再php4.3版本之后，编译过程中使用–enable-gd后，表示gd已经编译过了，不能在使用以上方法进行重复编译</p>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title>多版本PECL安装及使用</title>
    <url>/php/pecl_multi_version/</url>
    <content><![CDATA[<p><a href="https://pear.php.net/manual/en/installation.getting.php">官方文档</a></p>
<h5 id="一、下载安装"><a href="#一、下载安装" class="headerlink" title="一、下载安装"></a>一、下载安装</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl -O https://pear.php.net/go-pear.phar</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果存在多版本PHP，需要指定PHP，多版本PECL安装方式相同</span></span><br><span class="line">sudo /usr/local/php/php74/bin/php go-pear.phar </span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h5 id="二、输入对应数字指定目录"><a href="#二、输入对应数字指定目录" class="headerlink" title="二、输入对应数字指定目录:"></a>二、输入对应数字指定目录:</h5><p><img src="/load_images/pecl_install.png" alt="img"></p>
<h5 id="三、配置环境变量"><a href="#三、配置环境变量" class="headerlink" title="三、配置环境变量"></a>三、配置环境变量</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">alias pecl74=&quot;/usr/local/php/php74/bin/pecl&quot;</span><br><span class="line">alias pear74=&quot;/usr/local/php/php74/bin/pear&quot;</span><br></pre></td></tr></table></figure>

<h5 id="四、使用"><a href="#四、使用" class="headerlink" title="四、使用"></a>四、使用</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">使用pecl安装Redis扩展</span></span><br><span class="line">pecl74 search redis</span><br><span class="line">pecl74 install redis</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改php.ini，添加redis.so</span></span><br><span class="line">extension=redis.so</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">重启PHP</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看是否安装成功</span></span><br><span class="line">php74 -m</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title>Mac编译多版本PHP</title>
    <url>/php/php_multi_version/</url>
    <content><![CDATA[<h4 id="PHP8-0编译安装"><a href="#PHP8-0编译安装" class="headerlink" title="PHP8.0编译安装"></a>PHP8.0编译安装</h4><h5 id="一、下载源码、创建目录"><a href="#一、下载源码、创建目录" class="headerlink" title="一、下载源码、创建目录"></a>一、下载源码、创建目录</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir /usr/local/php/php80</span><br><span class="line"></span><br><span class="line">cd /usr/local/src</span><br><span class="line">wget https://www.php.net/distributions/php-8.0.16.tar.gz</span><br><span class="line">tar zxvf php-8.0.16.tar.gz</span><br><span class="line">cd php-8.0.16</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h5 id="二、编译"><a href="#二、编译" class="headerlink" title="二、编译"></a>二、编译</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">生成 configure 文件(可不用)</span></span><br><span class="line">./buildconf --force</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">配置构建流程</span></span><br><span class="line">sudo ./configure --prefix=/usr/local/php/php80/ \</span><br><span class="line">--with-config-file-path=/usr/local/php/php80/etc \</span><br><span class="line">--with-config-file-scan-dir=/usr/local/php/php80/etc/conf.d \</span><br><span class="line">--with-mhash \</span><br><span class="line">--with-mysqli=shared,mysqlnd \</span><br><span class="line">--with-pdo-mysql=shared,mysqlnd \</span><br><span class="line">--enable-gd \</span><br><span class="line">--with-openssl=/usr/local/Cellar/openssl@1.1/1.1.1m \</span><br><span class="line">--with-iconv=/usr/local/opt/libiconv/ \</span><br><span class="line">--with-zlib \</span><br><span class="line">--with-zip \</span><br><span class="line">--disable-debug \</span><br><span class="line">--disable-rpath \</span><br><span class="line">--enable-xml \</span><br><span class="line">--enable-bcmath \</span><br><span class="line">--enable-shmop \</span><br><span class="line">--enable-sysvsem \</span><br><span class="line">--enable-mbregex \</span><br><span class="line">--enable-mbstring \</span><br><span class="line">--enable-ftp \</span><br><span class="line">--enable-pcntl \</span><br><span class="line">--enable-sockets \</span><br><span class="line">--enable-soap \</span><br><span class="line">--without-pear \</span><br><span class="line">--with-gettext=/usr/local/opt/gettext \</span><br><span class="line">--enable-session \</span><br><span class="line">--with-curl \</span><br><span class="line">--with-jpeg \</span><br><span class="line">--with-freetype \</span><br><span class="line">--enable-gd-jis-conv \</span><br><span class="line">--enable-opcache \</span><br><span class="line">--enable-fpm \</span><br><span class="line">--without-gdbm \</span><br><span class="line">--enable-fast-install \</span><br><span class="line">--disable-fileinfo</span><br></pre></td></tr></table></figure>

<h5 id="三、可能会出现的问题"><a href="#三、可能会出现的问题" class="headerlink" title="三、可能会出现的问题"></a>三、可能会出现的问题</h5><h6 id="1-openssl"><a href="#1-openssl" class="headerlink" title="1.openssl"></a>1.openssl</h6><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">没有找到openssl导致</span></span><br><span class="line">configure: error: Package requirements (openssl &gt;= 1.0.1) were not met:</span><br><span class="line"></span><br><span class="line">No package &#x27;openssl&#x27; found</span><br><span class="line"></span><br><span class="line">Consider adjusting the PKG_CONFIG_PATH environment variable if you</span><br><span class="line">installed software in a non-standard prefix.</span><br><span class="line"></span><br><span class="line">Alternatively, you may set the environment variables OPENSSL_CFLAGS</span><br><span class="line">and OPENSSL_LIBS to avoid the need to call pkg-config.</span><br><span class="line">See the pkg-config man page for more details.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">另一种可能是编译参数中openssl路径不对，注意brew安装路径</span></span><br></pre></td></tr></table></figure>

<p>问题解决：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果是使用brew安装的openssl，可以先使用brew list查看是否安装过openssl</span></span><br><span class="line">brew list;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果安装过，可以执行：</span></span><br><span class="line">brew link openssl@1.1</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">这时会收到警告：</span></span><br><span class="line">Warning: Refusing to link macOS provided/shadowed software: openssl@1.1</span><br><span class="line">If you need to have openssl@1.1 first in your PATH run:</span><br><span class="line">  echo &#x27;export PATH=&quot;/usr/local/opt/openssl@1.1/bin:$PATH&quot;&#x27; &gt;&gt; ~/.zshrc</span><br><span class="line"></span><br><span class="line">For compilers to find openssl@1.1 you may need to set:</span><br><span class="line">  export LDFLAGS=&quot;-L/usr/local/opt/openssl@1.1/lib&quot;</span><br><span class="line">  export CPPFLAGS=&quot;-I/usr/local/opt/openssl@1.1/include&quot;</span><br><span class="line"></span><br><span class="line">For pkg-config to find openssl@1.1 you may need to set:</span><br><span class="line">  export PKG_CONFIG_PATH=&quot;/usr/local/opt/openssl@1.1/lib/pkgconfig&quot;</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">首先添加~/.zshrc环境变量：</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">pkgconfig</span></span><br><span class="line">export PKG_CONFIG_PATH=$PKG_CONFIG_PATH:/usr/local/lib/pkgconfig</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">openssl</span></span><br><span class="line">export OPENSSL_LIBS=&quot;-L/usr/local/Cellar/openssl@1.1/1.1.1q/lib&quot;</span><br><span class="line">export OPENSSL_CFLAGS=&quot;-I/usr/local/Cellar/openssl@1.1/1.1.1q/include&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">然后注册到pkgconfig</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看openssl是否在pkgconfig中</span></span><br><span class="line">pkg-config --list-all | grep openssl</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果不在pkgconfig中，可以新建软链接</span></span><br><span class="line">ln -s /usr/local/Cellar/openssl@1.1/1.1.1q/lib/pkgconfig/openssl.pc /usr/local/lib/pkgconfig</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果还报libcrypto.pc  libssl.pc相关错误，那么也要建立软连接</span></span><br><span class="line">ln -s /usr/local/Cellar/openssl@1.1/1.1.1q/lib/pkgconfig/libcrypto.pc /usr/local/lib/pkgconfig</span><br><span class="line">ln -s /usr/local/Cellar/openssl@1.1/1.1.1q/lib/pkgconfig/libssl.pc /usr/local/lib/pkgconfig</span><br></pre></td></tr></table></figure>

<h6 id="2-libjpeg"><a href="#2-libjpeg" class="headerlink" title="2.libjpeg"></a>2.libjpeg</h6><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果报libjpeg相关错误，且通过brew安装没有效果</span></span><br><span class="line">./configure --help</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看jepe参数配置</span></span><br><span class="line">  --with-jpeg             GD: Enable JPEG support (only for bundled libgd) #仅适用于捆绑的libgd</span><br><span class="line">brew install libgd</span><br></pre></td></tr></table></figure>

<h6 id="3-pkg-config"><a href="#3-pkg-config" class="headerlink" title="3.pkg-config"></a>3.pkg-config</h6><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">configure: error: The pkg-config script could not be found or is too old.  Make sure it</span><br><span class="line">is in your PATH or set the PKG_CONFIG environment variable to the full</span><br><span class="line">path to pkg-config.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">问题解决</span></span><br><span class="line">brew install pkg-config</span><br></pre></td></tr></table></figure>

<h6 id="4-gettext"><a href="#4-gettext" class="headerlink" title="4.gettext"></a>4.gettext</h6><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">configure: error: Cannot locate header file libintl.h</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">原因 --with-gettext编译报错，没有找到gettext可执行文件，因为configure文件中gettext的默认path是</span></span><br><span class="line">for i in $PHP_GETTEXT /usr/local /usr ;do</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">问题解决</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">找到对应可执行程序路径</span></span><br><span class="line">which gettext</span><br><span class="line">/usr/local/opt/gettext/bin/gettext</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果<span class="built_in">which</span>没有结果，那么执行安装</span></span><br><span class="line">brew install gettext</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改--with-gettext</span></span><br><span class="line">--with-gettext=/usr/local/opt/gettext</span><br></pre></td></tr></table></figure>

<h6 id="5-iconv"><a href="#5-iconv" class="headerlink" title="5.iconv"></a>5.iconv</h6><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">configure: error: Please specify the install prefix of iconv with --with-iconv=&lt;DIR&gt;</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">原因：–with-iconv编译报错，没有找到iconv的可执行文件,或者系统中没有libiconv</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">问题解决</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">找到对应可执行程序路径</span></span><br><span class="line">which iconv</span><br><span class="line">/usr/local/opt/libiconv/bin/iconv</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果<span class="built_in">which</span>找不到</span></span><br><span class="line">brew install libiconv</span><br><span class="line">whcih iconv</span><br><span class="line">/usr/local/opr/libconv/bin/iconv</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改--with-iconv</span></span><br><span class="line">--with-iconv=/usr/local/opt/libiconv/</span><br></pre></td></tr></table></figure>

<h6 id="6-类似问题可以使用-x2F-configure-–help-gt-gt-文件名-txt-查找对应编译参数，查看参数是否改名或者移除了，例如："><a href="#6-类似问题可以使用-x2F-configure-–help-gt-gt-文件名-txt-查找对应编译参数，查看参数是否改名或者移除了，例如：" class="headerlink" title="6.类似问题可以使用**.&#x2F;configure –help [&gt;&gt; 文件名.txt]** 查找对应编译参数，查看参数是否改名或者移除了，例如："></a>6.类似问题可以使用**.&#x2F;configure –help [&gt;&gt; 文件名.txt]** 查找对应编译参数，查看参数是否改名或者移除了，例如：</h6><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">WARNING: unrecognized options: --with-xmlrpc</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">原因：xmlrpc在PHP8中移到了pecl中</span></span><br></pre></td></tr></table></figure>

<h6 id="7-所有问题都解决后，重新编译，成功后显示："><a href="#7-所有问题都解决后，重新编译，成功后显示：" class="headerlink" title="7.所有问题都解决后，重新编译，成功后显示："></a>7.所有问题都解决后，重新编译，成功后显示：</h6><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">+--------------------------------------------------------------------+</span><br><span class="line">| License:                                                           |</span><br><span class="line">| This software is subject to the PHP License, available in this     |</span><br><span class="line">| distribution in the file LICENSE. By continuing this installation  |</span><br><span class="line">| process, you are bound by the terms of this license agreement.     |</span><br><span class="line">| If you do not agree with the terms of this license, you must abort |</span><br><span class="line">| the installation process at this point.                            |</span><br><span class="line">+--------------------------------------------------------------------+</span><br><span class="line"></span><br><span class="line">Thank you for using PHP.</span><br></pre></td></tr></table></figure>

<h5 id="四、安装（可能需要sudo权限）"><a href="#四、安装（可能需要sudo权限）" class="headerlink" title="四、安装（可能需要sudo权限）"></a>四、安装（可能需要sudo权限）</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">make</span></span><br><span class="line">make</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">make后的结果</span></span><br><span class="line">Generating phar.php</span><br><span class="line">Generating phar.phar</span><br><span class="line">PEAR package PHP_Archive not installed: generated phar will require PHP&#x27;s phar extension be enabled.</span><br><span class="line">directorytreeiterator.inc</span><br><span class="line">clicommand.inc</span><br><span class="line">directorygraphiterator.inc</span><br><span class="line">invertedregexiterator.inc</span><br><span class="line">pharcommand.inc</span><br><span class="line">phar.inc</span><br><span class="line"></span><br><span class="line">Build complete.</span><br><span class="line">Don&#x27;t forget to run &#x27;make test&#x27;.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">make install</span></span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<h5 id="五、配置文件"><a href="#五、配置文件" class="headerlink" title="五、配置文件"></a>五、配置文件</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cp php.ini-development /usr/local/php/php80/etc/php.ini</span><br><span class="line">  cp /usr/local/php/php80/etc/php-fpm.conf.default /usr/local/php/php80/etc/php-fpm.conf</span><br><span class="line">cp /usr/local/php/php80/etc/php-fpm.d/www.conf.default /usr/local/php/php80/etc/php-fpm.d/www.conf</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">注意：如果是多版本PHP，记得修改www.conf中php-fpm监听的端口listen=127.0.0.1:9001</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改php-fpm.conf</span></span><br><span class="line">pid = run/php-fpm.pid #前面的注释去掉</span><br></pre></td></tr></table></figure>

<h5 id="六、使用PHP自带的webserver测试是否安装成功"><a href="#六、使用PHP自带的webserver测试是否安装成功" class="headerlink" title="六、使用PHP自带的webserver测试是否安装成功"></a>六、使用PHP自带的webserver测试是否安装成功</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建index.php</span></span><br><span class="line">cd PHPProjects/test</span><br><span class="line">vim index.php</span><br><span class="line">&lt;?php</span><br><span class="line">    phpinfo();</span><br><span class="line">    </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">执行</span>   </span><br><span class="line">/usr/local/php/php80/bin/php -c /usr/local/php/php80/etc/php.ini -S localhost:9002</span><br><span class="line">[Mon May  4 16:46:01 2020] PHP 7.4.5 Development Server (http://localhost:9002) started</span><br></pre></td></tr></table></figure>

<p>打开浏览器访问：localhost:9002</p>
<p><img src="/load_images/php_webserver.png" alt="img"></p>
<h5 id="七、Mac环境变量配置"><a href="#七、Mac环境变量配置" class="headerlink" title="七、Mac环境变量配置"></a>七、Mac环境变量配置</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">alias php80=&quot;/usr/local/php/php80/bin/php&quot;</span><br><span class="line">alias phpfpm80=&quot;sudo /usr/local/php/php80/sbin/php-fpm&quot;</span><br></pre></td></tr></table></figure>

<h5 id="八、启动、关闭php-fpm"><a href="#八、启动、关闭php-fpm" class="headerlink" title="八、启动、关闭php-fpm"></a>八、启动、关闭php-fpm</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看</span></span><br><span class="line">ps aux | grep php-fpm</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">关闭</span></span><br><span class="line">sudo kill -INT `cat /usr/local/php/php80/var/run/php-fpm.pid`</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">重启</span></span><br><span class="line">sudo kill -USR2 `cat /usr/local/php/php80/var/run/php-fpm.pid`</span><br></pre></td></tr></table></figure>



<h4 id="PHP7-4编译安装"><a href="#PHP7-4编译安装" class="headerlink" title="PHP7.4编译安装"></a>PHP7.4编译安装</h4><h5 id="一、下载源码、创建目录-1"><a href="#一、下载源码、创建目录-1" class="headerlink" title="一、下载源码、创建目录"></a>一、下载源码、创建目录</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir /usr/local/php/php74</span><br><span class="line"></span><br><span class="line">cd /usr/local/src</span><br><span class="line">wget https://www.php.net/distributions/php-7.4.28.tar.gz</span><br><span class="line">tar zxvf php-7.4.28.tar.gz</span><br><span class="line">cd php-7.4.28</span><br></pre></td></tr></table></figure>

<h5 id="二、编译-1"><a href="#二、编译-1" class="headerlink" title="二、编译"></a>二、编译</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo ./configure --prefix=/usr/local/php/php74/ \</span><br><span class="line">--with-config-file-path=/usr/local/php/php74/etc \</span><br><span class="line">--with-config-file-scan-dir=/usr/local/php/php74/etc/conf.d \</span><br><span class="line">--with-mhash \</span><br><span class="line">--with-mysqli=shared,mysqlnd \</span><br><span class="line">--with-pdo-mysql=shared,mysqlnd \</span><br><span class="line">--enable-gd \</span><br><span class="line">--with-openssl=/usr/local/Cellar/openssl@1.1/1.1.1q \</span><br><span class="line">--with-iconv=/usr/local/opt/libiconv/ \</span><br><span class="line">--with-zlib \</span><br><span class="line">--with-zip \</span><br><span class="line">--enable-inline-optimization \</span><br><span class="line">--disable-debug \</span><br><span class="line">--disable-rpath \</span><br><span class="line">--enable-xml \</span><br><span class="line">--enable-bcmath \</span><br><span class="line">--enable-shmop \</span><br><span class="line">--enable-sysvsem \</span><br><span class="line">--enable-mbregex \</span><br><span class="line">--enable-mbstring \</span><br><span class="line">--enable-ftp \</span><br><span class="line">--enable-pcntl \</span><br><span class="line">--enable-sockets \</span><br><span class="line">--with-xmlrpc \</span><br><span class="line">--enable-soap \</span><br><span class="line">--without-pear \</span><br><span class="line">--with-gettext=/usr/local/opt/gettext \</span><br><span class="line">--enable-session \</span><br><span class="line">--with-curl \</span><br><span class="line">--with-jpeg \</span><br><span class="line">--with-freetype \</span><br><span class="line">--enable-gd-jis-conv \</span><br><span class="line">--enable-opcache \</span><br><span class="line">--enable-fpm \</span><br><span class="line">--without-gdbm \</span><br><span class="line">--enable-fast-install \</span><br><span class="line">--disable-fileinfo</span><br></pre></td></tr></table></figure>

<h5 id="三、其他同8-0安装"><a href="#三、其他同8-0安装" class="headerlink" title="三、其他同8.0安装"></a>三、其他同8.0安装</h5><h4 id="多版本composer配置"><a href="#多版本composer配置" class="headerlink" title="多版本composer配置"></a>多版本composer配置</h4><p><a href="https://getcomposer.org/download/">composer下载</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">把composer.phar放入指定文件夹</span></span><br><span class="line">mkdir ~/php_plugin</span><br><span class="line">mv composer.phar ~/php_plugin/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">配置环境变量，指定PHP版本即可</span></span><br><span class="line">alias composer7=&quot;/usr/local/php/php74/bin/php /Users/nonfishz/php_plugin/composer.phar &quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">测试结果</span></span><br><span class="line">composer7</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL InnoDB MVCC机制的原理及实现</title>
    <url>/mysql/mvcc/</url>
    <content><![CDATA[<p>MVCC（Multiversion Concurrency Control）多版本并发控制，通过一种可见性算法来实现数据库并发控制。</p>
<span id="more"></span>

<h4 id="两种读形式"><a href="#两种读形式" class="headerlink" title="两种读形式"></a>两种读形式</h4><ul>
<li>快照读：读取的是当前事务的课件版本，不用加锁（简单的select就是快照读）</li>
<li>当前读：读取的是当前版本，例如更新、插入、删除操作以及特殊的读操作</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">update table set ...</span><br><span class="line">insert into table ...</span><br><span class="line">delete from table where ...</span><br><span class="line"></span><br><span class="line">/*特殊的读操作*/</span><br><span class="line">select * from table where ... lock in share mode;</span><br><span class="line">select * from table where ... for update;</span><br></pre></td></tr></table></figure>



<h4 id="uodo-log-回滚日志"><a href="#uodo-log-回滚日志" class="headerlink" title="uodo log 回滚日志"></a>uodo log 回滚日志</h4><p>undo log是可见性算法的非常重要部分，分为两类</p>
<ul>
<li>insert undo log：事务在插入新纪录产生的undo log，当事务提交后可以直接丢弃</li>
<li>update undo log：事务在进行update或delete的时候产生的undo log，在快照读的时候还是需要的，所以不能直接删除，只有当系统没有比这个log更早的read view的时候才能删除。所以长事务会产生很多老的视图导致undo log无法删除，占用大量存储空间。</li>
</ul>
<h4 id="read-view-读视图"><a href="#read-view-读视图" class="headerlink" title="read view 读视图"></a>read view 读视图</h4><p>读视图，是MySQL秒级创建视图的必要条件，比如一个事务在进行select操作（快照读）的时候会创建一个read view，这个read view其实只是三个字段：</p>
<ul>
<li>active_trx_id：read view生成时刻系统中正在活跃的事务ID</li>
<li>up_limit_id：active_trx_id中最小的事务ID</li>
<li>low_limit_id：active_trx_id中最大事务ID+1</li>
</ul>
<h4 id="可见性算法"><a href="#可见性算法" class="headerlink" title="可见性算法"></a>可见性算法</h4><p> 主要思路：当生成read-view的时候如何去拿获取的行记录中的 DB_TRX_ID 去和 read-view 中的三个属性(上面讲了)去作比较：</p>
<ul>
<li>首先比较这条记录的 DB_TRX_ID 是否是 小于 up_limit_id 或者 等于当前事务id。如果满足，那么说明当前事务能看到这条记录。如果大于则进入下一轮判断</li>
<li>然后判断这条记录的 DB_TRX_ID 是否 大于等于 low_limit_id。如果大于等于则说明此事务无法看见该条记录，不然就进入下一轮判断。</li>
<li>判断该条记录的 DB_TRX_ID 是否在活跃事务的数组中，如果在则说明这条记录还未提交对于当前操作的事务是不可见的，如果不在则说明已经提交，那么就是可见的</li>
</ul>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>nohup命令</title>
    <url>/command/nohup/</url>
    <content><![CDATA[<h3 id="nohup"><a href="#nohup" class="headerlink" title="nohup"></a>nohup</h3><p>no hang up</p>
<h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nohup command [Arg...] [&amp;]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">说明</span></span><br><span class="line">command 要执行的命令</span><br><span class="line">Arg 一些参数，可以指定输出文件</span><br><span class="line">&amp; 让命令在后台执行，终端退出不影响命令的执行</span><br></pre></td></tr></table></figure>

<h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例1</span></span><br><span class="line">nohup /root/runoob.sh &amp;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">示例2</span></span><br><span class="line">nohup sh runoob.sh &amp; #后台通过sh执行脚本runoob.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">杀死进程</span></span><br><span class="line">ps -ef | grep runoob.sh</span><br><span class="line">kill [-9] PID</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>laravel-project</title>
    <url>/laralve/laravel/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <script id="hbeData" type="hbeData" data-hmacdigest="93719ab034ebc91f4a9a10058a420dd16d7d4ee397b3c92a6e193aa785444a77">cc4eaccd88a7cf11990f2cd15dba7187df456301bb385f7d6a86c8b5839533e6283f717e31f89f04aabbd3573f508c101148e180f7230812020151847ff7c782fdf809b7aac3b934e6806a65ded924a7a87150b1ab54f139fbaec2aa7563a890823d10a1e845b6ddcb7814f317f995de955df77ae121fe67c8930e247500e028c19e73da90814f82130e3d7b9cf8a98efa8638bea5ac843bc892e290b8950150e5917d8db9f3fe9999eca8e49c852386085a5d7274448b2b8a23d84af7d05fb3d3346c92f9b17bbc10156dc86489dfa266d37368d90e94fc9763287e84561b5467073c8990680c331d55dfb1ce9757bf3b58f0f46e93ab8f0d8580d01ec42420fbe3a99090e29d5392213ec2dd8c469d0def58d4a5024efca807c0524a7b93f4915ba7f601ea60ae6d1f8860d0035d075c77bfacb8b941adbc664773fbbf67d5f760ba3f05d6eba6740b352872a80db9cd74ed43bc255ad20ea660302c07b47fbde87490cdf08ffea59e813d5ccfddc5e255a16808a3aedcf2da010ea82a3eb6a075bbfd541ca46868f2403d23275edf92a145f326bc67c1c1d47f6b72d92213985f2a281f05b7300c5c658eb877d25a43e7f1b8a654dfd07dc10a7c4c4a51cafde4de5562f718e235d9e2207795ee9fd522659deb69f28b97749a345a2780e783a35ae669f9b5063e8914798cd720657d807023b28452ffe18ddb4391df15c90d99218adde37e25d6fda6675e3bed43a172c6b177546bf1054b3c0dabc82b72cb42352b04bbe1c04b9d3a43d82f045dac306e078dfb6d6d1b547534287ee46b591ed0145d2a19ea0efb3ce3679862f05e867bf5dbdafec68e424256b1cb5f6944877fb97bed66e197c00dc2f1677f84b181ea4c00866b13cc91bf065e6a04c03d90255c247efdfda6e3ff712e5e45df983624b540d872192ee159c5f8abe5a780a7308c920e74b48c417b028a24b4d2c56137bb2d47616a612b16978726b4a2163fae3817a7cb175b6b5212cab7444448ec96155846fb3a959562e018823fe21657d2cf46c47e8d31e03cd56ace9be5640833fdb66cd0d4536f7c45dbd5ff1c9387d37289828822bd25016660aa81cda864f595a117bc94bbbbc41756ee5e7fe7c0199505c6516e5d45b93cd33ffb7109e8bea6a1ff3db1e5bd1a108ded99158c47c0d7f293c0db110b1d50400c92d68e7fee1d4a8e4d34b02a5f7db61d22b92babf42a1071ea301a91302ba16bb06f788cb0b18698f0667ccee53ff424f3736e32f87437a0291d572e4b8119828e33a717715eca8df8b7dbf06e4900bc9b9700b2c2d2be025eb95072c0e99dd7c9fd4bb164c3ee9fc533a2a635608349598badee96306ead5ae51ab26e7dc6d2ba79e51636d8cf46474ef933241de26f500ccbcf9922694e5ef5693da98e7c7c5e68543e52fecdf6af7408cce8fea991919f0dd8f5979a183854642f23d7f083a70b10810b727baa9c02249a908ff8d29cb47a594b7d664bd15ea319687724dd9de19da624787b2c0294a56bb30fd59771a8d5331703e0283f1e615205199b29822e577f23d455a25fea9eb3c58a3f8f5eb08ac6e1d924fbdbfdc8356f907600bd123f8e7e94c2fb12fdcc6997254ea95d549a1e0a318780931feffbb900157cae3bc5347b6d510a189d3a6c317938a02899f7f0c8802c957b3a6413ea3fa7e65af56138e011b567898825673df1c469c3a3b42f718fbc4941da7cddc54c510192ee3c70e0be299db568e72e4c41d60443f1ab550f38c51e922c12e6b00546ee812ce8b337e120fdd1afc62e67f237b34cec6b716e8a1b211d733818a7815d1f3d422d875b2f07e16a2236f32220ad6179781577cdb808c7eed54b63803f7b7b814e1a8dbf9d760299d2eb3432d7cdaba3e62f75f6f3680c158d39da062373ca59a38be00fe41c14be23185881ee94383d9cf95a7885c6b7a61a62492b241ce3c19dbd40f2bf69ace541f1fbe3fd86540c02570113b77af3169fc7aa1b0622ab1800baaba5c45b645c07db5c2ec6011d162f49dbc08701343ec915474a448fd72b506885a12757a63e261c668b0c306d404615b6e5c3e69e146e3f9114ab9474027a809d016684e508484f433f49007c05bebaed6d17dfdf8441004e7b465d72571496ac9d704379c3946f378e19412f5e28dfb033758603a2b3154b7a2e265f56a90cae1b0c6493e2c926badfe24125dff21837d66124addc3e6a73c657123162fd344da8556c33c57ec1d15bc8d1560c0d7eebaf98b64ad9b4109835fedae73a32c3f793ccb78b9c28b4520e50712964977c72439b6ac798840bf55bbe86073dc10c22a4cd52aa6f1adff9139b7ac8e20b81d64a31a6f2997d2ba7c88f519b571142daaa696231a45c31f92cde43ee74697267c4fec6b7348d707cc4c33f271cc1c18b4aa154f2d584c6b44fe1589131ba2243cfcb6106b59a058513f9292157668541f2582a87ff6e8fcb688db7ea4c9fafed46113b618027e1c45b6717232cf87380a659b1b6f0cdff35f39852a11a92b487b54cb7162f12003e8465a095012717c51c1149e1a768c5c1c2960b3487230b20840a48ee7c7198368f948d1394381ac5c38dcf0e854baab608f36d92f0e4eeee7f47e15730e108fb53fa278f385b422ce876addb3c5d6ce51c5699cdb39090d06c191aec6d4cb2516d942cae30433b1e8bb1249825b23883cffedc322f3b03a62e701ecee1a31a2ab682e8cbbac28b71948f24339a39fdbc04082ed26e7e8febfba14047dd8b74bd359dd42da189f11639e0a351264f53b43745a6e7739f77073033cee575227628a3b9fbfed9f51ff8aec67dda8c97b596b7c6f18479bab54906514c195c3cacdb07b5d83da951d54a4bf0d9510cd062ab27b8fc785a0627989915bb6afb54b518fdce8e301f7784b5d30809573196e6755f83efe919080325757a1d8ad539395a5d8e5665b7c8a091c919bc5fbb9ebe79e3e7299c28818f5e469fcb5c2865e9376cbed6f4ea964cf6578604057b093cbf65740d1f675ea5aec05c09e5fae82499a7fac2782056f98ac1023d1e3183fd441eca6719e982e5634c68ba8847f2121fcd34c879b26cab00de20f54c5dbea0bf86f42f91cff92a998b7a1ba655009da92ec30e321d0085d8d78d0136df1d0823ea632091b9f39d8890b5ef70f8d21277c2a797807c9dc90e01e3f7c3c88d6ac437c1e93a8506f0e6bff22074aa8736c2b020de65e06d6307fd079597f2f26a3ee3803c339c6db8200119a6be15d4128391d8b9478829a3e9dc743eb6745c7b3fcc4ba3ca438482bb232f80b7c515eabd12d1b505bdf41b4613f00e35b874fba4ebe0eb9a4ef6ae2c970e7aa72f284b4f0d5cdbfa9352f6bc748b621273050d7327c716d74b5690eadb6a6dc853dd9add2e743a9783068cc631673151882f561639fdd77fff27acebdf4b2f7655c1a56f9ece5258f0ac82877cefb185c43b0eec7e88a7ccf5c956152c42f2988bf0cfa2ba8206642b9d1fef817c1e4b56b730ae3b82b1d85fceb3be3b5ed47153a5694fdc04689adaedcd9515d7f5e818e571b6d6695a2ffe1224bb7070cde319de317336128e5312939734fe16cc941e9acbab8851712b563a57e3f837e7e81c2ca6c55529dfcfaca3c4e5e6ccd68dcb50bcf228d22543b2441c6c68133a2e4b79a78344ffe2b6cf078a99af2afd47fa8d2a31318280d36fa74263278c559e28522cd489626b7bed27d02496d931989150b0143ffb0a05b7d949e01d0c9d420f9fe7b154a695b41cc6c865e8002a8706f1f67ab9087e92d68590b1e78a232139c1c5e9376b5aba6756e579dfe3059e4f0a7037af2aceedc588ec627404ce1238e553817edc0726508ef6cf57d73a6528ddf46141c87182d4d91d87526dac849d10824608e740c00e3b4b8057e580d588ee9c07dfc01791aabf93a67aeab44071cb834d9bdfd54d3ecc1033cddd8c136b3c0fab3e05cb44b6c00aaf45ebda7912745e37d5d268303e9f128b9829c5d4ee049c9ea7e4c599e6814249d63a3ffb7d42c06a601b259f1732ccfa4fb6259c75529b073c3193b6b95f6d8e0a05ac8555b8d7fb07cce7ec5e63d800b42a5c88cac04af6776fde94a4b84a4681e994804c03558809a7f32e567661b57502d55a762abf8b744df8f1cc2dffd546d949e207ba49d0350802fbe033ea94b0a88720ecc4903525ac18ff7da6f74ab1048657397d70d6765b512ada0f7a00f2130affa0aa5b1c45c57cfd0c421e3d6ccdabb1b8d270531a9cff93c3ecdbd4f1b5fe6122cd68a4bfd0a046d90bc66abfffde394586d7c745eb03f2fcbfe3604158bb7baa8560db45bab5e191bd1b2fb93105717fee5750cf0931b361074aafbb1f1fa0bffce8ab3b0f20c3e4e7b397b94c2fcc0524ba8c46e5a48ace95665de9ee5d2868ff35a836d9b863fdd4ba68d116c0889bdde407d3e23cf5103a0911649e8cbe68e343d9a816803532de2ad40653de01cf5c3740eabcb73e9e55ac66e50166d7471a1d43da5a99bacf0c755de32694bc15123e90ca84cab75666ccd4b24c178e10c48215d5e267345d2aef0f0e2692462fac834a6df882b210d0d4983af2ddbda0d9190d55ec77c94aca4790b7ed2d200cb188ff54a062177cc8521a406dde13e680d21b48d0822c1349bbaf4b40d83b6a0ace831bee24566ed8637389bd1f3a91f4e9b2589dc994310b8f8a94b029aaa21d2804d350c8dc034a4e01f73f3c4567705443481a5377927bd78fdb722d09037506e976433fea531db82ab5abfec8a5d448e67ca832b52fc47a0df8ebe57dcfc0aa0e0b31aa6b51bdeaa4f68c8c2ac6f737b16860ab10de04693f11d267b6ea66c614898a61f58e9c10869cb113b0202d894e442e430e4bbcb4e3d5afafc66d0776d2e3f6f344484d12415ec395eec3cab6722781ee1a17857761a94407a622ac57b9c3cec7959595ce57e95e1bf9f1321e07e0ef3d9484dd8bf90614b1836f0950aa80120643b986072b00d17ccecf3059d85634772ba5a601fed00c7a9082d9b9b17a97faf4ff5df49b70c14942adc182b61dc873f1e7e5cc74821130eb6385492f4221841a50274eb5a114f01ebe6ea839102f3867d4a5ae76ede2fe1046c20e2d401edbeaa33b7e7866d63591932fc7f15f241662c01ed96b2745bcb3a1c66cc10d276a8e1543c905f6358c198d3858ee7db6981f1b1abce1e23c5efdc3250f4112eaec8b31566554cb100920b3f2edb275b20d9419558eda9e08edbb58c31f5793f0594a0e37b2cad2302c5d9307c0b4372bfa6d2ca8ee1e9147d222cbda052656e5b1b38948f9d269b7fe3b7bd6e3e352aee84c5b7d5f229951a5959ecbfa31e7a7818040e5de81cdccb7bd7d71491831bd1200b330140d36e7c9071b457748cf0f1479e20cdb85d1ab1ceb000667a06bb5c96200df89422dc152fb2c7c2bf235a1bea83a004a62e7f3ee3458f68477d97259301a383325f4d6c7c715424d7f2639569b45f1f9e64c8da191cac9ff87d157df313f52f6d3ab08143d41326cdeb64eda798bf315414a65b0d45405d78b5f95f33e9df2667892bf32730c5385aa8c432e10ae935b58be53e01b26124623e4ba9935073c5f4241e2da444ee2bf913657ef01415a82fc25516ac99d8e55a15cbd4a17bbb2b1d7101da80780599e429cb0d7d463646a5c7bb01326af174686635a0acfb58e9915821cdd2c60359e956946047a8f9b6d9109342bcd06d57e102d250a36f64b454d4bd6d100f92afb53d11a622fbef53a6585972203bad79c45a2378becbb836d5348fa5e6768ed34a2fdf8df1887bf2783f217f4f24af58768b205d0ba879908a3b8a662c5a67f35773acd287ec672728d1de326ceba7adc7195f3416e5d61f7fd4222f3b52052b434bef6aa20fbfe3849ddf8b2224c2735ed7eca5cc573ee774a5ff76998196e49a8699cb3796bffdcc6856a5a669be7676bb9e449db1547a3d81810128c1ec2c7edee638d8264f2c8a3a44da9d5214907b492ffa0ab018a37cbccd3e221be01a9ec7eab8466867915915dfd183988f0dfe56be72ddd5a1ee04b48efbb9fbe561bd3b0a313baf2805a8438ab7d0ac86d3637d6ea4c2bb8413b4d653d97df6c13e72c5f92de13e10311eef8b050ae9416e5f07ba7668dbd970f4584198c036745173d6b09ff8bb0379ead5b41ed3c196cde662b8ae98efb2570bab49265b6e8dd3c165b20df97a21276747baebe61c0d9fddd46bbf69005b68a32cd4d145a0400004749251fae69a37760db89a394893158665e4d664eb66b28e247ff9265bcd97324a9288c30f7a28a94f48f2efddc43a4e86719dcc97b3436ae821fba379c66779cd368324c3d2048eff8232aa92e7afa77612d3428fe2b34b534b1da43b285263c06bd2710910a9eccf6daac18ca7e5852db9216d0a0299af7ab95fd74e4bb21e547f574d57de27faa1dafdc9934a6848e40a0b47b82bbe8b2912fc2b082bbc7842d2438b0c9066ce60483f60989ac70423e2b3b48583cc23cb08135b2c9979ad5ba34e3ecb40e681fab425c9bd37e65530679608da403717e3d699fd438eaca8c61b7da449f6f6937e309a7110d19e08a9947586e9bc29d273a1bf3278ff1f693b57b5a0ce6a3afc36183c1babf0b4c51470ce4075bfca31463b801f724e4f1287f37f6ba786f036157fe99485139abd48006b08ce015fd8a864a68444935ddf816154ef4fd333aa5b56c8441e026862859d0fd689c221f84a193b4abee302b0f987c8655bbe12ac9160630248df825ee1879b578a981ac0a2b859341336e3812e8867d8be78f706e2e9266db014ba79d0296b389a7bf532cd35bebb1f042bd191c2168661beaf97c318ac987143c85d08efdf99299a34014c66fa7a92a0988f2911032ae7433faf48b76997461187f4b142ada68bd5cbfa1d4d18347620546eae35e6d305984dd148a208761fde65583465cf1159dc187a5867f09af75444f64bff332527da41eb9ef8e04df3d1cf69b36ac8e53554f1689f3c27366ad70b47b78165dd825167c21a0aef75a4d5b5e50bf7c2eae6cfa9cc3274ad5a8898e579b7fabfd6d1d2a2c178dfb09dacd2190f929771355524eb94b9e33ad0d70efe805139d585e8e168ef5b78b1330d0521fb44c8874d92962fc0c7ad60a8138ac304b9ec9e4b30e1c408d6c0494976908411e785909e7444b78ebe2de882c69af2df24b5b5743b0f57e21d74dd679375865b4020c9c69163e06eb726ff017d4386af4b8c3984166af1f5c003af6af74e575fd6ac4a99a94270b717391d4697b0649e601e3049f37040bdb030becdb37ba3000639dcc0cc492a5d4797f5cd4ee008b25e0d5fe45b88c6375ebade94e09cd33b6bcc9e96ec23280cd82788f90a9799d70f10c89bff580cbef3157050538fe57d9a5b9c86256d74b11fa9ac78f832f4e93441b8c28c4a1884f4835e78e47ea32d86e68a3547d40b02b9672eb1389dcb3854ccfeb4dcfd5dfe5928183742ea64935d57ab55901848f7e7599bac4c28b6bd048a355077b3984309a10a2be10d3f6d24928b0c68513b5423d3763c7a88c4cb80ae37063ff496767623cd0845ce6dfda4bf230f78db7d2639f6a2c35c8bbf771320f6be65bf3acd3941a457b3a11aa04066338204c3b263e8a339379833d01f1cfed1d9396f5f2a65353feec48ec6302fb10063c1ff7ac97d212afec3b3c8587b9071f065ecd4a6ff1c1897b13689d1e4a01513e4444fc4242a336141ccce92975cf60f53875123132bdfdda14892a80968f7b46e740b5d4139651e20d7afad8b6995a529ec14bd783bb06f0f4e824ea2ae130e513b4ca46ce794b70e92a8cb9b286a2dd45c6ba0b040c887d531c798fddfcfb671e504c272891e8837c2b1af5329af92a26efce3858e9bb7dadafa34db2da8d5c45a57cdcb3a8798ce41a176107d0675200a5a887bb8fdba4c85950b1d49b9116587cdb406d4eaa842ebae690db97a0ed2dd4b96dec4aefcac44126d500bba6c60f64229013b0e4d99cce1ca38f4b3bf156e28079c3cbfdf147b9e8f7f5741a7e17d4046767c392b609d867540dabd2a8d48303c028fca1c09092d7dbeda8255b1d22c2e171615fe34669c4a6c15cc7d383afaf030a2f0385ef079ca7e8efda9ada8fad6e7e7553e90f2f0324772bfc78be2f44eb5c42e80265298e0edf7f8e8b89259de7fda33edf771fa3feed71b65898e72498cff7ceb72c89e9dcf1e80d9e3b0f09ac65c03831c68ed3d25c1370715c1d31466b5a741fa318c736ebf8047652b9a20dedc9e42914c7bb1328365ccda908d13797ec05cede5f24d1cfe94b22b62141e0e558f6a62a1479d1b87fbc6563776f3f41e84ce7f1480411bee40f5fb078522d8f243bd1e336f15e48f22b0c5870bfba53acf77559f4d69f956fde891ea6d6b340375dd4af46b0bd4125232bbdf13885c745ffe6e978b5843fb461efd8c2fd312c584a82438c93eda006dddebe4927df5e62d78d7d2a09589da2793c0c0e917416269a62d7fbaae578dee2adeff9d8acb54b96d5357fa8c476699da761d0ec8cf150feb73f277e35b8cc787a96481d0c2c6bf335ba45c12420d54fc515a6e530b25761820ac90a9b8d95f73d36887279e9856ee2388a96ac34c7f92d2ccf3f98222765b4948af37a098342b4dcad5a4ab051b38f8fae7153b6f207923b93bd8bc603c6b02ea5228d10e6d89649fd43162136a2d1ef487bb26e53e7b538d1e8678190979c4a171f1b3a431b0b197cc319d4ea3e1ee71dc6127d085b4f0076d6e0dcade79f03eddb03d7ff144abe033ab4f60b98ddda3471c2990c37ceb624db0cb252be001232cdbf0e99a9b2f623420dc803e938d2bdc1f7061e596f181ed3d7bf504ed214508bb10dfa36396b115ce3878f763a69f833246bf83a6a2365f7d970038c1d445877ce7334f79203e26082f5b555985b55a9b723f761aa599fb2140176b9ce8387c3dfad5084d70700001b636f1edb4577b4f3dae925e6ca984b53700dfd9a2a86a601a5b8d2201724a82b11c0cbcdc7d7724e2b0f54e815c75a0628b5fc268f6c9ef1bf407c54e858de5fdf33ed93fa1298c26934b3842bb6dd15caf8254e4f9f3e305c09abdfe1649cdaca27a2d2b34b45a3adfe69923cb02beb42fa929045351c7a61becc3ccaa19b13f2fbe6d1948be0dbcdafc49db1dd056bd48a9bf328b9abfa856136e207616545238176f399f32fab5c65207d0a21b5bbb4a51fd29b93cdb56094c98e8bba03d79cb8e74d69367249ab924da85c2ead7918b5343d20634de00d4bf52b0e2ab743f73d00b29b2c150ec1e91c5a1eee62aa3a01ccfd9382660f3bf6ccdd5fb51e960ac41972f5eee9aac499055215a196fd1ee15abda708f642f4ea2024f82dd767237fa4c37333c7bf5673851d6a292d351eafc1df4179ce6d013ae8c4f2f8e75ce390210a2c3535de23e4a8e7e1f6fc3fa30a54cce5febe574e295b0d814be39d5b860c885692f6ac7a4f571822f20bde58d2b701b76f2a2695c8637d05ec1042313e874359895381578c1693935d586c13783f4317f9519b55469ac4a605f94f9ff9eeea0d5e3098bf7bbbd3878f756280afb43d3fb8eb16e78bd6f82ca04c9cffa54e8db75e7107378abd4865ac24298a29150973709843620d570da3f08637937b04bb5407a78b411e301f576bf86fb685046c0ec0c4032b2cb0fdb1ffd2a569fad70cee2e878df5f19d6fb22f627a7a914ead53bf12a03212cc1bb55811a148246007d8aef26e24d5e3887bb42b3bccb88d55a6744963566cc69ada2fb589ed75326265806d94be8b0fb02270f1c6d9cd7cbfc94db97e795e46d5634c49457b332e39d8466471c33490319aa334175923590f91f0b2260443410f00f190dc495346c5afa26f9cabf55de751f1c0d6a09d96860753ee9982594b951b921accdaeb532e7a2481e815bf64c372197c136f0932afa8af42ced015e7d182e6f507c03ab53367a80b4910f88a7e8ae051b1a997d2b582a17d817550d48585d58fd86d3824d6bff8037ab8c7005149206c36073c23751fddb2c13bd02cc2c4af17315515d657a6427d55887178623b477f55097c3f4129db07ee8965155c578f69a3b4f326a9ba613f7bdc3ae5b3a4d0afc76181363ba9cf3326ebe0aeaeb50b9b0c2729135303675e31586631e31c342eb93dc5f92231a237f62468d0285cf3ffefcbc06d739163185ba17017155a5fcc22b1e6555eadd29c47109d24004adb087d145733bb3f9893bf01d44ec194d0f8cba1fbf3fb86c9a601ccd355aa29ea291b4a8073b2e2ab88c54d6554ae76912417a2953a988c18899ec21755b49e66ef13f8238cd2ac87520159a85f1c20b2554ca0d67f45a8b6d9c88c1a60af1fc69916042cfa3ca1b83a6430e54219d0804e02264283cda1050b0186babc5ce970f4a0d8c2152d269692e353b176c3382ba81270f03157328598b9e1789e156535b1fa9d7d0e3e001bc1cbf5d0770c563f523b39356e01472741813439dfe57564ae41fe11be1cc7300f599f9bc96935c6f1fd9273a90cf2022e1eca45b439ba9a60971a65520c0bfe540785062cb004de9b9e398d1e3f8b63e01c071532b1b776484f2f3dc3e5cfed1893cc707b179ee0574e6f12d7ea2e3345186f1e2ee42b4f25640be08f54ae231ec92393cd0f26657f70462bf2d3dfd69cf76b67b76dd70b008c7c5f5c67277dbc51979784c29c94053b52285dd20066ca15f86db164a09e677c43ed7e148ab4f5e76e27401afaf879f54c18c55a8c101a20084ec898d33e01857875cb7a8157b570e5175c21382da6c5da504e8750c9a6797eccbe4f576a30bf37586dc576e96eef661f50acf741eb6817f35568837f57989217609d00d9de7fd43f2e43fcb6d019baa509c8d46bc06d929e34a8eef670648c885f0a59dfc07588be1b547ec3f482d49a768720c17670a17501bc15eace8492bd584addadef9ed1917c8ac49fc13eb86ba209b4ae4d7caa620525f300ffe25f918fd017a8c29ce41d41bdb47f35b5b8eae23536affd9d0e96f758ac42015e931f0ea12c5128b9c5c4d559fbdcb8c2a529463584b6f072588ee9d6310fb86b7724faa60a0a3818bf94538ea7ea09e78f8e6e66ef9436b5020d8b70ba502d164f1b63a88b474f66cf69a154a8e8daec30a64be7c8e9312aeeb04c15ed54e2e5b16cd449ddcd9dad614027dfb5ccb30f2c46e0a6449fcad04a9ff60e48cbb954a56d269d9f6d3a035f4c885a3c50a7e50b2c8184e232a1cd1f04f05471dc15b824613b51a465d2c86e387bb3cbc74c2df247f6996b94d100d29eca795e1d92c091c605114993422f81e7cd7261a976f807f62b2c62946314e0fd168cb9eabd096ee6dcc0f808ae8e3d3556d0bc88a9ba6664159cfc3e7e456de8d7ad18108c6bc5a7a595a4e5ae228498d4e90aa3822a039923831f78ed2f3fc1e15018eaed15a39ac5445884a7a095b62a168b791a78f5020b5508433be05b9621ba420872dba772112e29862299c877e00ba33766e70a2ae0329473e913594ef387128b4acc25e8c85d75905e0e4b69a500d4d94537a7d67e65ef2464d4efe5243004773017aa3e5c06f681c4a2c756f7dc94dd4d14bb2fbb8e0cc040c8889407b79b30e487fb816512950cd1a5575c22381b496a38335f3d72b7de82444ac1d8127c59a805d1206bd06751fd12fb428269a0f1fbd757537380b60e820db615af98cc9ac360ee13ca7affe9aac6f7fff26a9bf6a3e69f79ff9cb7c3cc7f0956436d85f8c9d49962d4b7e82b93296046bff80c476078798f09624f9014fc6ac27280a620c415f13da1606f7de4515cee8cfc0357454aec5e90aaafaaa1bb0592a75a86fb04799dff622c0598195caf7f51ec647db69f08fab04bb05a462babc83ce49556b58b8ed5f4f042fd76ec3e7673c92d9e25983fa38aebf7a0c6a6b958ed3df8dc0219a3204d0e53bbb080505c83489458b064b4044720027e83bf413a6fe0308cffd254c9390e49b9d11d4dbac9c9b2385ee859178b5e9671a4a07b0a8cfcba9a5b3d497fda5a85ea144b69388ad1d4e2c6d8062641b89edf0d0dd09b73c2841d77b572e30148f376f77d85a673f4ea2ab65a7bff1971f4778c2cf387f8b3d1c3785064832820817582fbf9623d280400847a414672855a12616caf217cc1c1627ac6ca95246f0f427ee5226f537edd2c566928ec93229a77578a3c52534d99d4c6a4d110e0a69032af618b8cadd2657f2749ffeaa9b977aeda46575443a8b6f7f72e5b0d115a784958fa40b7fe6669f70e9458a082f7a706b5df227fe3f2bad8fb7eb7537aa74b21d6bcd994b5a7ec48b56c0a9b4c56d1006346cd55e3242aab85e60014c02ee08e07aa197d5b47104f8956ade86ffa5b6de0bff13f9141e368452776804b6cefdffcb78366721c61a1c93409ce8d629c75fefb8a442292adee532d46d4c65d279ae77742e013965c91f7315bdf17272daa4e26fdfe0f48a5af829903eddf755eae9d1f2eccc5467e273c2b78ca575865b084d3d5eec48933aa013362bdc0782f149a452ff0c551b29438702bee8c863924fae4e15fb844ae833ade3050a2a817e721106bb473b6aa237249c81ca1429d236d6ea8a179e8efcd4408ca15f20367e5d27a62267f9dfff49d400ae2765be84825f351e6e8db57588644162be5be84cd9e5aa92b9e66a05d58e1a73effd084ad95f09644986416e30a2481a2aa43430652a6722f7ba025885c1e069d0774aca5e68e73ac5b054e78465c91a6ee323e037d177624fe0f3f682eb2ac96937116606db6e258c4e2daf3947a3e9b86fc8b2a4af7c1593a83d3f6c03865e06dcd7217de614d169470f9973630981577bf5828597ad021959eca7bcff14cbf60d716b7b608f899ee546a4efa17bd8279a6d247efef0a445cefcf339efdc8ab23cb83c4fe7f4a6a3469718971428220cd6e2d600ad3d8d33e332d34340a605f3919f11b48f7aefa8bf7e78d8588c7c1e759817a3571974ed0e3e42b55854e38184392c6af677eb8e4b2c34fcabf6409ba24c5c4fd6f84edd22706eb9b7f5be96051064a020b0f0bf19247e21ae475c3c8d074d87e680ca5b08ec2386cf102ad5e547212c72d2e518ee909f87e602c3561e10935bc4da84c78ea41dfeb4478226f93d72418a8a65f8e46b423d21a67406ef3e90a5a98ddfb4d946042435d994c016ca392c2bd2df36a7ca62c39307c24c9951f59b154e1bad57f4f5798059bf4b5be907a214e9caa9967a37080e9d0a2927bf10c2a5dd63bf09d2998a8c940b26e1ac66b24b8dbe26f9af6eef4bc87c4d1c43133f250619480b0763b50b2eba83fc3793ca885733c8ad3d95a3a53d0617878133078c40362cef605a51c77613c44cfa281080dbfde65fd916b9b89089164a3c34d3a07984f172a778e2f31bf453258980c9ee78f9f662956d381fc5733355e00f2ec7bd20139f56faa530a304bdc7186cb36f073b910eccb34f5e74eba8e5caf948943fd1b1770044a360365534fa127c0f4164c8428e58e120feb45977ffb1068a24ad7eb3af588a31e4a7a032a3ae3dd5e920de3888b5120e83c9019d9d97acfb63709b66b493e1ae2b528252f2f3b422314f07223b804c108f51e60ee531648b674308f5f161455f7df43c818c2d4d95d6ccfdd996e3927a42326eea14946ca0286c95170a76c44c13ff5fec95b9bb14528acebb043d0bbf366845752aacff6ee360e72145b761d997b806293ff428a729da2eaba81c1ad08a52e17805dacf5f090e916b6d6fee77d52bd87ba7f6bb8c13a88d71b2ed86ff82d69c6515a9c1738b3f53d460e0b9db18dd3cc00d6e5ea0b6b7767009141049a7193a5365890ff7a5b95ba81794fe7b152ab726fc69ce29e9ed6138c70bcdfd3da5276c7706a85ff37ae575f2220024da21d63a31b1dd1edbad278a378b624bd892a8872747d322a0510cc0917551ed2eda96cc21dbdf1f549338ecfeeba9ae43567fdf1f96ccc107818826917ef3b7424e1b35ba29fdd564b88409bd2024393bea3eee8796280c18d4b0299ee5f5d0997721a05179117989f381584583022a659dd3e1d22df6417bcde20682b4d591e1bfb48ea780e5d8dceab8886ad50602e4962abacece9ac3d7ab1ff7fa6da32d4bb303d1ae311e388442e6580c99630b6cc857965950fa158fb1fcffcb5c2ae39106454d64c124a9889ac3e2e727846d779a76fdb78a45367ca5da35871d9567554457b4f0820ab70e0edc05f4faf559336d07789333532789b69d73898766073fe02547b99e1da5d950efd15914626fea11eb6731ebdbf86e3587501a27b31e4311dacfa46ea5df907e83d647473c86156e31d84ba446e82960a2edfe2da811030a30499a5d4a3c9de1ce1d4897b9ef95b7e0a3f559c39460bfd5d460db3adf921310cd3eefd10f4fe6b81cc8bad36e8877396974f48ff1712cb7f2355bb274da504dfd164b1c50f024fe7c2fba5d43d967b5e4d325c2f6763465248a89129815512e189614b80b55cfa775e846f348b7a6a5d0c73f34d1935bbb8fed49d160675e3bfc562bcb1f788c310828b952fb042e961c119f28fde13b66050d0ad4c94b04b10279dfde961da85495e1e651e7392eab447bacf51e5120aa72b0531e316755e1f0604bd26dee970421035043ac81b026d6436a60062d3b059d2b60eba8395dbeb2a3cb612acbf8c938d2876d98a54730d0957b9cb6cd72c9b2ff8c2620c8d8fcdde8d43089656c83ec0159feebcb820de25a28a5cf7cea26471ebfb98f86e09021184afb117ef69e685f8b51227b84c97ebcb0ab0a493eb90a1561af71fd223ee228ad388a8c1a2f807224a4775f8b7beab43eb3f8a085e85faed3aa8ad07874e2c92ff400d1d7cc7f32264618d408f0255bea3cc56e68d287a476017b60a7bc71ea045d1a361ddf62897153dd99b7608b06bc9e09d01e83d9b129d2bdd0d5e11323b139a0cd7c69bd21003fe648b27dfa771d5589a66b697c9ff4ebec2a84e16fe832869fc91db962e25b92df44d93b9746b4ec0ff0eeee0f9515a3847da18c7689eedd7c6b362efb1e5ae4db26ca62854f3062dcd082c8e14711e69e767f519062d7544501070ca0c79a3a682fc197759a6508c7d3c2f5a790cc69f76d19e751a7236d47df2f5062347a4ae0f7d3e1ffb7adf4caed5b6aa6f74744e1100a37fae93b1eca6d3f5912a112870eb83a19cf98fcaa16757ee802f69af863b175754360ba33bf4a1c7eb3bff75807cfacfe73ab1bda5651f6cbbce1d85c739220d86c8ae6a939f87d41d314ecbc0f20412234a1b605a1eaafbaa215aa9b25372d1b0d0d48977c6af91ee4a42c7622690238140a6293abe6bce713a2225c493d07b49b9f0fe6386f0716cc85637728241abf4a5c1b2b26f9cfd211c054217dc2b6249a01a96dc099c32e2eb7321c43fade75647213faab1919dde42ca576a12317ec89cd70d258daa52212fbc1d8e704a0919b24ffe0eee77b9c7b6e0d6b9e61966bf3f0d57546bdf001d2915ea703dad6ab62d6577a121a9379854d1e2b36c04b17f0f62ede335495f3c0e4d3df8e9f45b929af5b47f65aed1b606aa5542f035db1352688ad24b46753d503b9e37bd87b3259428252d43fadc8d7d9d3d2031679f34a570aaf05efc6782bda10ae3799606e9b0d6482ee6ac067f187add29efea598e167f505896a7701b8ec039848eecbf01f0a8f0292f659219c040c322c5ba7f1a69241f76310bab45f208d734efeed73c3cbf59b57ffbbe68b4cf01b7863590d9ccfa7734c48e76e8d4bf55f973713dbc07c8b9785295ef010d02e47a96dc88a4ffd1cb3a7065f5e06397c989b6c37dc063f7d2aa1dcec476035e0b943bab17ecc02bb4b882e31139cae04e875e67b15e8ee687f870bc5bc4a42a9dd339950f3a26262fa7803d13892693be4082c2d41301f9f89ff5097af06f97c6d692354da85647b4829956725fef15c2efc03903c173be8ed7fcf7f62a6ebbc50baec4b25ac611db0de9322017f0ebb62770660aff11fd33a55f36c805c96e2226bfc364dffb891514102f68f8b33ff53976695b9dd756fe8fbbe77b2d40bcfb1c4a615b57143024600d7bedba41b48d11149d028b647df73e059cafaa26800e530537721d99b8a8cc50d08157507b57ebe30d4e4c3ee9bb82c5a38afcda0ca7e96f1d8afaf5371765eadc47952c366696259d4e86545ec5ff96e23e1213893e85a187396867edbb3b037f8e6555e6bb5aa67e4b223754033dcf7ac7b6e9fdf84523e6a3435159697c5bb215cde28b2ce32785e1d5471fcdcbfdaaa2816e46396b6707aaf136e8006dd33f7b98b385f7111cc58b8d002903683abfedc9ba1b4243dc3eab2b09c330782c4fa769b5689bea8ad4996acdea00ee61960d4005fe809262a4ada5f4af5a3fd4b31ae0e77d653acc07e93e70d355c17d9882011f50c136d7ed577d6babf96ca477108710cb382afeb6285c3392c17773117379aeb85430695198e9ce7630054d4fa58f5f020957ce09b3bf5da322b40185ffcb4b06138932d9b0aa0218a89fcd5ccd0334998ffef7798c9060dac353b8c917cf7e23d3342fa7f4fb4d9b7c7a415bbfaca10eb17727461352e2640cefe91e2c41a31c2923c889840335dbb728e5767364e6095157a0aad49b17d9ec0575b000d6c4a9047c85cb64b4a255461b74d943d6423fa89723b1ee96abbdb1bb0a3a89a10b44af1b7bf3b847cf9b158f93b89b906dbc92032819c6604324f31e24720da1aa56eb241640cfb17494a9d99c1992f1c5cdd22e308e72228cf8e18a7789b5c6b0e69d6d5dc5f6fe3e676feae7506eb023722234d8babb5df5864eca3b374c2337c608f2b79e6892dc6ea9e086bf9f3b9c102aecb84425f68268ed0a8f9f7fb76b7fb0a8b9e2d45122ac8dff83fdc08a04c7ad84c47c1cb7ea9d047b5c358da63d6c721ccdd350f2d1fa0fde45326158d726dd59dac1fa73cebcd07281f0090152a6b38875bd9a8dca58e0202cd0d546da2f90c6954232416a2c1aa57a4424706c1dcb0d41e0e75bec7a26ddde0bb29896e1257d5006a604c55743671cf0e640eef9a38e8b2aa877918dac971a441152db8d9b82f8eeb34139a0728e80862500749ee72be87ca980f78d8f7793fec9c9c826d0914d4e1bd0a1e277273928c0c61ef6c3295d6ae894bc4afb52f61c4c5836fec987d2e2921c8a99a95a53955ef501680035a3ae8f8ae641c9613d3447cffc4a007330cb9c8ffd1c63b44fedae6ef746efd9d63ae5614436ba449919e9de2378445a6cc373e1c45f8d89c2b03993e579d5afa4f7c65635adf55548eaa3e931a666aba676e932a8ff3fc5dee7c4f49846acaaa714a02149eaad03eca0f1a97508aa79f6661c38ec4e3e1510fdb584d63c17b50c1f4ffeaa0b0ddd693cb61599c5306e7ddf094997e4ca04c0b5e001b1f3f01b6698df4b2c38875628b5edc7de20e08e22f5b6e72749537fc3f1071eff0ae9ffa343f6eeb5b694d9c5f55159f033da60280fd56e64b99499f5481abf8b598fae558ccf76284693d606e74820ca43c60ce657b42d8dfc3723525d4ad9d9dd442621e4355d38a2019e28a2d5128b810e90d7c9da999a19d1e4b41c93713086f633abccff3858612fe3be607017502cc57e3a198f8b893e635d4f38651da1a439ab43073c4e56386dce0cd1ffa0eae51c03ddbec57463b95304ae99a6330c37bfa36059383668c25ee22bacccfa5a486044488171c551e0f1eed5003824ae67f3178790a82a6672d51e96866a6545bbbf9cdf5f5c723b56e8138e4e95ca9dbf8ac442d01b9f6a812ffc40126834356460301b5c086baa4f43c05a8d0487ea62b6beec3a5f15cfa10b81a4f1db38fa1b97bbf9eec71767311ad53bf9ecd0c9726fe19fe2f88169f8e965d18a45562888f65927485fc411a86d02cea1a130ee32baef44597d804be9104a7de22bb972c934836eafb7eb434de49a0ea1488d49273036ffb50b7c3efc83d8d10b3069fc3564ae6a620947b5a5c18ea380418c18f75e8749da07536e8a858935694a06720c4d30710ae3278ea2e68302503ea2a0afcc14b43cca0264fee50706393d617ed3e87058e27d777e9c558a4473651e9c984bae83613086f8939afd989628151e237480d3204abcae55adae8dd24e874da9de564eeed5aec2e43d7a79bb679e5c408fd65cf75d3065aa864ed324f766468f40d549d5cdce5c00cbd0ba95fb673e0ff780628c209a07508e0b570fd5afd5ffcac51c55f496b938ebed716498144f2e08b76664a7ab953f22704e46a08038c3859f4ccd6f77bc9f95c43d0afc3ccdae3f5676f62a60231a821fd0e34a61404c3f4f9579bca4bdced25f79dd6e9f0be2d1d4848fafbb81599316db827386270ac4c9942d56977948c0bc812692de63c29d6dbb568cf296dbb59a89a6af270c3e9e11c0fea34a8bfeb869ba3ba12353352498412d4e29d77ae124b273e59bb45d3fb47b5a7863ce726c69139d2bd91719e3ad7f1c60254f0088119efd8b6b9aba19e569026f7b3bb088eb4459f559c49fd1df4771c749def5555582fce737eb93506b630d0a0a6bad559dbe9f425659eac1fedac6d589d3f49483ea32647e620704204aca08e6336636f78a65ed8f05c4308c77fd45c325fe2271a4acaec031f6c8007e31f291030ba898984b66b11487a82331d28e27fcacd12bbb94a77bab830633b01f7c86b69162a622384ef55c389405b971e0069044562534485bf5303221f815a3f24601f6c589bcf66d99c9ccdab461440734ea441c07bb6e9216a93360ea5f4bd64d04bb9c118f1ae8fcb1bdd4da8d4c70d3aeac724c6c963570d355814b6df88e5dfb723606f69892636f4928a5ff384a49e14d21055356963e6dc6204a31b244402a09d4980a7fd131244ecc0c0e8abb94014bd18061a6f41f3ab037408a5aa5bb590b04fed3220bce38c1814c026611e97779b84265525d8b2868191b9663497743dd781f38b034e3fdedfd1f39b983f345e3ef6643a5f4dd4d4889bccef6ba74965747dd0777b19a7ffa9c915fc0fede9a693eeb</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>Laravel</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>Composer</title>
    <url>/php/composer/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <script id="hbeData" type="hbeData" data-hmacdigest="c59c7b4335acf10410a3adc9a4eee0748212a5cc08c4cc2a5d991ffaaf66e35c">cc4eaccd88a7cf11990f2cd15dba718722dbaacbc37a6c1f53b1b49aa4f4c994fa5208fc8c8d4782f9e49e074a59766c9c617ba477e823670ff2325ff311c5be298c91d9269d38319f4f0199001b83afd8b2c5f969339c10387b716c2f478e9362ba797d5952aca441ec0b9ff47145e9aa5caa3e93cf9ab64b0a301a7d5e1434588f23945ac77a69a6b2e0632346f66c06c1b22eb7ae37f98caf06c6a98912a31c31cb33fb550e901298a948a107eb1dfcdac133b0761120e6ce6a5ae07c17fb367db0a2a14770cc6d3cd937033d68578870179e25e65f68a680b308bab9e82466b50eaa4e333d3e75153444ae465ff88b5cbb2a8a776befbc38a65b0ac633ab57c4cf78ecf6ca8680fef07c21d9dca4576a8f87d2c220c11740383a29c5058ddf485d8c4fcdc37863f79ccf1a056a1fda9a5ad66f44236b948b3829fafaf0894f5d83e190f29bedcf73519bb4042226289c3d86282d5bc3c0c197f7767dc8665e12c817e2936f2ab41c075a46d1bd1b89c07d724fdd3e0c2f858b72466081cd209ce96f953b8aed40d5c7338a27055d453a719c119bc48cd40651db6f77a7262e3323d9a0637c554c2a45e4291a9d640daf719a805814588d0eeee2ad2123d534a881eceae8e5050b8c51fdc7ee923374f825bae3d1857a4b9a32890b5212ecfc71225c17d46301ab4b975a989e8510a4309aca1a013c77091965ed2842939439875870b68aec1d5b2dacf7108f2e469cccae3d0b3322b822743272f6b8f0d59c59c547fceeb939bb5379afa46ac06ce21bb9cf489e3909ee51fddd9f3446ce826c17c7a516b7814cc628c46c2639b85ecb6834101860ab5ec599ae730d759136432db9da83bc3988e5d04ceb3b98d5b9206146284c5ae6e43e6a57b41aa50078c763f21a75357eb207bc345015011207e6f8eb897a9308b3502aefebe90230594631c4b34d1c01ec4b1a57ef6821f7ec37bbc011879dbecb685eee1ab74bf790455aaf1282901a4bf3a9ea9a4d8ce31312ee0fd0b52ace839e1219797392b596c03ba6ccd2ade599f96dc11df5166b77b9728fc2ca95742c40b584e22ad5c5ec3302f69f84e2a02c95e1d0341569ee680c80216e3c050a265a998a6577076fe516e39e4bfe105b6cc1e6e4b4e796e14259711a4c79b4113e7317d51c8cda62476a87e2f9ba193b0253766bf230c52d87d8a793bea3c70090f94a8e8c3fef712f66defa82849fe5fd178d0e0948c77c91be5aec302743646dabed91b0195e52353a5f17aef37e274c62be09ea087c336a124718bdd3dd58a30598f2ae84e34f03e5e3ca801828b2976628b9b1a4ef660ac711f09deb3fe0f249becad7145c98bec22f7a2829fc25c2efd25935744bd7b4ca8364bccfa0407af40eedc93d52eed4c00c1ee757f7cc31b4a85bb569b4d9d75f917f80bd36c520c03e9b1c242f9a22137b9abcc2ec49fdf0cb9902a4d8d974d6286bffa8e81c5385e4a32e0c8c196ada65b0d4eeb2293c8bea5ffde0541916fcc1cdb3a728c1b17c6fa45342033c82b46023538abe3ac5ae0bc14a9f77ef2090a9f4ef93ad63d03a176bb67d6424eca473f4f892655272a1c6b435fd526d2b28e1cadacf992419071031520e1ec64925cda39c8a39aae93dde665d2b1c781494c8fd25789de4428326b33803fc6db966407df03556de63b23afbb773a07a2b24ed2874ddca73148f925c39235b7725f7ef39788407e009f2584a3f6037d1dca6b36fbde0c2e0f4a6918f7d14e8a9f77ed227a2703659099253608233135a06c1b53c6b613c5d93c3bba8c056a521e2e234d2af12eaede50b5564bc7eaa708f346737a2821732d9be77c1d95e9de94d4a33bb4b10241904434b6dd81421626c8e10537b9ac0b32560770b1757bcfa9bfbf80e0e0ca085b80debab94edbec426a9e8bce75504d773ae9721bf0db55f1b62b0b7ecf835c68316d28f7570a4e6d8cf1abaad01dc0d73f9bb5a00dcff0fa17d38f9187be8f089d0bb3dd655123b16ae873e2ae17086e79e4eb2942324c6b223bbb0c22422f1023dac2a3979a8a9756ee0331a99d44830bc3390cb3796d396e5de7f831646505e33d9acfa9c583925c1c6614ecb8a443ac102e293c546c58983e77ac6e33bbf1d27839fad947da681ca2552c9b8fe578a19dc02ddc72e708637ea7b3ce3642d9903cb900d8ba43492a3fdfd96f835b6fc0ee232d26f946af8ece6765552a45ec4a51fdfd0b3bdec9eb5c1ce2dfb6c4916dfb87f7ef05b0c887bd94def34126112d7659286a03e86564f89a00820ccbced502d700495d6ad3b0f7d08939512a12e370f6980d9aeb9616efb17f12c52a7f7e33a80c0e2db84a20973f859f973cae1571651495b51ed004e2c2b304daa11509cd1289cef13ec0b358a313f8ee6731dfe11e280228894129645443d6fdb4a061f84b05e44bc443348e2dab61a97b972c91c2ee25da2c2736fc1e85e6d075dc242ba6ae94c291a893ce59493fa6b8f11bcc2a7d525b6c7f75ae4546c427a746f627f6641c57d29a2669ed380c357dcbaac1e6058d07e0fbb3c9413a30303349ddf0f5ede09817cb81ee6b02959c2ff1d3db690fef7ab1cc829ed7bea162d253c950727c581d671d7aa59b6deef5215b076c25b798124bea8cc252867f24e44a920cf88e58361c19e5a6f88f41c3a09014ec652a22532613a77227d4b9a08bc6c7513d80494066b</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>Composer</category>
      </categories>
      <tags>
        <tag>Composer</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginx中的http_proxy_module</title>
    <url>/nginx/http_proxy_modyle/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <script id="hbeData" type="hbeData" data-hmacdigest="216ae60c87dfd158b484386eda57246b6c318822bb6f162f8633a15a3de28ea8">cc4eaccd88a7cf11990f2cd15dba71878958af4fad6254f56ab6d6066d662dbb5a69a5e4654f019acb68ccef866b77da74a3e1b09e1e99aa50a6eb99d588618ba5328c0628290beb973610c4bb16200d10726c86566942e3cf7541efc65e3b3373729c243de09864138b94b29efdd69e74c23cb5d3cd3b8e34b7befd7bf110050baaf38ca3198d1d3d84446199163ac88cf27a2090c05605ece53fdcbd4a686b00dc59f1a45590b4f507b339cfab3407c7633c3d2abcfdd14fc8bef78b380bb9e222c577281ed983be88d5ea6b02401a0fb21cf300d38be7d450f5066f37243b9b2bc2a855f6e269dcbf20d66728d527f054d965353db51fb7fc63eb0eda25aa05fe9ccdbc444ec7f2dc6202417ede5935f506be7ac1e9963bc9746e8bc3f7b5d0aa0b5798f812610bef2d41cf99a3edc4685173c00bc736557c3fffcdbbc01ea8fd1ce08e9e915f8a2a27661114fe3664018dbc1ce3e27e193c573ce075b9c5f4a769c78b5e188bb87ca0eac31735b0b7b5c629e29a04ce147d0a74a5bb088b9e0c1b521c7f9a29a98dbb707dc0ece456e8451857634d00fc93e2754ee8cb1c6799267178c81482afa559c11d99dab5fd392880d63474019d9bd491a6bc06b791e0983dd84a3b9a166272352007b5ae19e3961d1ef44c08a2b725770923024794ad8aeef044a26a71100d101068ec92b6b33300eaaadd2e81c9e32c7889128daf7ae1ac29c112804dee59c2bb742e97c7c78b4782825ad3e0ecc4cc33a12a4345683f8d77e26033fb865a957b9bb14e25a365ad437a11b54d827339516ae48debc3c94b368f00a90a5186afca241842ef5ee76dc815fa0a9b929efa72ace1cdfdca2920be9154bea84772dbbfa254fa5cb0361a2c0ee33a895de24e4605112a75bcbc1b7f22550f5efc7a5dd3a9354ab90cb4ca18991eedae228046e01ab63bdd49c00ae9b8246c387a6c3bde93c01cf70b389f719e597e635ab23f5aa55d200e7658eafb574f29f8a660094dcccc90f9350f10f7ef78acef2a1a4c4a5cb9d35083e29ff522c30d38cd6dcf21906edf25e9b5dc4fc50bbbd64220e1361796f59135579bcfc0ca3f7a76f79c1a33cd40bfd58250a55e1f6e7b9c423f3ca09acc3576811c1099869482b27bb6a147bfaadda7cea7d130068a2735037bd50cfbd3e08bf8322163866cc0eb11a33847fef46a4b15095a82b6c654b8a64454faf74af55a3b0da4445bec6a28595765b70cbb67224fed096c741b27b75e201c4797d2e3b67c093b818863f9b37778386feb68478fb6201693ed8bcb9765021262b0b602dc23ef2666545fd38f2eaa7f5f1c4b00d5b5145db04f24a4e9828dfd55fa154160f97d27b5457e2220991dd246af3e76f12de88b60ce11a4c992867a7f4a66c17f6845ebc5adf9ad2dac404d31502225c8d747c2dee8862e32cda1e2ab823c0a481a1b3e25497be3d1a038e35b870048c5776142ba2e688fa2d5f62718eca86e6e5ffa5d5023d593163ac51ba2e19fcc3cb1a0c1e386ccba3240a846110ee7df3388a4b0b6be72bcfbdc995750da6da4db3893a83a1f390823736a6f610cb4e1f9dd3cad0c824db99703360990caa7c73d911d4315614890feba5e1b92bf9a100cb052a2b96956a7c6d57c2deaf4ef1e4b8410547a5a6599b150c884b3ffbfdbb248fd207ffe32ce7f737c627f903031d331a31bb453fb4f38c48d76aafadf11b58a9210b062a91c428b4d7d6ca3f9447d5856e8749301422bd44ab518bc11805b00644f26fa158ac9c09ac14e85293383827a3a5393ffb5737551e5350bb8c9aaf0c1afa2678a81695f6b28207f86f02d793e0dd8c28c19afd0022c038db37203e784dbc81e8108e73d0d1a766639aadd2349c4b5f0a2a6e930ddd63f2382190061bb018bbc68da4c87e7da5db9184c291e10d37f653d41c01d12a0cce87beabbdd7829fe21f519d1d1061686880e181f747860f44c676bf9498c9b379a3fb19ed3bc7dd886aefc32504b593b6afec9f9150053ee3d770afd6d284b99f724df169b023a5ddc5903364eadb01cc965edb9ad3787529646e9b4a3cd9c59d41db7b51acc698b9bfdb1157c20796188f47b2830fdd1f3482a25b829b262674cc9e52b8c047c68c149461c75b9d05dbbdd733ef0fc3b3dad8dadb859c22dcfeceec6ed91555ad52c79d90175ff8a00c92947bb002f469f0ece965f93ada0ae2394a5eba03df818d41b3b704c0b6f10720accc5db389a4e52a7554f6f69113ca9a3a1f95f83c001803cf8438e0e42cd0411060619117eb02aa9797cc3d33096b2bef4e81929b777aed29432520a12bdce8925d81fff22c481956013db960d9b8cfe3b35f94cf352929a3c0613378f09d1c3e274fbb706ec512f797c787a797fde9f9e69cb1ef307a7dcd65ecca1542378b31dc554a29bf7a1cc91ee3f88739700163f6c33aed790e324791760f8f950ed9c23a17f82060b9d108b2f35d514286aa4b629fb156d957d35ffc1a55f75dbca2fbc4770314447b4cdc9b9045ea5d58c5b6093f99f96d8a2948f7c29a733776295f509c527321b4a43c77f27c1718a15b5a5f3b136396d3454aef776eb6962d34f11090838df5114a5e77393182e931e0dcb27619ea6fef7ee5a3443f4fce64816c5fe776c955db9b5f4e593652d7834310664e80ee2b28ca0081c94ab9eb75f29c5f9e67bf8ad08e10da1261969ef36dc1e95547ce51c2dbdd9dcbf9303be4ea62ef017423a0e062f77132cd96259eb47a4d3097947ae935a11c7eac96366cbce78c6fb8a2213f336d83b4f0a9475b76dd52ac2b3d672ec079bc7f65a19b0246ba49ae4b9c65798543ea90848fe17977a7a7d2996c33547639ca79bf36ff8d593acdfd423ae1555cf513c5b9aa68e7fbcb1863a82bc3b05dff5fe6c9d0a622880e03b7b1af81533d483be3baa2243280880ca18955eae30a0f663912a001b03a3542db4cf5fe1bb7d6ad41e0d19434a5495fe329ea44e2f8313b17d664eb260dc50d8ae521181b062d6b88cb16c15e08900fa823facc0927b710742b90edadb462df313679d401fb85cd0564f9e187dd9f0b72793a6cf069b160c1fc41d08a1518306790f51df669a86862d9c31194dde38f71aa67d2a3bce7e1084466fdb890a839b990a2544b55de01e2d3bc69f219b1562dcb7a763efcc3a9ac9877b7d40df27571c997f9ff9a0d7de2c0aed74a23ee4f8f575a42a0371e8ee30472c4c674723f52352dddf40d88afb543b1e4914a0512304289c3c9e92b923a726600ea8e1e03519c64d50075e4038feaa46f9067715f9a901401a4ff8e6663b34b988b4641da34599d40bdcd9cd373fdc6984ced0e016bdb7acdf633f30293da951f9809cbf1c35dbd6bf7850eeffaff247ffb7e0bb29aba5705506d7d057fb233375fe2dd2667d89c96612dcadcc522acde7f32a14b53ff4a18277fc9894c387416768b3b2dbab0cab81a2b94d19aebba6ad62a064b2c734fc5eced9a2e5af64c40d5e03b1d69b3b987765f0cc1642abe725cd0a7d757116655b72dbd74fa241ebe40fa66543122d374ef71d12e0f54be683b327c2158af9467736c88bc0d6ba09ac81ab9c1a51cbc6f92f9c5054f4e90cec4cca2d0bf0d32d7e50c9fbd76950a7f7f31281bf55dcd386c9a0264b562c9e13381ab7ee7ca941b48ae35845f60dc215d05d8f89780751b5c7459af9025abaa326b4384e7c90d6c80873766a92a0976726d3f4745520cdfd283c56c118fb6f4865970660251b2c3d3d1a80676ae4e163507f78a2cf754d938bbe2d0cf494a7d518057cf8f885220f704a77fa733879a058f54dc077fa9d62e0c2e375cb324058e1a9b37ea5e8a8edaac51087bb6666990d8bebaf0634bb00460e68a996c497656ebdaa3d131d56c4351c7fffe4404343ea4e088670264dfd1ad9d65b00d8051f2a99cb12b20e4c9f5eed42c44b6fffb3e39b39fa2f51435aafec96ea0d35ef469e7067772a5c198ba4bb07e7b42fa696940d077562844034ca6bbaf60495b2d6516d9b8debf0a6b4499cc035774520078dc67ee5346bb0d5b40f7e93e67782297cd2efca677893552efa45089ac35fc2f368661fd4bd09d99e089138ca2f2d38c79ebd91f0d99d6e71a8bab6f2e788d47fbe96014b2ad39e8b15b1c7d2e4fda0f143347d8db977f0a37345b8e4550ea7934ebd4358e73dbde0fbc74472ce2c3d660c901768ad18b995497dd6df55f24aaf31ea0f6fa7dfaaf92c54104d78f86683c902cc740b34b92655b02676329b08d4eff5ec0fe389ecb1b04490711d2ed94dcbd55f40d729805c10ca611e8234cc6ca2476dfdcb77a5c5fca805569351b6b6dfe57ba894eb31b8872a223e38a49243e231c5c897f080a25ef89f90eeb6ae4630f2c1ab90a076759625681add0064a8f692d64cbd596dc04d2838acda230180107f1fca3342ad804673e12b0368d1f62e78ec60493e931b98357ef70a3750d088a3b3355c6cea1dab106e320d3a1c080f4de81efc9550d982b9b592433539889b7a152fc897d38e305c85678ab40a5b1c1c446d11dd6b1c45aa3c88ae958d9d4e3f65014e1ae54f5c0c895fc10fa03258a085fb16aca09b883c93addb0a36e66accbb3909519ed9a04aa8f493136d0c7dedc49ca5eef8e76829808f8781084ea66f920dbfd53df9c206d9af5202950e630d1b489d0ac86b49041498b18c4598fd56783a09fa62479d6db61b0b1a749944aa7ea86a448149587038f13e03ebee0d31f7e3c12f773d78f652558a38601697763956483059af32e462412f6a3c1b092a65a309a4c802c09ad6f4e554ed01fd35dafc642df50dd8729ae0327ac13e03e66ac54c0bf3f55e7b1065d959e8cc0c8282963c766fc8524092580f64908c51d351aa437bb46872f98aaa4a608c382336e2686251bf6cda39dcc5609fff2c6d540583f83d8008cdf529288d96d4eb9e37b433b1b7f43b0dabc7959195c607b9faec88e33d84cd9a60c94f414848fb046febe035bd203f3f30b267026a63bf9cdb15db8ac4a76c7cd39d77b33fd9cd3439c6e418288c6bafa906d821f9463ee1c1a1b3ecfd02ed2c7fdf9719fb0de2015eca4e896a35f900563156d0072992862004706df4a7f79b4f9500ee4bd50d492c53b1765e73fd473f7a5f9ba0ac3777c0ea73fcfa3277619630187a47ea2aa4730e6904faca583fb0c5d45967bc0ff1b000b803e5a98889a4e93c0c114b7526b650949e1ae81d696d56aa91fd496620115133eb9010386a16bc331d1bdc35492bbfe322e1bca8bbca59107c040f516c189d2b12099601d36a666d33ac64b2ca45479bf020ba414ea430656bad733c5bb011abd48ecda0e50b44db1cddd694421973f736df8fc5800ef48eb58a6882f6b9f4dc7da3fd11e194b47d1a37d7885e7f8caa4a12a9d312dfc89913f0b3b19412db5a8ce61972eb9ecae9a17a3d811722498b27cbee6af4c1e88422880e5546d9af2305455df0423b1dd04f4e6a46295ff2844b29f15442ad8ec82b0713a4d3dbee6f55c1e8742c2d3b104c9d539fc9fe0e20b7343908888e669da67bc880997e33575fb9a9645a11f5ef4d727e12706872a99cfa03dc8ca59e0ebfed1f5cc5c0d01973dc63db264c2f054051ea863af3a108783dd60682865fbe4e78b0748d7af878e010afc9315f2910de7cb2bb813a175c3bbd29d6271169f5c77eb72673459fa00f35c40906a35e8a4553de9538635532193ccbac09d3fe7bf24deb32fc2b926e024bce7c58dbc7965375b5d1ad565acb1b07aafe6836561411be53582ec8e81851b02bfc5d96ae45e0ec4cb6d418379757aa080b2d7b64058bf2784443df06564f957e0bb5f1e35cb22c2abff748038603a6b742c87f4eaa1721f0f2edbb6967f303e1845f0111b90bab99d7e1b2712b9cfe71e735c05dbac85524427f3be83962b2a66efaeb888a401a364cf5c08d55150b4a6631debf9f0ee5d68e07b984f6382e48e6034be9c0d993c6b4aea28bc17e614f8e35a3fcf11ead74daf592ff0a0140de8e3de93e837f49a68d4e54864e3f8968a61d64e054ee0630f599c24461dd8ec0b3ec406d183c51f2e0015153a69142bd675c16b9148eefea2c616e72717f097a824510e5d5f8fbefde3f05a082f3410f4762bee759157b80c8e154c503e50885f8259059247239c9ac7a1255af8a6a8ea47c8263ccbbd9783be34fe3f638484b5c323e0def255b91bf4e9d761e4e65ffe08f7e34541a16c2960c3a3c7ae4ef37c9f17a5bca29b8996fa3304fb928b34c2a4c44b9243a227e98a8060385432a09df46f3c0b8db668f63a73bebca3d08639b32ba562137984c3b84ac21bbe4a61af403b4e60c23e4a8e1cb1313d0b27361626197ba6ebfedab55f5c2dddddf0c6df52ebc138f412ffc5c7a0dc3a47a1cc0d87140a2beeb87c4ec78bc7b47b730f3ea35337777f859b7f0a3ee9666203b0aaee18a2c7be941fb4115e66770a1c7248644289012896a23c2c7842052f8b14583109fd7839f38237809978c70e193df594efec80ee53742597bae1115615d905da16ef69ba507d7ad51e55438fb64b69d388fd8179b9adf01a045d6e56c59dc620da9c915863501abda6da702ecf8234399774519f126c656e029bb92f7fda4fd53dc19309db3bf801e374af0ce27366fe6ca6d2c575e22e11469865bdd78ae07f12ca7736b5d230f9be472e03b3636f75850a719a043e047546bc5bce8656d9e85548f36d7c5d44cdff47987f607374cea791eb2f337c4e8d52990fd85dfd7be13e63332d1d4220d93da043d4925fb6a1e07b7f2067b43e91a8c8e33db0ffc86a1fcbe4430ef87eb1382cef618ed06c7b3edf97f8e0d8b9d2a1f236f19fa26f651df8a0c66069bea8064456c185ba638b55fbd9f58be49378e805d94530199d4fa3be2e2f219d8600cd5b8ef4ec0449c98dbc1103f5ba1e2959023bdfbedc1b06335203ff0957825746410a6465706dc390d3c76836633a398de9dca72db7cc95fd6135f0df92736920867626bfbc5323a027c1a509a9de0a88d284186bf076f152cf49f7f55d660549bdfbd10d791be35160d47e438bf1869cf8cf2dfaffecb97d50c8f026e082f44deb25473ed2541317eb008fdb0101d3a8be794b6e9d3a271b5a96e5f73ffd1d5d37513278ff29da35f895a4c7d796515524a2b197a7ecf8295542616d7e9a28d051c97291e0c4223d2404bf3cd557da278e7c721826d7d9d96ed378ba3a2c9fd5584b1008d10e27655d8c7b24ab7b25e4c2a4306261caf3b965b8adc3a6ba25acc1dd71216dec1856f8aaf052b70543984051bbb21533dc872592bfbdd0223734285652d761ed02e79d6f9bd4d1f74a45a5740481c3cfd451dc0755076a430f3023bba136d7ecbab5559ee1a5023d1d00602fc5a2d78ceb1bb693ac2dcc8a7811f6be3ed9ed514db1bec4901c2a3f81c0e0931a4741415cf68ee3cc46f00f7e448a0eb5b28e9e90cab24d710f946bc8822090ed3d4ab9c3371eaf446d3e1f9f0bf8c2a6d718e476ffff06ccb59b36acb9412a0249f56ac76892d040b960e92bb8bc1677f96bee9dc4a4f4378e803d3afc21d533fcba53243c0e25af3629b22d490c1a83a7a9753b2d3f0356855175aad380e092e99139ebe2e2e06db2be3a6bc835e9b4bc653aa2b564cbe49adf18c1e420b133a8418aabd2d6cf614a78344b4</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
      </tags>
  </entry>
</search>
